/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e,t,s={546:(e,t,s)=>{s.d(t,{E_:()=>l,F3:()=>r});const n=(e=>e.CapacitorPlatforms=(e=>{const t=new Map;t.set("web",{name:"web"});const s=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t};return s.addPlatform=(e,t)=>{s.platforms.set(e,t)},s.setPlatform=e=>{s.platforms.has(e)&&(s.currentPlatform=s.platforms.get(e))},s})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s.g?s.g:{});var i;n.addPlatform,n.setPlatform,function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(i||(i={}));class a extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const o=(e=>e.Capacitor=(e=>{var t,s,n,o,r;const l=e.CapacitorCustomPlatform||null,d=e.Capacitor||{},c=d.Plugins=d.Plugins||{},h=e.CapacitorPlatforms,m=(null===(t=null==h?void 0:h.currentPlatform)||void 0===t?void 0:t.getPlatform)||(()=>null!==l?l.name:(e=>{var t,s;return(null==e?void 0:e.androidBridge)?"android":(null===(s=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===s?void 0:s.bridge)?"ios":"web"})(e)),u=(null===(s=null==h?void 0:h.currentPlatform)||void 0===s?void 0:s.isNativePlatform)||(()=>"web"!==m()),g=(null===(n=null==h?void 0:h.currentPlatform)||void 0===n?void 0:n.isPluginAvailable)||(e=>{const t=p.get(e);return!!(null==t?void 0:t.platforms.has(m()))||!!y(e)}),y=(null===(o=null==h?void 0:h.currentPlatform)||void 0===o?void 0:o.getPluginHeader)||(e=>{var t;return null===(t=d.PluginHeaders)||void 0===t?void 0:t.find((t=>t.name===e))}),p=new Map,f=(null===(r=null==h?void 0:h.currentPlatform)||void 0===r?void 0:r.registerPlugin)||((e,t={})=>{const s=p.get(e);if(s)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),s.proxy;const n=m(),o=y(e);let r;const h=s=>{let c;const h=(...h)=>{const m=(async()=>(!r&&n in t?r=r="function"==typeof t[n]?await t[n]():t[n]:null!==l&&!r&&"web"in t&&(r=r="function"==typeof t.web?await t.web():t.web),r))().then((t=>{const r=((t,s)=>{var r,l;if(!o){if(t)return null===(l=t[s])||void 0===l?void 0:l.bind(t);throw new a(`"${e}" plugin is not implemented on ${n}`,i.Unimplemented)}{const n=null==o?void 0:o.methods.find((e=>s===e.name));if(n)return"promise"===n.rtype?t=>d.nativePromise(e,s.toString(),t):(t,n)=>d.nativeCallback(e,s.toString(),t,n);if(t)return null===(r=t[s])||void 0===r?void 0:r.bind(t)}})(t,s);if(r){const e=r(...h);return c=null==e?void 0:e.remove,e}throw new a(`"${e}.${s}()" is not implemented on ${n}`,i.Unimplemented)}));return"addListener"===s&&(m.remove=async()=>c()),m};return h.toString=()=>`${s.toString()}() { [capacitor code] }`,Object.defineProperty(h,"name",{value:s,writable:!1,configurable:!1}),h},u=h("addListener"),g=h("removeListener"),f=(e,t)=>{const s=u({eventName:e},t),n=async()=>{const n=await s;g({eventName:e,callbackId:n},t)},i=new Promise((e=>s.then((()=>e({remove:n})))));return i.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()},i},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return o?f:u;case"removeListener":return g;default:return h(t)}}});return c[e]=v,p.set(e,{name:e,proxy:v,platforms:new Set([...Object.keys(t),...o?[n]:[]])}),v});return d.convertFileSrc||(d.convertFileSrc=e=>e),d.getPlatform=m,d.handleError=t=>e.console.error(t),d.isNativePlatform=u,d.isPluginAvailable=g,d.pluginMethodNoop=(e,t,s)=>Promise.reject(`${s} does not have an implementation of "${t}".`),d.registerPlugin=f,d.Exception=a,d.DEBUG=!!d.DEBUG,d.isLoggingEnabled=!!d.isLoggingEnabled,d.platform=d.getPlatform(),d.isNative=d.isNativePlatform(),d})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s.g?s.g:{}),r=o.registerPlugin;o.Plugins;class l{constructor(e){this.listeners={},this.retainedEventArguments={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const n=this.windowListeners[e];return n&&!n.registered&&this.addWindowListener(n),s&&this.sendRetainedArgumentsForEvent(e),Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const n=this.listeners[e];if(n)n.forEach((e=>e(t)));else if(s){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new o.Exception(e,i.Unimplemented)}unavailable(e="not available"){return new o.Exception(e,i.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const n=s.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach((t=>{this.notifyListeners(e,t)})))}}const d=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),c=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class h extends l{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach((e=>{if(e.length<=0)return;let[s,n]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=c(s).trim(),n=c(n).trim(),t[s]=n})),t}async setCookie(e){try{const t=d(e.key),s=d(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),a=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${n}; path=${i}; ${a};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}r("CapacitorCookies",{web:()=>new h});class m extends l{async request(e){const t=((e,t={})=>{const s=Object.assign({method:e.method||"GET",headers:e.headers},t),n=((e={})=>{const t=Object.keys(e);return Object.keys(e).map((e=>e.toLocaleLowerCase())).reduce(((s,n,i)=>(s[n]=e[t[i]],s)),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)s.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[s,n]of Object.entries(e.data||{}))t.set(s,n);s.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach(((e,s)=>{t.append(s,e)}));else for(const s of Object.keys(e.data))t.append(s,e.data[s]);s.body=t;const n=new Headers(s.headers);n.delete("content-type"),s.headers=n}else(n.includes("application/json")||"object"==typeof e.data)&&(s.body=JSON.stringify(e.data));return s})(e,e.webFetchExtra),s=((e,t=!0)=>e?Object.entries(e).reduce(((e,s)=>{const[n,i]=s;let a,o;return Array.isArray(i)?(o="",i.forEach((e=>{a=t?encodeURIComponent(e):e,o+=`${n}=${a}&`})),o.slice(0,-1)):(a=t?encodeURIComponent(i):i,o=`${n}=${a}`),`${e}&${o}`}),"").substr(1):null)(e.params,e.shouldEncodeUrlParams),n=s?`${e.url}?${s}`:e.url,i=await fetch(n,t),a=i.headers.get("content-type")||"";let o,r,{responseType:l="text"}=i.ok?e:{};switch(a.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await i.blob(),o=await(async e=>new Promise(((t,s)=>{const n=new FileReader;n.onload=()=>{const e=n.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},n.onerror=e=>s(e),n.readAsDataURL(e)})))(r);break;case"json":o=await i.json();break;default:o=await i.text()}const d={};return i.headers.forEach(((e,t)=>{d[t]=e})),{data:o,headers:d,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}r("CapacitorHttp",{web:()=>new m})}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var a=n[e]={exports:{}};return s[e](a,a.exports,i),a.exports}i.m=s,i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,s)=>(i.f[s](e,t),t)),[])),i.u=e=>e+".main.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="webpackcompiler:",i.l=(s,n,a,o)=>{if(e[s])e[s].push(n);else{var r,l;if(void 0!==a)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var h=d[c];if(h.getAttribute("src")==s||h.getAttribute("data-webpack")==t+a){r=h;break}}r||(l=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,i.nc&&r.setAttribute("nonce",i.nc),r.setAttribute("data-webpack",t+a),r.src=s),e[s]=[n];var m=(t,n)=>{r.onerror=r.onload=null,clearTimeout(u);var i=e[s];if(delete e[s],r.parentNode&&r.parentNode.removeChild(r),i&&i.forEach((e=>e(n))),t)return t(n)},u=setTimeout(m.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=m.bind(null,r.onerror),r.onload=m.bind(null,r.onload),l&&document.head.appendChild(r)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var n=s.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=s[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={792:0};i.f.j=(t,s)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)s.push(n[2]);else{var a=new Promise(((s,i)=>n=e[t]=[s,i]));s.push(n[2]=a);var o=i.p+i.u(t),r=new Error;i.l(o,(s=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var a=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;r.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",r.name="ChunkLoadError",r.type=a,r.request=o,n[1](r)}}),"chunk-"+t,t)}};var t=(t,s)=>{var n,a,[o,r,l]=s,d=0;if(o.some((t=>0!==e[t]))){for(n in r)i.o(r,n)&&(i.m[n]=r[n]);l&&l(i)}for(t&&t(s);d<o.length;d++)a=o[d],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0},s=self.webpackChunkwebpackcompiler=self.webpackChunkwebpackcompiler||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),(()=>{const e=(0,i(546).F3)("Preferences",{web:()=>i.e(619).then(i.bind(i,619)).then((e=>new e.PreferencesWeb))});function t(e,t){o()?document.getElementById(e).addEventListener("touchstart",t):document.getElementById(e).addEventListener("click",t)}function s(e,t){document.getElementById(e).innerText=t}function n(e,t){document.getElementById(e).classList.add(t)}function a(e,t){document.getElementById(e).classList.remove(t)}function o(){return navigator.userAgentData?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((e=>navigator.userAgent.match(e)))}function r(e){["button-play","button-pause"].forEach((e=>{n(e,"hidden")})),a(e,"hidden")}function l(e){const t=`${e}-modal`;document.getElementById(t).classList.remove("hidden"),document.getElementById("modal-background").classList.remove("hidden")}function d(e){const t=`${e}-modal`;document.getElementById(t).classList.add("hidden"),document.getElementById("modal-background").classList.add("hidden")}function c(){document.getElementById("loading").classList.add("hidden")}function h(e){document.getElementById("loading-bar-inner").style.width=`${e}%`}function m(e){document.getElementById("loading-text").innerHTML=e}function u(e){e.notes.forEach((t=>{t.tail&&t.tail.note.remove(),t.note.remove(),e.notes.delete(t)}))}function g(t){return new Promise((s=>{e.set({key:"userProfile",value:JSON.stringify(t)}).then((()=>{s()}))}))}function y(){return new Promise((t=>{e.get({key:"userProfile"}).then((e=>{const s=e.value;t(s?JSON.parse(s):p)}))}))}const p={level:1,slides:2,animatedBackground:!0,sustainedNotes:!0,autoCalibrating:!0,progress:{l1s2:{},l1s3:{},l1s4:{},l2s2:{},l2s3:{},l2s4:{},l3s2:{},l3s3:{},l3s4:{},l4s2:{},l4s3:{},l4s4:{},l5s2:{},l5s3:{},l5s4:{}}};function f(e,t){let s=1*e/(e+t),n=Math.floor(100*s);n<2&&(n=2),n>98?(n=100,document.getElementById("skilz-channel").classList.add("skilz-channel-lit")):document.getElementById("skilz-channel").classList.remove("skilz-channel-lit"),document.getElementById("skilz-ball").style.top=100-n+"%"}function v(e){document.getElementById("stream-status").innerText=e}const b={songDelay:4e3,maxTailLength:500,targetBoundSizes:{top:.04,bottom:.03},mobile:{maxTailLength:1.2,travelLength:1.285,targetBounds:{top:.96,bottom:1.03}},minNoteGap:150,allSlides:["slide-left","slide-a","slide-b","slide-right"]},I=[["aintOverYou","goodLook"],["maniaMaster","myHeart"]],E={aintOverYou:"Ain't Over You",cosmicCaravan:"Cosmic Caravan",godOrDevil:"God or Devil",goodLook:"Good Look",maniaMaster:"Mania Master",myHeart:"My Heart",secretToSell:"Secret to Sell",skyHigh:"Sky High",stickAroundYou:"Stick Around You",takeMe:"Take Me",ufo:"UFO"};function w(e){let t=0;return e.forEach((e=>{t+=e})),0===e.length?0:1*t/e.length}console.log("initiating beatburner");const L=new Audio("./effects/whoosh.m4a"),B=new Audio("./effects/static.m4a"),T=new Audio("./effects/guitar.m4a"),S=[new Audio("./effects/twang6.m4a"),new Audio("./effects/twang9.m4a")];let A=!1;setTimeout((()=>{setTimeout((()=>{L.play()}),400),setTimeout((()=>{B.play()}),1500),setTimeout((()=>{for(let e=0;e<50;e++)setTimeout((()=>{ge(["tapper-left","tapper-a","tapper-b","tapper-right"][Math.floor(4*Math.random())])}),1500*Math.random())}),1800),setTimeout((()=>{se.showMenu("source-menu")}),3700),setTimeout((()=>{T.play()}),3500)}),500);const{songDelay:k,allSlides:M,targetBoundSizes:P,minNoteGap:x,maxTailLength:C}=b;let $=document.body.clientWidth,D=document.body.clientHeight,N=Math.min($,D),F=1.5*N,O=1.365*N,H=O/(k/1e3/2)*1;const R={top:O-P.top*O,bottom:O+P.bottom*O};o()&&(console.log("mobile woo!"),function(){document.mobile=!0;const e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href="./style/styleMobile.css",document.head.appendChild(e);const t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="./style/noteColorsMobile.css",document.head.appendChild(t),["fog-top-left","fog-top-right","fog-gradient-left","fog-gradient-right"].forEach((e=>{document.getElementById(e).remove()})),setTimeout((()=>{J.initializeMobileBackground(),document.getElementById("background-css").remove();const e=document.getElementById("game-container").clientHeight;G.travelLength=b.mobile.travelLength*e,G.autoAdjustment=.05*G.travelLength;const t=Math.floor(G.travelLength/(G.songDelay/1e3/2));G.targetBounds.top=b.mobile.targetBounds.top*G.travelLength,G.targetBounds.bottom=b.mobile.targetBounds.bottom*G.travelLength,G.noteSpeed=t,G.maxTailLength=1*b.mobile.maxTailLength*G.travelLength,G.slideLength=1.3*G.travelLength,A=!0}),500),[["tapper-left","slide-left","note-leaving-left","dummy-tapper-left","dummy-left","slide-left","b-slide-left"],["tapper-right","slide-right","note-leaving-right","dummy-tapper-right","dummy-right","slide-right","b-slide-right"],["tapper-a","slide-a","note-leaving-left","dummy-tapper-a","dummy-a","slide-a","b-slide-a"],["tapper-b","slide-b","note-leaving-right","dummy-tapper-b","dummy-b","slide-b","b-slide-b"]].forEach((e=>{document.getElementById(e[3]).addEventListener("touchstart",(t=>{ie(...e)})),document.getElementById(e[4]).addEventListener("touchstart",(t=>{ie(...e)})),document.getElementById(e[5]).addEventListener("touchstart",(t=>{ie(...e)})),document.getElementById(e[6]).addEventListener("touchstart",(t=>{ie(...e)}))})),document.addEventListener("touchend",(e=>{"dummy-left"!==e.target.id&&"dummy-tapper-left"!==e.target.id&&"a-slide-left"!==e.target.id&&"b-slide-left"!==e.target.id||ne("tapper-left"),"dummy-a"!==e.target.id&&"dummy-tapper-a"!==e.target.id&&"a-slide-a"!==e.target.id&&"b-slide-a"!==e.target.id||ne("tapper-a"),"dummy-b"!==e.target.id&&"dummy-tapper-b"!==e.target.id&&"a-slide-b"!==e.target.id&&"b-slide-b"!==e.target.id||ne("tapper-b"),"dummy-right"!==e.target.id&&"dummy-tapper-right"!==e.target.id&&"a-slide-right"!==e.target.id&&"b-slide-right"!==e.target.id||ne("tapper-right")})),document.getElementById("change-tapper-keys-item").classList.add("hidden")}()),setTimeout((()=>{document.getElementById("start-curtain").remove()}),1e3);const j=new Set,q={"slide-right":null,"slide-left":null,"slide-a":null,"slide-b":null},V={"slide-right":new Set,"slide-left":new Set,"slide-a":new Set,"slide-b":new Set},U={"slide-right":null,"slide-left":null,"slide-a":null,"slide-b":null},z=["KeyS","KeyC","KeyB","KeyJ"],K={"tapper-left":!1,"tapper-a":!1,"tapper-b":!1,"tapper-right":!1};let W=0;const G={algorithm:"A",allSlides:M,animatedBackground:!0,audioLoaded:!1,autoAdjustment:0,autoCalibrating:!0,currentSong:"",maxTailLength:C,minNoteGap:x,mostRecentNotesOrTails:q,notes:j,noteSpeed:H,radioCode:"mvn925",slideLength:F,sliderPos:0,songAtStart:!0,songDelay:k,songMode:"demo",songNotesHit:0,songNotesMissed:0,songStreak:0,streak:0,streaming:!1,sustainedNotes:!0,tapperKeys:z,targets:V,targetBounds:R,targetTails:U,travelLength:O,useShortSteps:!0,vMin:N,waitingForKey:!1},J=new class{constructor(e){this.masterInfo=e,this.valsQueue=[],this.initializeColors(),this.initializeBackground()}addValsArrayToQueue(e){this.valsQueue.push([e,performance.now()])}animateBackground(e){if(!this.masterInfo.animatedBackground)return;this.addValsArrayToQueue(e);const t=performance.now()-this.masterInfo.songDelay;let s=null,n=0;for(let e=0;e<this.valsQueue.length;e++){const i=this.valsQueue[e];if(!(i[1]<t)){s=i[0];break}n+=1}for(let e=0;e<n;e++)this.valsQueue.shift();if(document.mobile){this.changeColors();const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));document.getElementById("play-area").style.backgroundColor=`rgb(${e[2]})`;const t=document.getElementById("background-left"),n=document.getElementById("background-right");t.style.background=`linear-gradient(\n                to left,\n                rgba(${e[1]}, 0) 0%,\n                rgba(${e[1]}, 1) 100%)`,n.style.background=`linear-gradient(\n                to right,\n                rgba(${e[1]}, 0) 0%,\n                rgba(${e[1]}, 1) 100%)`,document.getElementById("fog-mobile-top").style.backgroundColor=`rgb(${e[1]})`,document.getElementById("fog-mobile-gradient").style.background=`linear-gradient(\n                to top,\n                rgba(${e[1]}, 0) 0%,\n                rgba(${e[1]}, 1) 100%)`;let i=0;s.forEach((e=>{i+=e}));const a=100*s[3]/i;t.style.width=`${15+a}%`,n.style.width=`${15+a}%`}else if(s){let e=0;if(s.forEach((t=>{e+=t})),e>0){const t=s.map((t=>1*t/e)),n=60*t[0],i=n+10,a=i+60*t[1],o=a+10,r=o+60*t[2],l=r+10;this.changeColors();const d=this.colors.map((e=>e.map((e=>e[0])).join(",")));["background-left","fog-top-left","fog-middle-left","fog-gradient-left"].forEach((e=>{document.getElementById(e).style.background=`linear-gradient(\n                            to right,\n                            rgba(${d[0]},1.0) ${n}%,\n                            rgba(${d[1]},1.0) ${i}% ${a}%,\n                            rgba(${d[2]},1.0) ${o}% ${r}%,\n                            rgba(${d[3]},1.0) ${l}%\n                        )`})),["background-right","fog-top-right","fog-middle-right","fog-gradient-right"].forEach((e=>{document.getElementById(e).style.background=`linear-gradient(\n                            to left,\n                            rgba(${d[0]},1.0) ${n}%,\n                            rgba(${d[1]},1.0) ${i}% ${a}%,\n                            rgba(${d[2]},1.0) ${o}% ${r}%,\n                            rgba(${d[3]},1.0) ${l}%\n                        )`}))}}}changeColors(){this.colors.forEach(((e,t)=>e.map(((e,s)=>{Math.random()>.8&&(e[1]=1===e[1]?-1:1);const n=t===this.colors.length-1?t:t+1,i=t===this.colors.length-1?250:this.colors[n][s][0];e[0]>i-5&&1===e[1]&&(e[1]=-1),e[0]<40&&-1===e[1]&&(e[1]=1),Math.random()>.8&&(e[0]+=e[1]*Math.floor(5*Math.random()))}))))}initializeColors(){const e=Math.floor(240*Math.random()),t=Math.floor(240*Math.random()),s=Math.floor(240*Math.random()),n=Math.floor(e+(255-e)*Math.random()),i=Math.floor(t+(255-t)*Math.random()),a=Math.floor(s+(255-s)*Math.random()),o=Math.floor(n+(255-n)*Math.random()),r=Math.floor(i+(255-i)*Math.random()),l=Math.floor(a+(255-a)*Math.random()),d=Math.floor(o+(255-o)*Math.random()),c=Math.floor(r+(255-r)*Math.random()),h=Math.floor(l+(255-l)*Math.random());this.colors=[[[e,1],[t,-1],[s,1]],[[n,-1],[i,1],[a,-1]],[[o,1],[r,-1],[l,1]],[[d,-1],[c,1],[h,-1]]]}initializeBackground(){if(!document.mobile){const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));["background-left","fog-top-left","fog-middle-left","fog-gradient-left"].forEach((t=>{document.getElementById(t).style.background=`linear-gradient(\n                    to right,\n                    rgba(${e[0]},1.0) 20%,\n                    rgba(${e[1]},1.0) 30% 45%,\n                    rgba(${e[2]},1.0) 55% 70%,\n                    rgba(${e[3]},1.0) 80%\n                )`})),["background-right","fog-top-right","fog-middle-right","fog-gradient-right"].forEach((t=>{document.getElementById(t).style.background=`linear-gradient(\n                    to left,\n                    rgba(${e[0]},1.0) 20%,\n                    rgba(${e[1]},1.0) 30% 45%,\n                    rgba(${e[2]},1.0) 55% 70%,\n                    rgba(${e[3]},1.0) 80%\n                )`}))}}initializeMobileBackground(){const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));document.getElementById("play-area").style.backgroundColor=`rgb(${e[2]})`,document.getElementById("background-left").style.background=`linear-gradient(\n            to left,\n            rgba(${e[1]}, 0) 0%,\n            rgba(${e[1]}, 1) 100%)`,document.getElementById("background-right").style.background=`linear-gradient(\n            to right,\n            rgba(${e[1]}, 0) 0%,\n            rgba(${e[1]}, 1) 100%)`,document.getElementById("fog-mobile").classList.remove("hidden"),document.getElementById("fog-mobile-top").style.backgroundColor=`rgb(${e[0]})`,document.getElementById("fog-mobile-gradient").style.background=`linear-gradient(\n            to top,\n            rgba(${e[0]}, 0) 0%,\n            rgba(${e[0]}, 1) 100%)`}}(G),Q=new class{constructor(e,t,s,n){this.masterInfo=e,this.addNote=t,this.makeTail=s,this.backgroundAnimator=n,this.lastLeft=performance.now(),this.lastMid=performance.now(),this.lastRight=performance.now(),this.lastLeftTail=performance.now(),this.lastMidTail=performance.now(),this.lastRightTail=performance.now(),this.leftSlides=["slide-left","slide-a"],this.rightSlides=["slide-b","slide-right"],this.rightId="slide-right",this.leftId="slide-left",this.lastAll={"slide-left":performance.now(),"slide-a":performance.now(),"slide-b":performance.now(),"slide-right":performance.now()},this.lastAlls=[],this.mostRecentNotes=e.mostRecentNotesOrTails,this.numToneVals=30,this.recentToneVals=[80],this.sideWithNotes=null,this.last=performance.now(),this.timeSinceLast=0,this.timesSinceLast=[0,0,0,0],this.lastArrs=[],this.gap=200,this.times=[],this.collectArrays=[],this.collectTimeArrays=[],this.timeArrayVariances=[],this.startTime=performance.now(),this.lastTime=performance.now(),this.stepTime=5,this.arrLength=2048,this.aveHillHeights=[],this.tallestTowers=[],this.toneVals=[],this.peakOffset=0,this.prev=!1,this.low=!1,this.lowIdx=!1,this.dir=1,this.doPreciseBetter=!0}writeTails(e,t,s){this.recentToneVals.length<16||t.forEach((n=>{const i=this.mostRecentNotes[n];if(i){const a=8;let o=i.val;o.length>8&&(o=o.slice(Math.floor(.25*o.length),Math.floor(.75*o.length)));let r=!1;const l=new Set;e.forEach((e=>{l.add(e[1])}));let d=0;const c=Math.ceil(o.length/6);o.forEach((e=>{const t=e[1];let s=!1;const n=[];for(let e=0;e<a;e++)n.push(t-e),n.push(t+e);n.forEach((e=>{l.has(e)&&(s=!0,l.delete(e),l.add(t))})),s&&(d+=1)}));let h=!1;i.isTail?h=!0:(h=!0,s.forEach((e=>{const t=new Set;e.forEach((e=>{t.add(e[1])}));let s=0;o.forEach((e=>{const n=e[1];let i=!1;const o=[];for(let e=0;e<a;e++)o.push(n-e),o.push(n+e);o.forEach((e=>{t.has(e)&&(i=!0,t.delete(e),t.add(n))})),i&&(s+=1)})),s<c&&(h=!1)})));let m=!0;if(i.isTail&&i.totalHeight>1.5*this.masterInfo.travelLength&&(m=!1),d>=c&&h&&m&&(r=!0),r){const e=performance.now();4===t.length?this.leftSlides.includes(n)?(this.lastLeft=e,this.lastAll[n]=e,this.makeTail(n,i)):(this.lastRight=e,this.lastAll[n]=e,this.makeTail(n,i)):3===t.length?n===this.rightId?(this.lastRight=e,this.lastAll[n]=e,this.makeTail(n,i)):n===this.leftId?(this.lastLeft=e,this.lastAll[n]=e,this.makeTail(n,i)):(this.lastMid=e,this.lastAll[n]=e,this.makeTail(n,i)):(this.lastAll[n]=e,this.makeTail(n,i))}else i.isTail&&i.totalHeight<.1*this.masterInfo.travelLength&&(i.cloud.remove(),i.note.remove(),i.parentNote.tail=null),this.mostRecentNotes[n]=null}}))}writeNotes(e,t,s,n,i=0){const a=performance.now()-i;for(this.times.push(a);this.times[0]<a-4e3;)this.times.shift();this.lastTime+=this.stepTime;let o=!1;const r=e,l=t;let d,c;if(this.timeArrayVariances.push(Math.max(...l)-Math.min(...l)),this.doPreciseBetter){let e=r[0],t=e,i=1;const l=[];r.forEach(((s,n)=>{if(s>0)if(s>e)-1===i&&(t=s,i=1);else if(1===i){const a=e-t;a>0&&l.push([a,n-1]),t=s,i=-1}else t=s;e=s})),l.sort(((e,t)=>e[0]>t[0]?1:-1));const h=.9*l.length,m=l.slice(h,l.length);this.tallestTowers.push(m);const u=m.map((e=>e[1])).sort(((e,t)=>e>t?1:-1));let g=0;for(let e=Math.floor(u.length/5);e<u.length;e++)g+=u[e]-u[e-1];let y=0;u.length>1&&(y=g/(u.length-1)),this.toneVals.push(y),this.aveHillHeights.push(w(m.map((e=>e[0])))),this.aveHillHeights.length>this.times.length&&(this.aveHillHeights.shift(),this.timeArrayVariances.shift(),this.tallestTowers.shift(),this.toneVals.shift());const p=[],f={};let v=this.aveHillHeights[0],b=1,I=v,E=0;for(let e=1;e<this.aveHillHeights.length;e++){const t=this.aveHillHeights[e];if(t>v)-1===b&&(I=v,E=e-1,b=1);else{if(1===b){const t=v-I;t>0&&(p.push([t,E]),f[E]=e-E)}I=t,E=e}v=t}p.sort(((e,t)=>e[0]>t[0]?1:-1));let L=0,B=0;for(;this.times[L]<a-1900;)L+=1,this.times[L]<a-2e3&&(B+=1);const T=f[L]+L;T&&(this.peakOffset=f[L]),c=this.tallestTowers[L+this.peakOffset],d=this.toneVals[T];const S=4e3/this.tallestTowers.length;let A=Math.ceil(200/S);if(this.masterInfo.sustainedNotes&&this.writeTails(this.tallestTowers[L+this.peakOffset],s,this.tallestTowers.slice(L+this.peakOffset+1,L+this.peakOffset+1+A)),this.timeArrayVariances[L]<15)return;Math.max(...this.aveHillHeights),Math.min(...this.aveHillHeights);const k=(this.aveHillHeights[this.aveHillHeights.length-1],{1:.95,2:.75,3:.5,4:0,5:0}[n]);p.slice(Math.floor(k*p.length),p.length-1).map((e=>e[1])).includes(L)&&(o=!0),this.lastAlls.push({"slide-left":a-this.lastAll["slide-left"],"slide-a":a-this.lastAll["slide-a"],"slide-b":a-this.lastAll["slide-b"],"slide-right":a-this.lastAll["slide-right"]}),this.lastAlls.length>this.times.length&&this.lastAlls.shift();const M=[Math.pow(w(r.slice(r.length-2048,r.length-1536)),1.5),Math.pow(w(r.slice(r.length-1536,r.length-1024)),1.5),Math.pow(w(r.slice(r.length-1024,r.length-512)),1.5),Math.pow(w(r.slice(r.length-512,r.length-256)),1.5)];this.lastArrs.push(M),this.lastArrs.length>8&&this.lastArrs.shift();const P=[];for(let e=0;e<M.length;e++)P.push(w(this.lastArrs.map((t=>t[e]))));this.backgroundAnimator.animateBackground(P)}if(o){const e=this.getSlideToUse(d,s.length);this.attemptNoteWrite({slideToUse:e,slideIds:s,noteVal:c,toneVal:d,addNote:this.addNote,marked:!1,mobile:!0,notesPerSecond:n})}}getSlideToUse(e,t){const s=this.recentToneVals.map((e=>e)).sort();let n=0;for(;e>s[n];)n+=1;if(4===t&&this.recentToneVals.length>7){const t=Math.max(...this.recentToneVals),s=Math.min(...this.recentToneVals),n=(1*t-s)/4;return e<n+s?"slide-left":e<2*n+s?"slide-a":e<3*n+s?"slide-b":"slide-right"}if(3===t&&this.recentToneVals.length>7){const t=Math.max(...this.recentToneVals),s=Math.min(...this.recentToneVals),n=(1*t-s)/3;return e<n+s?"slide-left":e<2*n+s?"slide-a":"slide-right"}if(2===t&&this.recentToneVals.length>7){const t=Math.max(...this.recentToneVals),s=Math.min(...this.recentToneVals);return e<(1*t-s)/2+s?"slide-left":"slide-right"}let i="slide-left";return 4===t?e>s[0]&&(i="slide-a",e>s[1]&&(i="slide-b",e>s[2]&&(i="slide-right"))):3===t?e>s[0]&&(i="slide-a",e>s[2]&&(i="slide-right")):e>s[1]&&(i="slide-right"),i}attemptNoteWrite(e){const{slideToUse:t,slideIds:s,noteVal:n,toneVal:i,addNote:a,marked:o,mobile:r,notesPerSecond:l}=e;let d=!1,c=this.gap;if(l>4&&(c*=.75),2===l&&(c*=1.5),1===l&&(c*=2),t){const e=performance.now();if(e-this.lastAll[t]>this.masterInfo.minNoteGap)if(r&&s.length>2)if(3===s.length){if(this.mostRecentNotes["slide-a"]&&this.mostRecentNotes["slide-a"].isTail&&t!==this.sideWithNotes)return;const s=e-this.lastLeft,i=e-this.lastMid,r=e-this.lastRight;t===this.rightId?(s>c||i>c)&&(a(t,n,o),d=!0,this.sideWithNotes=t,this.lastRight=e,this.lastAll[t]=e):t===this.leftId?(i>c||r>c)&&(a(t,n,o),d=!0,this.sideWithNotes=t,this.lastLeft=e,this.lastAll[t]=e):(s>c||r>c)&&(a(t,n,o),d=!0,this.lastMid=e,this.lastAll[t]=e)}else{const s=e-this.lastLeft,i=e-this.lastRight;this.leftSlides.includes(t)?s>c&&(a(t,n,o),d=!0,this.lastLeft=e,this.lastAll[t]=e):i>c&&(a(t,n,o),d=!0,this.lastRight=e,this.lastAll[t]=e)}else if(l<3){const s=e-this.lastLeft,i=e-this.lastRight;this.leftSlides.includes(t)?s>c&&(a(t,n,o),d=!0,this.lastLeft=e,this.lastAll[t]=e):i>c&&(a(t,n,o),d=!0,this.lastRight=e,this.lastAll[t]=e)}else a(t,n,o),d=!0,this.lastAll[t]=e}this.recentToneVals.push(i),this.lastValTime=performance.now(),this.recentToneVals.length>this.numToneVals&&this.recentToneVals.shift()}}(G,le,ae,J),Y=new class{constructor(e,t,s,n,i,a,o=4){this.masterInfo=e,this.delay=this.masterInfo.songDelay,this.recents=e.mostRecentNotesOrTails,this.notes=e.notes,this.allSlides=e.allSlides,this.slides=[this.allSlides[0],this.allSlides[1],this.allSlides[3]],this.notesPerSecond=2,this.targetTails=e.targetTails,this.targets=e.targets,this.targetBounds=e.targetBounds,this.addNote=n,this.makeTail=i,this.triggerMissedNote=a,this.noteWriter=t,this.backgroundAnimator=s,this.time=0,this.animating=!1,this.arrays=[];for(let e=0;e<o;e++)this.arrays.push([]);this.times=[],this.timeStep=5,this.lastTime=0,this.noteResults=[],this.notesHit=0,this.notesMissed=0,this.arrayNow=[1,1,1,1],this.currentSlider="a-slider",this.oldSliderPos=0,this.movingBothSliders=!1}setNotesPerSecond(e){this.notesPerSecond=e}setNumSlides(e){this.slides=2===e?[this.allSlides[0],this.allSlides[3]]:3===e?[this.allSlides[0],this.allSlides[1],this.allSlides[3]]:[this.allSlides[0],this.allSlides[1],this.allSlides[2],this.allSlides[3]]}recordNoteHit(){for(this.notesHit+=1,this.noteResults.push(!0);this.noteResults.length>50;)this.noteResults.shift()?this.notesHit-=1:this.notesMissed-=1;f(this.notesHit,this.notesMissed)}recordNoteMissed(){for(this.notesMissed+=2,this.noteResults.push(!1),this.noteResults.push(!1);this.noteResults.length>50;)this.noteResults.shift()?this.notesHit-=1:this.notesMissed-=1;f(this.notesHit,this.notesMissed)}runAnimation(e){this.time=performance.now(),this.animating=!0,this.animate(e)}stopAnimation(){this.animating=!1}animate(e){const{player:t,algorithm:s}=e,n=performance.now(),i=[];if(n-this.lastTime>35||!this.masterInfo.useShortSteps)i.push(n),this.lastTime=n;else{let e=this.lastTime+this.timeStep;for(;e<n;)i.push(e),e+=this.timeStep,this.lastTime=e}i.forEach((e=>{const s=n-e,i=this.delay+s;t.calibrateLag(i);const a=t.getDetailedFreqArray(),o=t.getDetailedTimeArray();this.noteWriter.writeNotes(a,o,this.slides,this.notesPerSecond,s)}));const a=n-this.time;this.time=n,function(e,t,s,n,i,a,o,r,l,d,c){const h=1*t*(d/1e3);if(s.forEach((e=>{const t=n[e];if(t){const s=t.position+h;t.position=s;const i=t.height-h;if(i<0){t.note.remove(),n[e]=null;const s=document.getElementById(`${e}-flash-sustain`);s&&(s.classList.add("light-off"),setTimeout((()=>{s.remove()}),500))}t.note.style.height=`${i}px`,t.height=i}})),c.masterInfo.sliderPos>1e5){let e="a-",t="b-";"b-slider"===c.currentSlider&&(e="b-",t="a-"),["slide-left","slide-a","slide-b","slide-right"].forEach((s=>{document.getElementById(s).id=`${e}${s}`,document.getElementById(`${t}${s}`).id=s}));const s="a-slider"===c.currentSlider?"a-slider":"b-slider";c.currentSlider="a-slider"===c.currentSlider?"b-slider":"a-slider",c.movingBothSliders=!0,c.oldSliderPos=c.masterInfo.sliderPos,setTimeout((()=>{c.movingBothSliders=!1,c.oldSliderPos=0,document.getElementById(s).style.top="0px"}),2e3),c.masterInfo.sliderPos=0}if(c.masterInfo.sliderPos+=h,c.movingBothSliders){const e="a-slider"===c.currentSlider?"b-slider":"a-slider";c.oldSliderPos+=h,document.getElementById(e).style.top=`${c.oldSliderPos}px`}document.getElementById(c.currentSlider).style.top=`${c.masterInfo.sliderPos}px`,c.oldSlider&&(c.oldSliderPosition+=h,c.oldSlider.style.top=`${c.oldSliderPosition}px`);for(const t of e){const s=t.position+h;if(t.position=s,t.tail){const e=t.tail.position+h;t.tail.position=e}!t.target&&s>a.top&&s<a.bottom&&(i[t.slideId].add(t),t.target=!0),s>a.bottom&&!0===t.target&&(t.target=!1,i[t.slideId].delete(t),o(),t.tail&&(t.tail.note.remove(),r[t.tail.slideId]=null)),s>l&&(t.note.remove(),e.delete(t))}}(this.masterInfo.notes,this.masterInfo.noteSpeed,this.slides,this.targetTails,this.targets,this.masterInfo.targetBounds,this.triggerMissedNote,this.recents,this.masterInfo.slideLength,a,this),this.animating&&requestAnimationFrame((()=>this.animate(e)))}}(G,Q,J,le,ae,ce),_=new class{constructor(e,t,s,n){this.masterInfo=e,this.song1=new Audio,this.song2=new Audio,this.playing1=!1,this.playing2=!1,this.arrayPlay=!1,this.timeStarted=!1,this.song2Timeout=!1,this.delay=e.songDelay,this.timeToStart2=this.delay,this.song1.addEventListener("ended",(()=>{this.playing1=!1})),this.song2.addEventListener("ended",(()=>{this.playing2=!1,this.timeToStart2=this.delay,this.restart(),n()})),this.waiting=!1,this.countdownCanceled=!1;const i=new AudioContext,a=i.createMediaElementSource(this.song1);this.detailedAnalyser=i.createAnalyser(),a.connect(this.detailedAnalyser),i.setSinkId({type:"none"}),this.detailedAnalyser.connect(i.destination),this.detailedAnalyser.fftSize=4096,this.detailedDataArray=new Uint8Array(this.detailedAnalyser.frequencyBinCount),this.freqArrays=[],this.times=[]}setPlayerReady(e){this.song1.oncanplaythrough=e}countdown(){const e=document.getElementById("rock-label");e.classList.add("countdown-label"),e.innerText="Ready",this.countdownCanceled=!1,setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="3"}),1e3),setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="2"}),2e3),setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="1"}),3e3),setTimeout((()=>{this.countdownCanceled||(e.innerText=""),e.classList.remove("countdown-label")}),4e3)}start(){this.masterInfo.songAtStart&&this.countdown(),this.masterInfo.songAtStart=!1,this.arrayPlay?this.songPiece.audio.play():this.song1.play(),this.playing1=!0,this.timeStarted=performance.now(),this.timeToStart2?(this.song2Timeout=setTimeout((()=>{this.song2.play(),this.playing2=!0,this.timeToStart2=!1,this.waiting=!1}),this.timeToStart2),this.waiting=!0):(this.song2.play(),this.playing2=!0)}pause(){this.playing2?(this.song2.pause(),this.playing2=!1,this.arrayPlay?this.songPiece.audio.pause():this.song1.pause(),this.playing1=!1):this.song1.playing&&(this.arrayPlay?this.songPiece.audio.pause():this.song1.pause(),this.song1.playing=!1,clearTimeout(this.song2Timeout),this.timeToStart2=performance.now()-timeStarted),this.countdownCanceled=!0}restart(){this.arrayPlay?(this.songPiece.audio.pause(),this.arrayPos=0,this.songPiece=this.piecesArray[this.arrayPos],this.song2.pause(),this.playing1=!1,this.playing2=!1,this.waiting&&(clearTimeout(this.song2Timeout),this.waiting=!1),this.timeToStart2=this.delay,this.song2.currentTime=0,this.masterInfo.songAtStart=!0,this.countdownCanceled=!0):(this.song1.pause(),this.song2.pause(),this.playing1=!1,this.playing2=!1,this.waiting&&(clearTimeout(this.song2Timeout),this.waiting=!1),this.timeToStart2=this.delay,this.song1.currentTime=0,this.song2.currentTime=0,this.masterInfo.songAtStart=!0,this.countdownCanceled=!0)}setSource(e,t=!1,s=!1){if(t)if(s){this.arrayPlay=!0,this.arrayPos=0;let t=0;s.forEach((e=>{null!==e.startTime&&(t+=1)})),this.piecesArray=s.slice(0,t),this.songPiece=this.piecesArray[this.arrayPos],this.piecesArray.forEach((e=>{e.audio.addEventListener("ended",(()=>{this.startNextPiece()}))})),this.song2.setAttribute("src",e),s.length>0&&(this.restart(),this.masterInfo.songAtStart=!0)}else this.piecesArray&&this.piecesArray.forEach((e=>{e.ctx&&e.ctx.close()})),this.piecesArray=null,this.songPiece=null;else this.arrayPlay=!1,this.restart(),this.song1.setAttribute("src",e),this.song2.setAttribute("src",e),this.masterInfo.songAtStart=!0}startNextPiece(){this.arrayPos+=1,this.piecesArray[this.arrayPos]&&(this.songPiece=this.piecesArray[this.arrayPos],this.songPiece.audio.play())}getDetailedFreqArray(){return this.arrayPlay?(this.songPiece.analyser.smoothingTimeConstant=0,this.songPiece.analyser.getByteFrequencyData(this.songPiece.array),this.songPiece.array.map((e=>e))):(this.detailedAnalyser.smoothingTimeConstant=0,this.detailedAnalyser.getByteFrequencyData(this.detailedDataArray),this.detailedDataArray.map((e=>e)))}getDetailedTimeArray(){return this.arrayPlay?(this.songPiece.analyser.smoothingTimeConstant=0,this.songPiece.analyser.getByteTimeDomainData(this.songPiece.array),this.songPiece.array.map((e=>e))):(this.detailedAnalyser.smoothingTimeConstant=0,this.detailedAnalyser.getByteTimeDomainData(this.detailedDataArray),this.detailedDataArray.map((e=>e)))}getDataFreqArray(){this.analyser.getByteFrequencyData(this.dataArray),this.freqArrays.push(this.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.delay;)this.times.shift(),this.freqArrays.shift();return this.dataArray}getDataFreqArrayDelayed(e=2e3){let t=0;for(;performance.now()-e>this.times[t]&&(t+=1,this.times[t]););return this.times[t]?this.freqArrays[t]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}setVolume(e){this.song2.volume=e}calibrateLag(e=this.delay){const t=1*e/1e3;this.arrayPlay?this.playing2&&this.songPiece.audio.currentTime<.5*this.songPiece.audio.duration&&(this.songPiece.audio.currentTime=this.song2.currentTime+t-this.songPiece.startTime):this.song1.currentTime>t&&(this.song1.currentTime=this.song2.currentTime+t)}}(G,"aintOverYou",32,(()=>{Y.stopAnimation(),r("button-restart"),G.songStreak>W&&(W=G.songStreak),document.getElementById("feedback").classList.remove("hidden");const e=1*G.songNotesHit/(G.songNotesHit+G.songNotesMissed);document.getElementById("percent-bar-inner-container").style.width=100*e+"%";const t=Math.round(1e3*e)/10;var s;"demo"===G.songMode&&(s=t,G.currentSong,new Promise((e=>{y().then((t=>{const n=`l${Y.notesPerSecond}s${Y.slides.length}`,i=G.songCode,a=t.progress[n][i];a?s>a&&(t.progress[n][i]=s):t.progress[n][i]=s,g(t).then((()=>{te.activateSongSelect(!1),e()}))}))}))),document.getElementById("feedback-percent").innerText=`Tap accuracy: ${t}%`,document.getElementById("feedback-streak").innerText=`Longest streak: ${W}`,document.getElementById("feedback-streak-overall").innerText=`Current streak: ${G.streak}`,document.getElementById("feedback-title").innerText=G.currentSong,function(e,t){const s=performance.now();t.forEach((e=>{document.getElementById(e).style.opacity="0"})),ue("percent-bar",t,s,1e3)}(0,["feedback-percent","feedback-streak","feedback-streak-overall"]),G.songNotesMissed=0,G.songNotesHit=0,G.songStreak=0})),X=new class{constructor(e,t){this.masterInfo=e,this.songDelay=t,this.queue=[],this.started=!1,this.current=null,this.muted=!1,this.freqArrays=[],this.times=[],this.blobStreaming=!1,this.blobs=[]}calibrateLag(e=this.songDelay){const t=1*e/1e3;this.player&&this.silentPlayer.currentTime>t&&(this.silentPlayer.currentTime=this.player.currentTime+t),this.current&&this.current.silentSong.currentTime>t&&(this.current.silentSong.currentTime=this.current.song.currentTime+t)}playOnDelay(e){e.silentSong.play();const t=this;setTimeout((()=>{t.currentAudio=e.song,e.song.play()}),this.songDelay)}getDetailedFreqArray(){return this.liveStream?(this.liveAnalyser.smoothingTimeConstant=.85,this.liveAnalyser.getByteFrequencyData(this.liveDataArray),this.liveDataArray.map((e=>e))):this.silentPlayer?(this.analyser.smoothingTimeConstant=.85,this.analyser.getByteFrequencyData(this.dataArray),this.dataArray.map((e=>e))):(this.current.analyser.smoothingTimeConstant=.85,this.current.analyser.getByteFrequencyData(this.current.dataArray),this.current.dataArray.map((e=>e)))}getDetailedTimeArray(){return this.liveStream?(this.liveAnalyser.smoothingTimeConstant=0,this.liveAnalyser.getByteTimeDomainData(this.liveDataArray),this.liveDataArray.map((e=>e))):this.silentPlayer?(this.analyser.smoothingTimeConstant=0,this.analyser.getByteTimeDomainData(this.dataArray),this.dataArray.map((e=>e))):(this.current.analyser.smoothingTimeConstant=0,this.current.analyser.getByteTimeDomainData(this.current.dataArray),this.current.dataArray.map((e=>e)))}getDataFreqArray(){if(this.liveStream){this.liveAnalyser.getByteFrequencyData(this.liveDataArray),this.freqArrays.push(this.liveDataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.songDelay;)this.times.shift(),this.freqArrays.shift();return this.liveDataArray}if(this.silentPlayer){this.analyser.getByteFrequencyData(this.dataArray),this.freqArrays.push(this.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.songDelay;)this.times.shift(),this.freqArrays.shift();return this.dataArray}if(this.current&&!this.muted){this.current.analyser.getByteFrequencyData(this.current.dataArray),this.freqArrays.push(this.current.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.songDelay;)this.times.shift(),this.freqArrays.shift();return this.current.dataArray}return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}getDataFreqArrayDelayed(e=2e3){let t=0;for(;performance.now()-e>this.times[t]&&(t+=1,this.times[t]););return this.times[t]?this.freqArrays[t]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}startNextRecording(){this.nextSilentPlayer.volume=0,this.nextSilentPlayer.play(),this.nextSilentPlayer.currentTime=this.silentPlayer.currentTime-1*this.nextDelay/1e3,this.correction=2-this.nextSilentPlayer.currentTime,this.nextSilentPlayer.volume=1,this.silentPlayer.volume=0,this.silentPlayer=this.nextSilentPlayer,this.analyser=this.nextAnalyser,setTimeout((()=>{this.nextPlayer.volume=0,this.nextPlayer.play(),this.nextPlayer.currentTime=this.player.currentTime-1*this.nextDelay/1e3,this.nextPlayer.play(),this.nextPlayer.volume=this.player.volume,this.player.volume=0,this.player=this.nextPlayer}),4e3),setTimeout((()=>{this.startNextRecording()}),this.nextDelay+1e3*this.correction)}setData(e,t=!1){if(console.log("data received"),this.started||(document.getElementById("initial-received").style.color="gray"),e.liveStream)return document.getElementById("initial-received").style.color="gray",setTimeout((()=>{document.getElementById("now-streaming").style.color="gray",setTimeout((()=>{document.getElementById("connecting-radio").classList.add("hidden")}),1e3)}),2e3),this.livePlayer&&this.livePlayer.pause(),this.liveStream=!0,this.livePlayer=e.player,this.livePlayer.play(),this.liveAnalyser=e.analyser,this.liveDataArray=e.dataArray,this.gain=e.gain,this.ctx=e.ctx,this.nowGain=e.nowGain,void(this.nowCtx=e.nowCtx);if(e.timeDelay){if(console.log("timeDelay recognized"),this.player){console.log("already have a player");const t=new Audio(`data:audio/x-wav;base64,${e.str}`),s=new Audio(`data:audio/x-wav;base64,${e.str}`),n=new AudioContext,i=n.createMediaElementSource(s);this.nextAnalyser=n.createAnalyser(),i.connect(this.nextAnalyser),n.setSinkId({type:"none"}),this.nextAnalyser.connect(n.destination),this.nextAnalyser.fftSize=4096,this.nextDataArray=new Uint8Array(this.nextAnalyser.frequencyBinCount);const a=()=>{s.removeEventListener("canplaythrough",a),this.nextPlayer=t,this.nextSilentPlayer=s,this.nextDelay=e.timeDelay};s.addEventListener("canplaythrough",a)}else{this.player=new Audio(`data:audio/x-wav;base64,${e.str}`),this.silentPlayer=new Audio(`data:audio/x-wav;base64,${e.str}`);const t=new AudioContext,s=t.createMediaElementSource(this.silentPlayer);this.analyser=t.createAnalyser(),s.connect(this.analyser),t.setSinkId({type:"none"}),this.analyser.connect(t.destination),this.analyser.fftSize=4096,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount);const n=()=>{this.silentPlayer.removeEventListener("canplaythrough",n),console.log("should hear music in 9 seconds"),document.getElementById("now-streaming").style.color="gray",setTimeout((()=>{this.silentPlayer.play(),setTimeout((()=>{this.player.play(),document.getElementById("connecting-radio").classList.add("hidden")}),4e3),setTimeout((()=>{this.startNextRecording()}),12e3)}),5e3)};this.silentPlayer.addEventListener("canplaythrough",n)}return}if(t){let t=!0;this.blobs.push(e),console.log(this.blobs.length);const s=new Blob(this.blobs,{type:"audio/ogg; codecs=opus"}),n=new FileReader;return n.onload=e=>{const s=btoa(e.target.result),n=new Audio(`data:audio/x-wav;base64,${s}`),i=new Audio(`data:audio/x-wav;base64,${s}`),a=new AudioContext,o=a.createMediaElementSource(i);this.analyser=a.createAnalyser(),o.connect(this.analyser),a.setSinkId({type:"none"}),this.analyser.connect(a.destination),this.analyser.fftSize=4096,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),i.addEventListener("canplaythrough",(()=>{t&&(this.player?(n.volume=0,i.volume=0,n.currentTime=this.player.currentTime,i.currentTime=this.silentPlayer.currentTime,n.play(),i.play(),n.volume=this.player.volume,i.volume=1,this.player.volume=0,this.silentPlayer.volume=0,this.player=n,this.silentPlayer=i):(this.silentPlayer=i,this.player=n,setTimeout((()=>{this.silentPlayer.play(),setTimeout((()=>{this.player.play(),document.getElementById("connecting-radio").classList.add("hidden")}),4e3),document.getElementById("now-streaming").style.color="gray"}),4e3)),t=!1)}))},n.readAsBinaryString(s),void(this.started=!0)}this.liveStreaming=!1;const s=JSON.parse(e),n=new AudioContext,i=new Audio(`data:audio/x-wav;base64,${s.str}`),a=n.createMediaElementSource(i),o=n.createAnalyser();a.connect(o),n.setSinkId({type:"none"}),o.connect(n.destination),o.fftSize=4096;const r=new Uint8Array(o.frequencyBinCount),l={song:new Audio(`data:audio/x-wav;base64,${s.str}`),notes:s.notes,time:s.time,silentSong:i,analyser:o,dataArray:r};if(this.queue.push(l),console.log("new chunk added to queue"),!this.started&&this.queue.length>1){d("stream"),console.log("starting music "+this.queue.length),this.startNextChunk(),document.getElementById("now-streaming").style.color="gray";const e=document.getElementById("song-label");"keep your shirt on"===e.innerText&&(e.innerText="streaming"),setTimeout((()=>{document.getElementById("connecting-radio").classList.add("hidden")}),2e3)}}startNextChunk(){this.queue.length<1?(console.log("music queue empty "+this.queue.length),document.getElementById("song-label").innerText="stream ended"):(this.current=this.queue.shift(),this.playOnDelay(this.current),this.muted&&(this.current.song.volume=0),console.log(this.current.time),setTimeout((()=>{this.startNextChunk()}),this.current.time),this.started=!0)}setVolume(e){this.currentAudio&&(this.currentAudio.volume=e),this.current&&(this.current.song.volume=e),this.player&&(this.player.volume=e),this.livePlayer&&(this.livePlayer.volume=e)}start(){this.liveStream?this.ctx.resume():this.setVolume(1),this.muted=!1}stop(){this.liveStream?this.ctx.suspend():this.setVolume(1),this.muted=!0}stopStream(){this.livePlayer&&(this.livePlayer.pause(),this.livePlayer=null)}}(G,G.songDelay),Z=new class{constructor(e,t){this.masterInfo=e,this.streamPlayer=t,this.radioAudio=new Audio,this.radioAudio.crossOrigin="anonymous",this.listening=!1,this.chunksA=[],this.chunksB=[],this.times={A:0,B:0},this.timestamp=performance.now(),this.startTime=0,this.endTime=0,this.recorderA=null,this.recorderB=null,this.stations={kingFM:{name:"classical king FM",stream:"https://classicalking.streamguys1.com/king-fm-aac-128k"},mvn925:{name:"movin' 92.5",stream:"https://23093.live.streamtheworld.com/KQMVFM.mp3?dist=hubbard&source=hubbard-web&ttag=web&gdpr=0"},unsung80s:{name:"Unsung 80s",stream:"https://unsung80s.out.airtime.pro/unsung80s_a"},beat90s:{name:"The beat",stream:"https://ice10.securenetsystems.net/AM1380?playSessionID=1C5D8230-00FD-2EFE-2AEE4302B829B5F3"},"100hitz":{name:"100 hitz",stream:"https://pureplay.cdnstream1.com/6045_128.mp3"},mlelive:{name:"MLE live",stream:"https://listen.radioking.com/radio/114610/stream/462118"},chetFM:{name:"93.5 Chet FM",stream:"https://ice23.securenetsystems.net/KDJF?playSessionID=1CE4C155-F05D-ADFF-15CD1D9351B467C0"},scooter:{name:"Scooterist radio",stream:"https://listen.radioking.com/radio/214267/stream/257398?1709875088135"},"1234gr":{name:"1234 GR",stream:"https://radio1234gr.radioca.st/live"},hawk:{name:"Hawk classic rock",stream:"https://ice6.securenetsystems.net/KRSE?playSessionID=1D6EEF83-C785-2F70-5A76B4CD63C85056"}},this.stationInfo=this.stations.hawk,this.activateStationSelection()}activateStationSelection(){const e=document.getElementById("select-station"),t=Object.keys(this.stations);for(let s=0;s<t.length;s++){const n=t[s],i=document.createElement("option");i.value=n,i.innerText=this.stations[n].name,"hawk"===n&&(i.selected="selected"),e.appendChild(i)}e.addEventListener("change",(()=>{const t=e.value;this.masterInfo.radioCode=t,this.stationInfo=this.stations[t],this.radioAudio.setAttribute("src",this.stationInfo.stream),document.getElementById("song-label").innerText=this.stationInfo.name,this.masterInfo.currentSong=this.stationInfo.name,this.stopListening(),this.streamPlayer.stop()}))}stopListening(){this.listening&&(this.streamPlayer.stopStream(),this.listening=!1)}startListening(){if(this.listening)return;this.listening=!0,document.getElementById("acquiring").style.color="transparent",document.getElementById("initial-received").style.color="transparent",document.getElementById("now-streaming").style.color="transparent",document.getElementById("connecting-radio").classList.remove("hidden"),document.getElementById("connecting-radio").classList.add("menu"),document.getElementById("acquiring").style.color="gray";const e=new Audio(this.stationInfo.stream);e.crossOrigin="anonymous",e.addEventListener("canplaythrough",(()=>{const t=new AudioContext,s=t.createMediaElementSource(e),n=t.createDelay(4);n.delayTime.setValueAtTime(4,e.currentTime),s.connect(n),n.connect(t.destination);const i=new AudioContext,a=i.createMediaStreamSource(e.captureStream()),o=i.createAnalyser();a.connect(o),i.setSinkId({type:"none"}),o.connect(i.destination),o.fftSize=4096;const r=new Uint8Array(o.frequencyBinCount);this.streamPlayer.setData({liveStream:!0,player:e,analyser:o,dataArray:r,ctx:t,nowCtx:i})}))}switchToB(){this.times.B=performance.now(),this.recorderB.start()}switchToA(){this.times.A=performance.now(),this.recorderA.start()}}(G,X),ee=new class{constructor(){this.barPos=0}startBarAnimate(e,t){const s=e-this.barPos,n=performance.now()+t,i=t/500,a=s/Math.ceil(i),o=setInterval((()=>{h(this.barPos+a),this.barPos+=a,(performance.now()>n||this.barPos>e)&&clearInterval(o)}),500)}animateBar(){const e=performance.now();e>this.endTime&&(this.animating=!1);const t=e-this.lastTime,s=this.endTime>e?t/(this.endTime-e):0;console.log("this: "+s);const n=this.endPos-this.barPos,i=100*(this.barPos+s*n);h(i),this.barPos=i,this.lastTime=e,this.animating&&requestAnimationFrame((()=>{this.animateBar()}))}convertToM4a(e){return new Promise((t=>{this.startBarAnimate(25,2e3);const s=new Audio(`data:audio/x-wav;base64,${e}`);let n=!1;s.oncanplaythrough=()=>{if(!n){n=!0;const i=s.duration,a=Math.ceil(i/8);this.startBarAnimate(100,5e3+1e3*a),setTimeout((()=>{m("Keep your shirt on")}),15e3),setTimeout((()=>{m("m4a loads faster...")}),4e3);const o=Math.ceil(i/a),r=[];for(let e=0;e<o;e++)r.push(null);let l=0;for(let s=0;s<o;s++){const n=s*a,i=new Audio(`data:audio/x-wav;base64,${e}`);let d=!1;i.oncanplaythrough=()=>{if(!d){d=!0,i.currentTime=n;const e=new AudioContext,c=e.createMediaStreamDestination(),m=new MediaRecorder(c.stream),u=e.createMediaElementSource(i),g=[];u.connect(c),i.play();const y=i.currentTime;m.start(),setTimeout((()=>{m.stop(),i.pause()}),1e3*a),m.ondataavailable=e=>{g.push(e.data)},m.onstop=()=>{const n=new Blob(g,{type:"audio/ogg; codecs=opus"}),i=new FileReader;i.onload=n=>{const i=btoa(n.target.result),a=new Audio(`data:audio/x-wav;base64,${i}`),d=new AudioContext,c=d.createMediaElementSource(a),m=d.createAnalyser();c.connect(m),d.setSinkId({type:"none"}),m.connect(d.destination),m.fftSize=4096;const u=new Uint8Array(m.frequencyBinCount);let g=!1;a.oncanplaythrough=()=>{g||(e.close(),g=!0,r[s]={audio:a,startTime:y,analyser:m,array:u,ctx:d},l+=1,l===o&&(setTimeout((()=>{h(0),this.barPos=0}),500),t(r)))}},i.readAsBinaryString(n)}}}}}}}))}},te=new class{constructor(e,t,s,n,i){this.player=t,this.animator=n,this.fileConverter=i,this.masterInfo=e,this.streamPlayer=s,this.activateSongSelect(),this.activateSettings(),this.activateLevelSelector(),this.activateSlidesSelector((e=>{this.animator.setNumSlides(e)})),this.activateSongControls(),this.activateSongUpload()}activateSongSelect(e=!0){document.getElementById("stages").innerText="";const t=this.animator.notesPerSecond,s=this.animator.slides.length;document.getElementById("level-sub-title").innerText=`${{1:"practice",2:"easy",3:"medium",4:"hard",5:"crazy"}[t]} / ${s} slides`;const n=`l${t}s${s}`;y().then((t=>{const s=t.progress[n],i=Object.keys(s);let a=!0,o=null;I.forEach(((e,t)=>{const n=document.createElement("div");n.classList.add("stage");const l=document.createElement("div");l.classList.add("stage-title"),l.innerText=`Stage ${t+1}`,n.appendChild(l),document.getElementById("stages").appendChild(n);let d=!0;e.forEach((e=>{const t=document.createElement("div");t.classList.add("song-title-container"),t.id=e;const l=document.createElement("div");l.classList.add("song-mark");const c=document.createElement("div");c.classList.add("song-title");const h=document.createElement("div");if(h.classList.add("song-score"),c.innerText=E[e],i.includes(e))if(h.innerText=`${s[e]}%`,s[e]<90){o||(o=e),h.classList.add("song-score-fail");const t=document.createElement("div");t.classList.add("red-x-a");const s=document.createElement("div");s.classList.add("red-x-b"),l.appendChild(t),l.appendChild(s),d=!1}else{const e=document.createElement("div");e.classList.add("green-check"),l.appendChild(e)}else d=!1,o||(o=e);t.appendChild(l),t.appendChild(c),t.appendChild(h),n.appendChild(t),a&&t.addEventListener("click",(()=>{this.masterInfo.audioLoaded=!1,document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.remove("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))})),document.getElementById("choose-song-menu").classList.add("hidden"),document.getElementById("main-menu").classList.remove("hidden"),document.getElementById("song-to-play").innerText=E[e],fetch(`./songStrings/${e}.txt`).then((t=>{t.text().then((t=>{this.masterInfo.currentSong=E[e],this.masterInfo.songCode=e,this.animator.stopAnimation(),this.player.pause(),this.player.setSource(`data:audio/x-wav;base64,${t}`),r("button-play"),document.getElementById("song-label").innerText=this.masterInfo.currentSong,u(this.masterInfo)}))}))}))})),a||n.classList.add("stage-locked"),d||(a=!1)})),this.masterInfo.defaultSong=o,this.masterInfo.songCode=o,e&&(document.getElementById("song-to-play").innerText=E[o])}))}activateSongUpload(){document.getElementById("file-input").addEventListener("change",(e=>{this.player.pause(),this.animator.stopAnimation(),function(e="loading..."){document.getElementById("loading-text").innerHTML=e,document.getElementById("loading").classList.remove("hidden"),h(0)}(),document.getElementById("close-and-play").classList.add("hidden");const t=e.target.files[0],s=new FileReader;s.onload=t=>{const s=btoa(t.target.result),n=e.target.files[0].name.split("");if(".m4a"===n.slice(n.length-4,n.length).join("")){const t=`data:audio/x-wav;base64,${s}`;this.animator.stopAnimation(),this.player.pause(),this.player.setSource(t),r("button-play"),u(this.masterInfo),this.masterInfo.currentSong=e.target.files[0].name,document.getElementById("song-label").innerText=this.masterInfo.currentSong,c(),document.getElementById("close-and-play").classList.remove("hidden")}else this.player.setSource(`data:audio/x-wav;base64,${s}`,!0,!1),this.fileConverter.convertToM4a(s).then((t=>{const n=`data:audio/x-wav;base64,${s}`;this.animator.stopAnimation(),this.player.pause(),this.player.setSource(n,!0,t),r("button-play"),u(this.masterInfo),this.masterInfo.currentSong=e.target.files[0].name,document.getElementById("song-label").innerText=this.masterInfo.currentSong,c(),document.getElementById("close-and-play").classList.remove("hidden"),this.masterInfo.audioLoaded=!0}))},s.readAsBinaryString(t)}))}activateSongControls(){t("button-play",(()=>{this.playFunction()})),t("button-pause",(()=>{this.pauseFunction()})),t("button-restart",(()=>{this.restartFunction()})),this.masterInfo.spaceFunction=()=>{this.playFunction()}}playFunction(){this.masterInfo.streaming||"radio"===this.masterInfo.songMode?(this.streamPlayer.start(),this.animator.runAnimation({player:this.streamPlayer,algorithm:this.masterInfo.algorithm})):(this.player.start(),this.animator.runAnimation({player:this.player,algorithm:this.masterInfo.algorithm})),r("button-pause"),this.masterInfo.spaceFunction=()=>{this.pauseFunction()}}pauseFunction(){this.masterInfo.streaming||"radio"===this.masterInfo.songMode?(this.streamPlayer.stop(),u(this.masterInfo)):this.player.pause(),this.animator.stopAnimation(),r("button-play"),this.masterInfo.spaceFunction=()=>{this.playFunction()}}restartFunction(){this.player.restart(),this.animator.stopAnimation(),r("button-play"),u(this.masterInfo),this.masterInfo.spaceFunction=()=>{this.playFunction()}}activateSlidesSelector(e){[["slides-2",2],["slides-3",3],["slides-4",4]].forEach((t=>{const s=document.getElementById(t[0]);s.addEventListener("click",(()=>{this.deselectSlides(),this.selectSlides(t[1],e),s.classList.add("level-selected"),this.activateSongSelect(!1)}))})),document.getElementById("slides-3").classList.add("level-selected"),this.selectSlides(3,e)}deselectSlides(){["slides-2","slides-3","slides-4"].forEach((e=>{document.getElementById(e).classList.remove("level-selected")}))}selectSlides(e,t){const s=document.getElementById("slide-a"),n=document.getElementById("slide-b"),i=document.getElementById("a-slide-a"),a=document.getElementById("a-slide-b"),o=document.getElementById("b-slide-a"),r=document.getElementById("b-slide-b"),l=document.getElementById("clear-slide-a"),d=document.getElementById("clear-slide-b"),c=document.getElementById("dummy-a"),h=document.getElementById("dummy-b"),m=document.getElementById("dummy-tapper-a-container"),u=document.getElementById("dummy-tapper-b-container"),g=document.getElementById("slides-container");2===e&&(t(2),s&&(s.classList.add("hidden"),n.classList.add("hidden")),i&&(i.classList.add("hidden"),a.classList.add("hidden")),o&&(o.classList.add("hidden"),r.classList.add("hidden")),l.classList.add("hidden"),d.classList.add("hidden"),c.classList.add("hidden"),h.classList.add("hidden"),m.classList.add("hidden"),u.classList.add("hidden"),g.classList.remove("three-wide-slides-container"),g.classList.remove("four-wide-slides-container")),3===e&&(t(3),document.getElementById("slides-container").classList.add("three-wide-slides-container"),s&&(s.classList.remove("hidden"),n.classList.add("hidden")),i&&(i.classList.remove("hidden"),a.classList.add("hidden")),o&&(o.classList.remove("hidden"),r.classList.add("hidden")),l.classList.remove("hidden"),d.classList.add("hidden"),c.classList.remove("hidden"),h.classList.add("hidden"),m.classList.remove("hidden"),u.classList.add("hidden"),g.classList.add("three-wide-slides-container"),g.classList.remove("four-wide-slides-container")),4===e&&(t(4),s&&(s.classList.remove("hidden"),n.classList.remove("hidden")),i&&(i.classList.remove("hidden"),a.classList.remove("hidden")),o&&(o.classList.remove("hidden"),r.classList.remove("hidden")),l.classList.remove("hidden"),d.classList.remove("hidden"),c.classList.remove("hidden"),h.classList.remove("hidden"),m.classList.remove("hidden"),u.classList.remove("hidden"),g.classList.remove("three-wide-slides-container"),g.classList.add("four-wide-slides-container"))}activateLevelSelector(){[["level-1",1],["level-2",2],["level-3",3],["level-4",4],["level-5",5]].forEach((e=>{t(e[0],(()=>{["level-1","level-2","level-3","level-4","level-5"].forEach((e=>{a(e,"level-selected")})),this.animator.setNotesPerSecond(e[1]),n(e[0],"level-selected"),this.activateSongSelect(!1)}))})),n("level-2","level-selected")}activateSettings(){t("show-settings",(()=>{l("settings")})),t("save-settings",(()=>{this.masterInfo.waitingForKey||d("settings")}));const e=[["change-left","left-key"],["change-a","a-key"],["change-b","b-key"],["change-right","right-key"]];for(let n=0;n<e.length;n++)s(e[n][1],this.masterInfo.tapperKeys[n]),t(e[n][0],(()=>{s(e[n][1],"-"),document.getElementById("change-key-message").innerText="press a key",document.getElementById("save-settings").style.opacity="0.5",this.masterInfo.waitingForKey=[e[n][1],n]}));[["toggle-background","animatedBackground","background-title"],["toggle-sustained","sustainedNotes","sustained-title"],["toggle-calibration","autoCalibrating","calibration-title"]].forEach((e=>{t(e[0],(()=>{this.masterInfo[e[1]]?(this.masterInfo[e[1]]=!1,document.getElementById(`${e[0]}-ball`).classList.add("toggle-ball-off"),document.getElementById(e[2]).style.opacity="0.5","toggle-calibration"===e[0]&&(this.masterInfo.autoAdjustment=0)):(this.masterInfo[e[1]]=!0,document.getElementById(`${e[0]}-ball`).classList.remove("toggle-ball-off"),document.getElementById(e[2]).style.opacity="1"),y().then((t=>{t[e[1]]=this.masterInfo[e[1]],g(t)}))}))}));const n=document.getElementById("reset-button"),i=document.getElementById("reset-checkbox");i.addEventListener("change",(()=>{i.checked?n.disabled=!1:n.disabled=!0})),n.addEventListener("click",(()=>{y().then((e=>{e.progress={l1s2:{},l1s3:{},l1s4:{},l2s2:{},l2s3:{},l2s4:{},l3s2:{},l3s3:{},l3s4:{},l4s2:{},l4s3:{},l4s4:{},l5s2:{},l5s3:{},l5s4:{}},g(e),n.disabled="disabled",i.checked=!1,this.activateSongSelect()}))}))}toggleFullscreen(){return new Promise((e=>{document.isFullscreen?document.exitFullscreen().then((()=>{e()})):document.getElementById("game-container").requestFullscreen().then((()=>{e()}))}))}recalculateLengths(){setTimeout((()=>{if(o()){const e=document.getElementById("game-container").clientHeight;this.masterInfo.travelLength=b.mobile.travelLength*e;const t=Math.floor(this.masterInfo.travelLength/(this.masterInfo.songDelay/1e3/2));this.masterInfo.targetBounds.top=b.mobile.targetBounds.top*this.masterInfo.travelLength,this.masterInfo.targetBounds.bottom=b.mobile.targetBounds.bottom*this.masterInfo.travelLength,this.masterInfo.noteSpeed=t,this.masterInfo.maxTailLength=1*b.mobile.maxTailLength*this.masterInfo.travelLength,this.masterInfo.slideLength=1.3*this.masterInfo.travelLength}else{const e=document.getElementById("game-container").clientHeight,t=document.getElementById("game-container").clientWidth;let s=Math.min(t,e);this.masterInfo.vMin=s,this.masterInfo.slideLength=1.5*s,this.masterInfo.travelLength=1.365*s;const n=1*this.masterInfo.travelLength/(this.masterInfo.songDelay/1e3/2);this.masterInfo.targetBounds.top=b.mobile.targetBounds.top*this.masterInfo.travelLength,this.masterInfo.targetBounds.bottom=b.mobile.targetBounds.bottom*this.masterInfo.travelLength,this.masterInfo.noteSpeed=n,this.masterInfo.maxTailLength=1*b.mobile.maxTailLength*this.masterInfo.travelLength,this.masterInfo.slideLength=1.3*this.masterInfo.travelLength}}),500)}}(G,_,X,Y,ee),se=new class{constructor(e,t,s,n,i){this.masterInfo=e,this.controlsManager=t,this.stationManager=n,this.player=s,this.streamPlayer=i,this.menus=["source-menu","main-menu","feedback","choose-song-menu"],this.mainMenuOptions=["choose-song-button","upload-song-button","select-station-button","show-stream-modal-button"],this.activateMenuShowButtons(),this.activateSourceMenuButtons(),this.activateMainMenu(),this.activateFeedbackMenu(),this.activateGiveFeedbackMenu(),this.hideMenus()}activateGiveFeedbackMenu(){t("open-feedback-link",(()=>{document.userFeedbackOpen=!0,document.getElementById("give-feedback-modal").classList.remove("hidden"),document.getElementById("give-feedback-modal").classList.add("menu"),document.getElementById("modal-background").classList.remove("hidden"),document.getElementById("settings-modal").classList.add("hidden")})),t("cancel-give-feedback",(()=>{document.getElementById("give-feedback-modal").classList.add("hidden"),document.getElementById("give-feedback-modal").classList.remove("menu"),document.getElementById("modal-background").classList.add("hidden"),document.getElementById("settings-modal").classList.remove("hidden"),document.userFeedbackOpen=!1})),t("submit-give-feedback",(()=>{const e=document.getElementById("feedback-message").value;if(e.length<3)alert("Cannot submit empty message!");else{document.getElementById("cancel-give-feedback").disabled="disabled",document.getElementById("submit-give-feedback").disabled="disabled";let t=document.getElementById("feedback-email").value;t.length<1&&(t="none"),fetch("https://beatburner.com/api/feedback.php",{method:"POST",body:JSON.stringify({message:e,email:t})}).then((()=>{document.getElementById("give-feedback-modal").innerHTML="Thanks!",setTimeout((()=>{document.getElementById("give-feedback-modal").classList.add("hidden"),document.getElementById("give-feedback-modal").classList.remove("menu"),document.getElementById("settings-modal").classList.remove("hidden"),document.userFeedbackOpen=!1}),1e3)}))}}))}activateFeedbackMenu(){t("replay",(()=>{this.player.restart(),this.controlsManager.playFunction(),this.hideMenus()})),document.getElementById("no-replay").addEventListener("click",(()=>{"demo"===this.masterInfo.songMode?this.showMenu("choose-song-menu"):this.showMenu("main-menu")}))}activateMainMenu(){document.getElementById("choose-song-button").addEventListener("click",(()=>{document.getElementById("choose-song-menu").classList.remove("hidden"),document.getElementById("main-menu").classList.add("hidden")})),t("close-and-play",(()=>{this.hideMenus(),"radio"===this.masterInfo.songMode?this.stationManager.startListening():this.controlsManager.playFunction()}))}activateSourceMenuButtons(){t("source-demo-songs",(()=>{this.masterInfo.songMode="demo",this.setMainMenuOption("choose-song-button"),this.masterInfo.audioLoaded||(document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.remove("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))})),this.masterInfo.defaultSong&&fetch(`./songStrings/${this.masterInfo.defaultSong}.txt`).then((e=>{e.text().then((e=>{this.masterInfo.currentSong=E[this.masterInfo.defaultSong],this.player.pause(),this.player.setSource(`data:audio/x-wav;base64,${e}`),r("button-play"),document.getElementById("song-label").innerText=this.masterInfo.currentSong,killAllNotes(this.masterInfo),this.masterInfo.defaultSong=null}))}))),this.showMenu("main-menu"),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening()})),t("source-upload",(()=>{this.masterInfo.songMode="upload",this.setMainMenuOption("upload-song-button"),this.masterInfo.audioLoaded||(document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))}))),this.showMenu("main-menu"),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening()})),t("source-radio",(()=>{document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.songMode="radio",this.setMainMenuOption("select-station-button"),this.showMenu("main-menu"),this.masterInfo.currentSong="Unsung 80s",document.getElementById("close-and-play").classList.remove("hidden")})),t("source-streaming",(()=>{document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.songMode="stream",this.setMainMenuOption("show-stream-modal-button"),this.showMenu("main-menu"),l("stream"),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening()})),t("show-stream-modal-button",(()=>{l("stream")}))}setMainMenuOption(e){this.mainMenuOptions.forEach((e=>{document.getElementById(e).classList.add("hidden")})),document.getElementById(e).classList.remove("hidden")}activateMenuShowButtons(){t("show-menu",(()=>{this.showMenu("main-menu"),this.player.pause(),this.streamPlayer.stop(),this.player.countdownCanceled=!0})),t("show-source-menu",(()=>{this.showMenu("source-menu"),this.player.pause(),this.streamPlayer.stop(),this.stationManager.stopListening()}))}showMenu(e){this.hideMenus(),document.getElementById(e).classList.remove("hidden")}hideMenus(){this.menus.forEach((e=>{document.getElementById(e).classList.add("hidden")}))}}(G,te,_,Z,X);function ne(e){document.getElementById(e).style.backgroundColor="rgba(168,0,93,0.2)",K[e]=!1;const t={"tapper-left":"slide-left","tapper-a":"slide-a","tapper-b":"slide-b","tapper-right":"slide-right"},s=U[t[e]];s&&(U[t[e]]=null,s.height>.1*C&&_.setVolume(.3),s.note.remove(),q[t[e]]=null);const n=document.getElementById(`${t[e]}-flash-sustain`);n&&n.remove()}function ie(e,t,s){K[e]=!0;let n=500,i=0,a=null;if(j.forEach((e=>{if(t===e.slideId){const t=e.position-G.travelLength;Math.abs(t)<n&&(a=e,n=t,t<80&&(i+=1))}})),G.autoCalibrating){const e=.1*G.travelLength,t=.1*G.travelLength;1===i&&Math.abs(n)<e&&(G.autoAdjustment+=n/(10*j.size)*1,G.autoAdjustment=Math.max(G.autoAdjustment,-1*t),G.autoAdjustment=Math.min(G.autoAdjustment,1*t))}document.getElementById(e).style.backgroundColor="rgba(255, 166, 0, 0.2)";const o=V[t];if(0===o.size&&ce(),o.has(a)){j.delete(a),a.note.remove(),a.note.classList.add(s),V[t].delete(a);let n=!1;if(a.tail){n=!0,U[t]=a.tail,a.tail.note.classList.add("tail-active"),a.tail.cloud.classList.remove("hidden");const s=document.createElement("div");s.classList.add("note-lighted");const i=document.createElement("div");i.classList.add("note-middle-lighted");const o=document.createElement("div");o.appendChild(s),o.appendChild(i),document.getElementById(`dummy-${e}`).appendChild(o),o.classList.add("flash-sustain"),o.id=`${t}-flash-sustain`;const r=G.travelLength-a.tail.position;a.tail.note.style.height=`${r}px`,a.tail.height=r}!function(e,t,s){if(G.streaming?X.setVolume(1):"radio"!==G.songMode&&_.setVolume(1),!s){const e=document.createElement("div");e.classList.add("note-lighted");const s=document.createElement("div");s.classList.add("note-middle-lighted");const n=document.createElement("div");n.appendChild(e),n.appendChild(s),document.getElementById(`dummy-${t}`).appendChild(n),n.classList.add("flash"),setTimeout((()=>{n.remove()}),1e3)}if(Y.recordNoteHit(),G.streak+=1,G.songStreak+=1,G.streak<100){const e=document.createElement("div");e.classList.add("hit"),document.getElementById("streak-channel").appendChild(e)}G.songNotesHit+=1,document.getElementById("song-label");const n=document.getElementById("rock-label");100===G.streak&&(n.innerHTML="100 NOTE <br> STREAK!",n.classList.add("rock-label"),de=!0,setTimeout((()=>{n.classList.remove("rock-label"),n.innerHTML="",de=!1}),1300),document.getElementById("streak-channel").classList.add("streak-channel-lit")),200===G.streak&&(document.getElementById("slides").classList.add("on-fire"),n.innerHTML="ON FIRE!",n.classList.add("rock-label"),de=!0,setTimeout((()=>{n.classList.remove("rock-label"),n.innerHTML="",de=!1}),1300)),G.streak>200&&(de||(n.classList.add("static-rock"),n.innerText=G.streak)),1e3===G.streak&&(n.innerHTML="HOLY SHIT!",de=!0,setTimeout((()=>{de=!1}),2e3))}(0,e,n)}}function ae(e,t){if(t.isTail){const e=-0,s=t.position-e;t.totalHeight=t.totalHeight+s;const n=t.height+s;return t.note.style.height=`${n}px`,t.note.style.top=e-G.sliderPos+"px",t.height=n,t.position=e,t}{const s=document.createElement("div");s.classList.add("note-tail");const n=-0;s.style.top=`${-1*G.sliderPos+n}px`;const i=t.position-n;s.style.height=`${i}px`;const a=document.createElement("div"),o={note:s,position:n,height:i,totalHeight:i,slideId:e,target:!1,val:t.val,isTail:!0,cloud:a,parentNote:t,tail:null};return t.tail=o,a.classList.add("cloud-tail"),a.classList.add("hidden"),s.appendChild(a),document.getElementById(e).appendChild(s),q[e]=o,o}}new class{constructor(e,t){this.masterInfo=e,document.masterInfo=e,this.streamPlayer=t,document.streamPlayer=t,this.connection=new RTCPeerConnection,this.channel=this.connection.createDataChannel("channel"),this.channel.onopen=this.handleChannelStatusChange,this.channel.onclose=this.handleChannelStatusChange,this.streamId=0,this.nextSendMessage=0,this.nextReceiveMessage=0,document.getElementById("connect-stream-button").addEventListener("click",(()=>{console.log("Trying to connect"),v("attempting to connect");const e=document.getElementById("enter-stream-id").value;this.connect(e)})),document.getElementById("cancel-stream-button").addEventListener("click",(()=>{document.getElementById("stream-modal").classList.add("hidden"),document.getElementById("modal-background").classList.add("hidden")})),this.receiveChannel=null,this.connection.ondatachannel=this.receiveChannelCallback,this.connection.onicecandidate=e=>{if(e.candidate){console.log("sending candidate");const t={type:"candidate",candidate:e.candidate};this.sendMessage(JSON.stringify(t))}},this.connection.addEventListener("icegatheringstatechange",(e=>{console.log("ICE gathering state change: "+e.target.iceGatheringState)}))}dealWithMessage(e){const t=JSON.parse(e);v("communication established"),"candidate"===t.type&&(console.log("received candidate"),this.connection.addIceCandidate(t.candidate)),"offer"===t.type&&(console.log("received offer"),this.connection.setRemoteDescription(t.offer).then((()=>{this.connection.createAnswer().then((e=>{this.connection.setLocalDescription(e).then((()=>{const t={type:"answer",answer:e};this.sendMessage(JSON.stringify(t))}))}))})))}connect(e){this.streamId=e;let t=0;const s=setInterval((()=>{this.getMessages(),t+=1,t>30&&(clearInterval(s),console.log("timed out"),v("could not connect")),"open"===this.channel.readyState&&(v("connected to source"),setTimeout((()=>{v("listening for music")}),1e3),clearInterval(s))}),2e3)}getMessages(){console.log("looking for a message");const e=`${this.streamId}fromHost${this.nextReceiveMessage}`;var t;(t=e,new Promise((e=>{fetch("https://beatburner.com/api/",{method:"POST",body:JSON.stringify({action:"retrieve",name:t})}).then((t=>{t.json().then((t=>{t.value?e(t.value):e(!1)}))}))}))).then((e=>{e&&(this.dealWithMessage(e),this.nextReceiveMessage+=1,this.getMessages())}))}sendMessage(e){const t=`${this.streamId}fromRemote${this.nextSendMessage}`;var s,n;s=t,n=e,new Promise((e=>{fetch("https://beatburner.com/api/",{method:"POST",body:JSON.stringify({action:"set",name:s,value:n})}).then((t=>{t.json(t).then((t=>{e(t)}))}))})),this.nextSendMessage+=1}handleChannelStatusChange(){this.channel&&("open"===this.channel.readyState?(v("connected"),console.log("Channel now OPEN")):(v("disconnected"),console.log("Channel now CLOSED")))}receiveChannelCallback(e){this.receiveChannel=e.channel,this.receiveChannel.onmessage=e=>{!function(e,t){"test"===e.data?console.log("test message received"):"channel open"===e.data?(document.masterInfo.streaming=!0,document.getElementById("stream-status").innerText="connected",document.masterInfo.currentSong="streaming",document.getElementById("song-label").innerText="awaiting music",setTimeout((()=>{document.getElementById("song-label").innerText="keep your shirt on"}),2e3),d("stream"),document.masterInfo.streaming=!0):(console.log("other message woo!"),document.streamPlayer.setData(e.data))}(e)}}handleReceiveMessage(e){console.log("data received"),this.streamPlayer.setData(e.data)}}(G,X),y().then((e=>{e.animatedBackground||(G.animatedBackground=!1,document.getElementById("toggle-background-ball").classList.add("toggle-ball-off"),document.getElementById("background-title").style.opacity="0.5"),e.sustainedNotes||(G.sustainedNotes=!1,document.getElementById("toggle-sustained-ball").classList.add("toggle-ball-off"),document.getElementById("sustained-title").style.opacity="0.5"),e.autoCalibrating||(G.autoCalibrating=!1,document.getElementById("toggle-calibration-ball").classList.add("toggle-ball-off"),document.getElementById("calibration-title").style.opacity="0.5")})),document.isFullscreen=!1,document.wantFullscreenReturn=!1,r("button-play"),document.userFeedbackOpen=!1,document.addEventListener("keypress",(e=>{if(!document.userFeedbackOpen){if(e.stopPropagation(),G.waitingForKey){e.preventDefault(),z[G.waitingForKey[1]]=e.code,document.getElementById(G.waitingForKey[0]).innerText=e.code;const t=`bulb-${G.waitingForKey[0].split("").slice(0,G.waitingForKey[0].length-4).join("")}`;document.getElementById(t).innerText=e.code,document.getElementById("save-settings").style.opacity="1",G.waitingForKey=!1,document.getElementById("change-key-message").innerText=""}"Space"===e.code&&G.spaceFunction()}})),document.addEventListener("keydown",(e=>{document.userFeedbackOpen||(e.code===z[0]&&(e.preventDefault(),U["slide-left"]||K["tapper-left"]||ie("tapper-left","slide-left","note-leaving-left")),e.code===z[1]&&(e.preventDefault(),U["slide-a"]||K["tapper-a"]||(3===Y.slides.length?ie("tapper-a","slide-a",Math.random()>.5?"note-leaving-right":"note-leaving-left"):ie("tapper-a","slide-a","note-leaving-left"))),e.code===z[2]&&(e.preventDefault(),U["slide-b"]||K["tapper-b"]||ie("tapper-b","slide-b","note-leaving-right")),e.code===z[3]&&(e.preventDefault(),U["slide-right"]||K["tapper-right"]||ie("tapper-right","slide-right","note-leaving-right")))})),document.addEventListener("keyup",(e=>{document.userFeedbackOpen||(e.code===z[0]&&ne("tapper-left"),e.code===z[1]&&ne("tapper-a"),e.code===z[2]&&ne("tapper-b"),e.code===z[3]&&ne("tapper-right"))}));let oe=null,re=0;function le(e,t,s=!1){const n=document.createElement("div");n.classList.add("note"),!0===s&&(n.classList.add("note-marked"),n.style.backgroundColor="yellow"),s&&!0!==s&&(n.style.backgroundColor=s);let i=-0;oe&&!oe.isTail&&oe.position<.05*(G.travelLength+0)&&(i=oe.position),n.style.top=`${-1*G.sliderPos+i}px`;const a={note:n,position:i,slideId:e,target:!1,val:t,isTail:!1,tail:null,seen:!1};return j.add(a),document.getElementById(e).appendChild(n),oe=a,q[e]=a,re+=1,a}let de=!1;function ce(){S[Math.floor(S.length*Math.random())].play(),G.streaming?X.setVolume(.3):"radio"!==G.songMode&&_.setVolume(.3),Y.recordNoteMissed(),a("song-label","font-bigA"),s("song-label",G.currentSong),document.getElementById("slides").classList.remove("on-fire"),document.getElementById("song-label").classList.remove("on-fire"),document.getElementById("streak-channel").classList.remove("streak-channel-lit"),document.getElementById("streak-channel").innerHTML="";const e=document.getElementById("rock-label");de||(e.classList.remove("on-fire"),e.classList.remove("rock-label")),e.classList.remove("static-rock");const t=G.streak;t>25&&(de=!0,e.innerHTML=`${t} NOTE <br> STREAK!`,e.classList.add("rock-label"),setTimeout((()=>{e.classList.remove("rock-label"),t>50?(e.innerHTML="YOU ROCK!",e.classList.add("rock-label"),setTimeout((()=>{e.classList.remove("rock-label"),e.innerHTML="",de=!1}),1300)):de=!1}),1300)),G.songStreak>W&&(W=G.songStreak),G.streak=0,G.songStreak=0,G.songNotesMissed+=1}const he=Math.floor(1e15*Math.random()).toString();function me(){fetch("https://beatburner.com/api/session.php",{method:"POST",body:JSON.stringify({session:he,mode:G.songMode})})}function ue(e,t,s,n){const i=performance.now()-s;if(i<n){const t=1*i/n;document.getElementById(e).style.width=`${Math.ceil(100*t)}%`}else{const e=Math.floor(i/n),s=t[e-1];if(s){let t=1*(i-n*e)/n;t>.9&&(t=1),document.getElementById(s).style.opacity=`${t}`}}i<n*(1+t.length)&&requestAnimationFrame((()=>{ue(e,t,s,n)}))}function ge(e){const t=document.createElement("div");t.classList.add("note-lighted");const s=document.createElement("div");s.classList.add("note-middle-lighted");const n=document.createElement("div");n.appendChild(t),n.appendChild(s),document.getElementById(`dummy-${e}`).appendChild(n),n.classList.add("flash"),setTimeout((()=>{n.remove()}),1e3)}setTimeout(me,3e4),setInterval((()=>{me()}),18e4)})()})();