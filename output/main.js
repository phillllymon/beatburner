/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e,t,s={546:(e,t,s)=>{s.d(t,{E_:()=>r,F3:()=>o});const i=(e=>e.CapacitorPlatforms=(e=>{const t=new Map;t.set("web",{name:"web"});const s=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t};return s.addPlatform=(e,t)=>{s.platforms.set(e,t)},s.setPlatform=e=>{s.platforms.has(e)&&(s.currentPlatform=s.platforms.get(e))},s})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s.g?s.g:{});var n;i.addPlatform,i.setPlatform,function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(n||(n={}));class a extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const l=(e=>e.Capacitor=(e=>{var t,s,i,l,o;const r=e.CapacitorCustomPlatform||null,d=e.Capacitor||{},h=d.Plugins=d.Plugins||{},c=e.CapacitorPlatforms,m=(null===(t=null==c?void 0:c.currentPlatform)||void 0===t?void 0:t.getPlatform)||(()=>null!==r?r.name:(e=>{var t,s;return(null==e?void 0:e.androidBridge)?"android":(null===(s=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===s?void 0:s.bridge)?"ios":"web"})(e)),u=(null===(s=null==c?void 0:c.currentPlatform)||void 0===s?void 0:s.isNativePlatform)||(()=>"web"!==m()),g=(null===(i=null==c?void 0:c.currentPlatform)||void 0===i?void 0:i.isPluginAvailable)||(e=>{const t=f.get(e);return!!(null==t?void 0:t.platforms.has(m()))||!!y(e)}),y=(null===(l=null==c?void 0:c.currentPlatform)||void 0===l?void 0:l.getPluginHeader)||(e=>{var t;return null===(t=d.PluginHeaders)||void 0===t?void 0:t.find((t=>t.name===e))}),f=new Map,p=(null===(o=null==c?void 0:c.currentPlatform)||void 0===o?void 0:o.registerPlugin)||((e,t={})=>{const s=f.get(e);if(s)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),s.proxy;const i=m(),l=y(e);let o;const c=s=>{let h;const c=(...c)=>{const m=(async()=>(!o&&i in t?o=o="function"==typeof t[i]?await t[i]():t[i]:null!==r&&!o&&"web"in t&&(o=o="function"==typeof t.web?await t.web():t.web),o))().then((t=>{const o=((t,s)=>{var o,r;if(!l){if(t)return null===(r=t[s])||void 0===r?void 0:r.bind(t);throw new a(`"${e}" plugin is not implemented on ${i}`,n.Unimplemented)}{const i=null==l?void 0:l.methods.find((e=>s===e.name));if(i)return"promise"===i.rtype?t=>d.nativePromise(e,s.toString(),t):(t,i)=>d.nativeCallback(e,s.toString(),t,i);if(t)return null===(o=t[s])||void 0===o?void 0:o.bind(t)}})(t,s);if(o){const e=o(...c);return h=null==e?void 0:e.remove,e}throw new a(`"${e}.${s}()" is not implemented on ${i}`,n.Unimplemented)}));return"addListener"===s&&(m.remove=async()=>h()),m};return c.toString=()=>`${s.toString()}() { [capacitor code] }`,Object.defineProperty(c,"name",{value:s,writable:!1,configurable:!1}),c},u=c("addListener"),g=c("removeListener"),p=(e,t)=>{const s=u({eventName:e},t),i=async()=>{const i=await s;g({eventName:e,callbackId:i},t)},n=new Promise((e=>s.then((()=>e({remove:i})))));return n.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await i()},n},A=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return l?p:u;case"removeListener":return g;default:return c(t)}}});return h[e]=A,f.set(e,{name:e,proxy:A,platforms:new Set([...Object.keys(t),...l?[i]:[]])}),A});return d.convertFileSrc||(d.convertFileSrc=e=>e),d.getPlatform=m,d.handleError=t=>e.console.error(t),d.isNativePlatform=u,d.isPluginAvailable=g,d.pluginMethodNoop=(e,t,s)=>Promise.reject(`${s} does not have an implementation of "${t}".`),d.registerPlugin=p,d.Exception=a,d.DEBUG=!!d.DEBUG,d.isLoggingEnabled=!!d.isLoggingEnabled,d.platform=d.getPlatform(),d.isNative=d.isNativePlatform(),d})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s.g?s.g:{}),o=l.registerPlugin;l.Plugins;class r{constructor(e){this.listeners={},this.retainedEventArguments={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const i=this.windowListeners[e];return i&&!i.registered&&this.addWindowListener(i),s&&this.sendRetainedArgumentsForEvent(e),Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const i=this.listeners[e];if(i)i.forEach((e=>e(t)));else if(s){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new l.Exception(e,n.Unimplemented)}unavailable(e="not available"){return new l.Exception(e,n.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const i=s.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach((t=>{this.notifyListeners(e,t)})))}}const d=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),h=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class c extends r{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach((e=>{if(e.length<=0)return;let[s,i]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=h(s).trim(),i=h(i).trim(),t[s]=i})),t}async setCookie(e){try{const t=d(e.key),s=d(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),a=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${i}; path=${n}; ${a};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}o("CapacitorCookies",{web:()=>new c});class m extends r{async request(e){const t=((e,t={})=>{const s=Object.assign({method:e.method||"GET",headers:e.headers},t),i=((e={})=>{const t=Object.keys(e);return Object.keys(e).map((e=>e.toLocaleLowerCase())).reduce(((s,i,n)=>(s[i]=e[t[n]],s)),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)s.body=e.data;else if(i.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[s,i]of Object.entries(e.data||{}))t.set(s,i);s.body=t.toString()}else if(i.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach(((e,s)=>{t.append(s,e)}));else for(const s of Object.keys(e.data))t.append(s,e.data[s]);s.body=t;const i=new Headers(s.headers);i.delete("content-type"),s.headers=i}else(i.includes("application/json")||"object"==typeof e.data)&&(s.body=JSON.stringify(e.data));return s})(e,e.webFetchExtra),s=((e,t=!0)=>e?Object.entries(e).reduce(((e,s)=>{const[i,n]=s;let a,l;return Array.isArray(n)?(l="",n.forEach((e=>{a=t?encodeURIComponent(e):e,l+=`${i}=${a}&`})),l.slice(0,-1)):(a=t?encodeURIComponent(n):n,l=`${i}=${a}`),`${e}&${l}`}),"").substr(1):null)(e.params,e.shouldEncodeUrlParams),i=s?`${e.url}?${s}`:e.url,n=await fetch(i,t),a=n.headers.get("content-type")||"";let l,o,{responseType:r="text"}=n.ok?e:{};switch(a.includes("application/json")&&(r="json"),r){case"arraybuffer":case"blob":o=await n.blob(),l=await(async e=>new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>{const e=i.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},i.onerror=e=>s(e),i.readAsDataURL(e)})))(o);break;case"json":l=await n.json();break;default:l=await n.text()}const d={};return n.headers.forEach(((e,t)=>{d[t]=e})),{data:l,headers:d,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}o("CapacitorHttp",{web:()=>new m})},693:(e,t,s)=>{var i,n;s.d(t,{_n:()=>n,kn:()=>i}),function(e){e.Heavy="HEAVY",e.Medium="MEDIUM",e.Light="LIGHT"}(i||(i={})),function(e){e.Success="SUCCESS",e.Warning="WARNING",e.Error="ERROR"}(n||(n={}))}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var a=i[e]={exports:{}};return s[e](a,a.exports,n),a.exports}n.m=s,n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,s)=>(n.f[s](e,t),t)),[])),n.u=e=>e+".main.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="webpackcompiler:",n.l=(s,i,a,l)=>{if(e[s])e[s].push(i);else{var o,r;if(void 0!==a)for(var d=document.getElementsByTagName("script"),h=0;h<d.length;h++){var c=d[h];if(c.getAttribute("src")==s||c.getAttribute("data-webpack")==t+a){o=c;break}}o||(r=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+a),o.src=s),e[s]=[i];var m=(t,i)=>{o.onerror=o.onload=null,clearTimeout(u);var n=e[s];if(delete e[s],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((e=>e(i))),t)return t(i)},u=setTimeout(m.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=m.bind(null,o.onerror),o.onload=m.bind(null,o.onload),r&&document.head.appendChild(o)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var i=s.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=s[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={792:0};n.f.j=(t,s)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var a=new Promise(((s,n)=>i=e[t]=[s,n]));s.push(i[2]=a);var l=n.p+n.u(t),o=new Error;n.l(l,(s=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=s&&("load"===s.type?"missing":s.type),l=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+l+")",o.name="ChunkLoadError",o.type=a,o.request=l,i[1](o)}}),"chunk-"+t,t)}};var t=(t,s)=>{var i,a,[l,o,r]=s,d=0;if(l.some((t=>0!==e[t]))){for(i in o)n.o(o,i)&&(n.m[i]=o[i]);r&&r(n)}for(t&&t(s);d<l.length;d++)a=l[d],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},s=self.webpackChunkwebpackcompiler=self.webpackChunkwebpackcompiler||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),(()=>{var e=n(546);const t=(0,e.F3)("Preferences",{web:()=>n.e(619).then(n.bind(n,619)).then((e=>new e.PreferencesWeb))});function s(e,t){o()?document.getElementById(e).addEventListener("touchstart",t):document.getElementById(e).addEventListener("click",t)}function i(e,t){document.getElementById(e).innerText=t}function a(e,t){document.getElementById(e).classList.add(t)}function l(e,t){document.getElementById(e).classList.remove(t)}function o(){return navigator.userAgentData?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((e=>navigator.userAgent.match(e)))}function r(e){"button-play"===e&&(a("button-pause","hidden"),["button-play","button-restart","show-settings","show-menu"].forEach((e=>{l(e,"hidden")}))),"button-pause"===e&&(l("button-pause","hidden"),["button-play","button-restart","show-settings","show-menu"].forEach((e=>{a(e,"hidden")})))}function d(e){const t=`${e}-modal`;document.getElementById(t).classList.add("hidden"),document.getElementById("modal-background").classList.add("hidden")}function h(e="loading..."){document.getElementById("loading-text").innerHTML=e,document.getElementById("loading").classList.remove("hidden"),m(0)}function c(){document.getElementById("loading").classList.add("hidden")}function m(e){document.getElementById("loading-bar-inner").style.width=`${e}%`}function u(e){document.getElementById("loading-text").innerHTML=e}function g(e,t){e.notes.forEach((t=>{t.tail&&t.tail.note.remove(),t.killed=!0,t.note.remove(),e.notes.delete(t)})),t.resetData()}function y(e){return new Promise((s=>{t.set({key:"userProfile",value:JSON.stringify(e)}).then((()=>{s()}))}))}function f(){return new Promise((e=>{t.get({key:"userProfile"}).then((t=>{const s=t.value;e(s?JSON.parse(s):p)}))}))}const p={level:1,slides:3,lastMessage:0,queryStats:!0,queryInitial:!0,progress:{l1s2:{},l1s3:{},l1s4:{},l2s2:{},l2s3:{},l2s4:{},l3s2:{},l3s3:{},l3s4:{},l4s2:{},l4s3:{},l4s4:{},l5s2:{},l5s3:{},l5s4:{}},stations:{kingFM:{name:"classical king FM",stream:"https://classicalking.streamguys1.com/king-fm-aac-128k"},mvn925:{name:"movin' 92.5",stream:"https://23093.live.streamtheworld.com/KQMVFM.mp3?dist=hubbard&source=hubbard-web&ttag=web&gdpr=0"},unsung80s:{name:"Unsung 80s",stream:"https://unsung80s.out.airtime.pro/unsung80s_a"},beat90s:{name:"The beat",stream:"https://ice10.securenetsystems.net/AM1380?playSessionID=1C5D8230-00FD-2EFE-2AEE4302B829B5F3"},"100hitz":{name:"100 hitz",stream:"https://pureplay.cdnstream1.com/6045_128.mp3"},mlelive:{name:"MLE live",stream:"https://listen.radioking.com/radio/114610/stream/462118"},chetFM:{name:"93.5 Chet FM",stream:"https://ice23.securenetsystems.net/KDJF?playSessionID=1CE4C155-F05D-ADFF-15CD1D9351B467C0"},scooter:{name:"Scooterist radio",stream:"https://listen.radioking.com/radio/214267/stream/257398?1709875088135"},"1234gr":{name:"1234 GR",stream:"https://radio1234gr.radioca.st/live"},hawk:{name:"Hawk classic rock",stream:"https://ice6.securenetsystems.net/KRSE?playSessionID=1D6EEF83-C785-2F70-5A76B4CD63C85056"}}};function A(e,t,s){let i=1*e/(e+t),n=Math.floor(100*i);n<2&&(n=2),n>98&&e>10?(n=100,document.getElementById("skilz-channel").classList.add("skilz-channel-lit"),document.getElementById("skilz-meter").classList.add("skilz-meter-lit"),s.animations&&(document.getElementById("perfect").classList.remove("hidden"),document.getElementById("perfect-container").classList.add("perfect-slide-left"))):(document.getElementById("skilz-channel").classList.remove("skilz-channel-lit"),document.getElementById("skilz-meter").classList.remove("skilz-meter-lit"),document.getElementById("perfect").classList.add("hidden"),document.getElementById("perfect-container").classList.remove("perfect-slide-left")),document.getElementById("skilz-ball").style.top=100-n+"%"}function I(e,t,s,i,n,a,l,o,r,d,h,c,m){const u=performance.now()-h.slideStartTime,g=1*h.masterInfo.songDelay/2;let y=0;u>1&&(y=1*u/g);const f=1*y*h.masterInfo.travelLength-h.masterInfo.sliderPos;if(s.forEach((e=>{const t=i[e];if(t){const s=t.position+f;t.position=s;const n=t.height-f;if(n<0){t.note.remove(),i[e]=null;const s=document.getElementById(`${e}-flash-sustain`);s&&(s.classList.add("light-off"),setTimeout((()=>{s.remove()}),500))}t.note.style.height=`${n}px`,t.height=n}})),h.masterInfo.sliderPos>1e5){let e="a-",t="b-";"b-slider"===h.currentSlider&&(e="b-",t="a-"),["slide-left","slide-a","slide-b","slide-right"].forEach((s=>{document.getElementById(s).id=`${e}${s}`,document.getElementById(`${t}${s}`).id=s}));const s="a-slider"===h.currentSlider?"a-slider":"b-slider";h.currentSlider="a-slider"===h.currentSlider?"b-slider":"a-slider",h.movingBothSliders=!0,h.oldSliderPos=h.masterInfo.sliderPos,setTimeout((()=>{h.movingBothSliders=!1,h.oldSliderPos=0,document.getElementById(s).style.top="0px"}),2e3),h.masterInfo.sliderPos=0,h.slideStartTime=performance.now()}if(h.masterInfo.sliderPos+=f,h.movingBothSliders){const e="a-slider"===h.currentSlider?"b-slider":"a-slider";h.oldSliderPos+=f,document.getElementById(e).style.top=`${h.oldSliderPos}px`}document.getElementById(h.currentSlider).style.top=`${h.masterInfo.sliderPos}px`,h.oldSlider&&(h.oldSliderPosition+=f,h.oldSlider.style.top=`${h.oldSliderPosition}px`);for(const t of e){const s=t.position+f;if(t.position=s,t.tail){const e=t.tail.position+f;t.tail.position=e}!t.target&&s>a.top&&s<a.bottom&&(n[t.slideId].add(t),t.target=!0),s>a.bottom&&!0===t.target&&(t.target=!1,n[t.slideId].delete(t),l(),t.tail&&(t.tail.note.remove(),o[t.tail.slideId]=null)),s>r&&(t.killed=!0,t.note.remove(),e.delete(t)),"calibrate"===c&&s>m&&(t.killed=!0,t.note.remove(),e.delete(t),v("slide-right","tapper-right"))}}function v(e,t){const s=document.createElement("div");s.classList.add("note-lighted");const i=document.createElement("div");i.classList.add("note-middle-lighted");const n=document.createElement("div");n.id=`${e}-flash`,n.appendChild(s),n.appendChild(i),document.getElementById(`dummy-${t}`).appendChild(n),n.classList.add("flash"),setTimeout((()=>{n.remove()}),1e3)}class b{constructor(e,t,s){this.selfDestruct=s,this.masterInfo=e,document.masterInfo=e,this.streamPlayer=t,document.streamPlayer=t,this.connection=new RTCPeerConnection,this.channel=this.connection.createDataChannel("channel"),this.channel.onopen=this.handleChannelStatusChange,this.channel.onclose=this.handleChannelStatusChange,this.streamId=0,this.nextSendMessage=0,this.nextReceiveMessage=0,document.getElementById("connect-stream-button").addEventListener("click",(()=>{E("attempting to connect");const e=document.getElementById("enter-stream-id").value;this.connect(e)})),document.getElementById("cancel-stream-button").addEventListener("click",(()=>{document.getElementById("stream-modal").classList.add("hidden"),document.getElementById("main-menu").classList.remove("hidden")})),this.receiveChannel=null,this.connection.ondatachannel=this.receiveChannelCallback,this.connection.onicecandidate=e=>{if(e.candidate){console.log("sending candidate");const t={type:"candidate",candidate:e.candidate};this.sendMessage(JSON.stringify(t))}},this.connection.addEventListener("icegatheringstatechange",(e=>{console.log("ICE gathering state change: "+e.target.iceGatheringState)})),this.clipMode=!1}dealWithMessage(e){const t=JSON.parse(e);E("communication established"),"candidate"===t.type&&(console.log("received candidate"),this.connection.addIceCandidate(t.candidate)),"offer"===t.type&&(console.log("received offer"),this.connection.setRemoteDescription(t.offer).then((()=>{this.connection.createAnswer().then((e=>{this.connection.setLocalDescription(e).then((()=>{const t={type:"answer",answer:e};this.sendMessage(JSON.stringify(t))}))}))}))),"switch"===t.type&&(this.clipMode=!0,this.runClipMode())}connect(e){this.streamId=e;let t=0;const s=setInterval((()=>{this.clipMode&&clearInterval(s),this.getMessages(),t+=1,t>30?(clearInterval(s),E("could not connect"),this.closeConnection()):"open"===this.channel.readyState&&(E("connected to source"),setTimeout((()=>{E("listening for music")}),1e3),clearInterval(s))}),2e3)}getMessages(){const e=`${this.streamId}fromHost${this.nextReceiveMessage}`;var t;(t=e,new Promise((e=>{fetch("https://beatburner.com/api/",{method:"POST",body:JSON.stringify({action:"retrieve",name:t})}).then((t=>{t.json().then((t=>{t.value?e(t.value):e(!1)}))}))}))).then((e=>{e&&(this.dealWithMessage(e),this.nextReceiveMessage+=1,this.getMessages())}))}sendMessage(e){const t=`${this.streamId}fromRemote${this.nextSendMessage}`;var s,i;s=t,i=e,new Promise((e=>{fetch("https://beatburner.com/api/",{method:"POST",body:JSON.stringify({action:"set",name:s,value:i})}).then((t=>{t.json(t).then((t=>{e(t)}))}))})),this.nextSendMessage+=1}handleChannelStatusChange(){this.channel&&("open"===this.channel.readyState?E("connected"):E("disconnected"))}receiveChannelCallback(e){this.receiveChannel=e.channel,this.receiveChannel.onmessage=e=>{!function(e,t){"test"===e.data?console.log("test message received"):"channel open"===e.data?(document.masterInfo.streaming=!0,document.getElementById("stream-status").innerText="connected",document.masterInfo.currentSong="streaming",document.getElementById("song-label").innerText="awaiting music",setTimeout((()=>{document.getElementById("song-label").innerText="keep your shirt on"}),3e3),d("stream"),document.masterInfo.streaming=!0):document.streamPlayer.setData(e.data)}(e)}}handleReceiveMessage(e){this.streamPlayer.setData(e.data)}closeConnection(){this.connection.close(),this.streamPlayer.stopStream(),document.getElementById("enter-stream-id").value="",E("not connected"),this.selfDestruct(),this.closed=!0,console.log("STATUS: "+this.channel.readyState),setTimeout((()=>{console.log("STATUS LATE: "+this.channel.readyState)}),2e3)}runClipMode(){this.clipNum=0;const e=setInterval((()=>{this.closed&&clearInterval(e),fetch("https://beatburner.com/api/getClip.php",{method:"POST",body:JSON.stringify({clipId:`8248125clip${this.clipNum}`})}).then((e=>{e.json().then((e=>{if("success"===e.message){const t={str:e.clip,time:1e4,clipMode:!0};this.streamPlayer.setData(JSON.stringify(t)),this.clipNum+=1}else this.clipNum=0}))}))}),8e3)}}function E(e){document.getElementById("stream-status").innerText=e}const w={songDelay:4e3,maxTailLength:500,targetBoundSizes:{top:.04,bottom:.03},mobile:{maxTailLength:1.2,travelLength:1.285,targetBounds:{top:.96,bottom:1.03}},minNoteGap:150,allSlides:["slide-left","slide-a","slide-b","slide-right"]},B=[["liveInMyHead","blahBlahBlah","innerPeace","burningBayou","getThatFeeling"],["lifeIBelieve","thinkingOfYou","rascalBack","hypeMeUp","paleCityGirl"],["indian","neverBackDown","womanWithTheWind","wayYouMove","moneyMoney"],["echoesOfThePast","aLifeLikeThis","neverBeBlue","schoolGirlCrush","temptation"],["handle","animal","myHeartIsAllYours","itDoesntMatter","rockItTonight"],["prettyThing","hotHotFire","words","heartBlueBlack","intoTheNight","inevitable","echoesOfRebellion","discoBeat","shareLove"]],L={blahBlahBlah:"Camille de la Cruz",burningBayou:"Assaf Ayalon",discoBeat:'Clarx <a href="https://www.youtube.com/watch?v=_H5UO3c4YtM">NCS</a>',echoesOfRebellion:"R Harris",getThatFeeling:"Ikoliks",heartBlueBlack:"Assaf Ayalon",hypeMeUp:"IamDayLight, Curtis Cole, Paper Plastic",inevitable:"Donnor & Tie",lifeIBelieve:"Jon Worthy and the Bends",liveInMyHead:"Eldar Kedem",neverBackDown:"Ben Goldstein feat. Moon",neverBeBlue:"Dan Zeitune",paleCityGirl:"Indiana Bradley",prettyThing:"Crosstown Traffic",rascalBack:"Ben Bostick",schoolGirlCrush:"Brunch with Bunny",wayYouMove:"Ben Wagner",shareLove:"Buddha Kid",whispersOfTheWreck:"R Harris",words:"Assaf Ayalon",aLifeLikeThis:"River Lume",echoesOfThePast:"Max Hixon",hotHotFire:"MILANO",moneyMoney:"MILANO",rockItTonight:"MILANO",animal:"Title Holder",handle:"Van Stee",indian:"Taheda",innerPeace:"Yotam Ben Horin",itDoesntMatter:"Title Holder",myHeartIsAllYours:"Steven Beddall",thinkingOfYou:"SOURWAH",temptation:"Ride Free",womanWithTheWind:"Ben Strawn",intoTheNight:"Brent Henderson",myHeart:'Different Heaven & EH!DE <a href="https://www.youtube.com/watch?v=jK2aIUmmdP4">NCS</a>'},T={agressiveMetal:"Aggressive Metal",aHumanBeing:"A Human Being",anthemOfRain:"Anthem of Rain",bigWhiteLimousine:"Big White Limousine",blahBlahBlah:"Blah Blah Blah",burningBayou:"Burning on the Bayou",canvasOfDreams:"Canvas of Dreams",cosmicCaravan:"Cosmic Caravan",cricket:"Cricket",discoBeat:"Disco",disfigure:"Disfigure",doItAgain:"Do It Again",echoesOfRebellion:"Echoes of Rebellion",fightSong:"Israel Fight Song",findAWay:"Find a Way",fuckingTribute:"Mysticism of Your Fucking Sound",getThatFeeling:"Get That Feeling",glowOfTheMoon:"In the Glow of the Moon",godOrDevil:"God or the Devil",happierWithoutYou:"Happier Without You",heartBlueBlack:"My Heart is Blue Black",hypeMeUp:"Hype Me Up",inevitable:"Inevitable",keepYou:"Keep You",lifeIBelieve:"A Life I Believe",littleGirl:"Little Girl",liveInMyHead:"Live In My Head",maniaMaster:"Mania Master",monkeyBusiness:"Monkey Business",myHeart:"My Heart",myLife:"It's My Life",needYourLove:"I Need Your Love",neverBackDown:"Never Back Down",neverBeBlue:"Never Be Blue",onAndOn:"On and On",oneStep:"One Step at a Time",oneSweetDream:"One Sweet Dream",overSpeedLimit:"50 Over the Speed Limit",oweItToYou:"I Owe it to You",paleCityGirl:"Pale City Girl",prettyThing:"Pretty Thing",rascalBack:"The Rascal is Back",romeoAndJuliet:"Romeo and Juliet",satinDress:"Satin Dress",schoolGirlCrush:"School Girl Crush",secretToSell:"Secret to Sell",sexualDeviant:"Pretty Tame Sexual Deviant",shareLove:"Share Love",shouldBeMe:"That Should Be Me",skyHigh:"Sky High",stickAroundYou:"Stick Around You",stopTheWar:"Stop the War",sunnyVibe:"Sunny Vibe",takeMe:"Take Me",timeOfMyLife:"Time of My Life",turnItUp:"Turn It Up",ufo:"UFO",unbreakable:"Unbreakable",wayYouMove:"Way You Move",whispersOfTheWreck:"Whispers of the Wreck",words:"Words",aLifeLikeThis:"A Life Like This",aThousandTimes:"A Thousand Times",echoesOfThePast:"Echoes of the Past",hotHotFire:"Hot Hot Fire",low:"Low",moneyMoney:"Money Money",motherOfLife:"Mother of Life",rockItTonight:"Rock It Tonight",safariSurf:"Safari Surf",saturdaySpecial:"Saturday Special",animal:"Animal",cactusFlower:"Cactus Flower",circusStory:"Russian Circus Story",emptyApartment:"Empty Apartment",handle:"Handle",indian:"Indian",innerPeace:"Inner Peace",itDoesntMatter:"It Doesn't Matter",myHeartIsAllYours:"My Heart is All Yours",nowhere:"Nowhere",rockwell:"Rockwell",springRain:"Spring Rain",thinkingOfYou:"Thinking of You",temptation:"Temptation",womanWithTheWind:"Woman with the Wind",intoTheNight:"Into the Night"};function S(e){let t=0;return e.forEach((e=>{t+=e})),0===e.length?0:1*t/e.length}var k=n(693);const M=(0,e.F3)("Haptics",{web:()=>n.e(789).then(n.bind(n,789)).then((e=>new e.HapticsWeb))});console.log("initiating beatburner");const P=new Audio,C=new Audio,x=new Audio,D=new Audio,O=new Audio,R=[];R.push(D),R.push(O),[[P,"whoosh"],[C,"static"],[x,"guitar"],[D,"twang1"],[O,"twang2"]].forEach((e=>{fetch(`./effects/${e[1]}.txt`).then((t=>{t.text().then((t=>{e[0].setAttribute("src",`data:audio/x-wav;base64,${t}`)}))}))})),setTimeout((()=>{setTimeout((()=>{P.play()}),400),setTimeout((()=>{C.play()}),1500),setTimeout((()=>{for(let e=0;e<50;e++)setTimeout((()=>{Te(["tapper-left","tapper-a","tapper-b","tapper-right"][Math.floor(4*Math.random())])}),1500*Math.random())}),1800),setTimeout((()=>{me.showMenu("source-menu")}),3700),setTimeout((()=>{x.play()}),3500)}),1e3);const{songDelay:H,allSlides:N,targetBoundSizes:F,minNoteGap:J,maxTailLength:j}=w;let Q=document.body.clientWidth,W=document.body.clientHeight,U=Math.min(Q,W),q=1.5*U,z=1.365*U,V=z/(H/1e3/2)*1;const Y={top:z-F.top*z,bottom:z+F.bottom*z};o()&&(console.log("mobile woo!"),function(){document.mobile=!0;const e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href="./style/styleMobile.css",document.head.appendChild(e);const t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="./style/noteColorsMobile.css",document.head.appendChild(t),["fog-top-left","fog-top-right","fog-gradient-left","fog-gradient-right"].forEach((e=>{document.getElementById(e).remove()})),setTimeout((()=>{se.initializeMobileBackground(),document.getElementById("background-css").remove();const e=document.getElementById("game-container").clientHeight;te.travelLength=w.mobile.travelLength*e,te.autoAdjustment=.05*te.travelLength;const t=1*te.travelLength/(te.songDelay/1e3/2);te.targetBounds.top=w.mobile.targetBounds.top*te.travelLength,te.targetBounds.bottom=w.mobile.targetBounds.bottom*te.travelLength,te.noteSpeed=t,te.maxTailLength=1*w.mobile.maxTailLength*te.travelLength,te.slideLength=1.3*te.travelLength}),1e3),[["tapper-left","slide-left","note-leaving-left","dummy-tapper-left","dummy-left","slide-left","b-slide-left"],["tapper-right","slide-right","note-leaving-right","dummy-tapper-right","dummy-right","slide-right","b-slide-right"],["tapper-a","slide-a","note-leaving-left","dummy-tapper-a","dummy-a","slide-a","b-slide-a"],["tapper-b","slide-b","note-leaving-right","dummy-tapper-b","dummy-b","slide-b","b-slide-b"]].forEach((e=>{document.getElementById(e[3]).addEventListener("touchstart",(t=>{fe(...e)})),document.getElementById(e[4]).addEventListener("touchstart",(t=>{fe(...e)})),document.getElementById(e[5]).addEventListener("touchstart",(t=>{fe(...e)})),document.getElementById(e[6]).addEventListener("touchstart",(t=>{fe(...e)}))})),document.addEventListener("touchend",(e=>{"dummy-left"!==e.target.id&&"dummy-tapper-left"!==e.target.id&&"a-slide-left"!==e.target.id&&"b-slide-left"!==e.target.id&&"slide-left-flash"!==e.target.id&&"slide-left-flash-sustain"!==e.target.id&&"slide-left-note-lighted"!==e.target.id||ye("tapper-left"),"dummy-a"!==e.target.id&&"dummy-tapper-a"!==e.target.id&&"a-slide-a"!==e.target.id&&"b-slide-a"!==e.target.id&&"slide-a-flash"!==e.target.id&&"slide-a-flash-sustain"!==e.target.id&&"slide-a-note-lighted"!==e.target.id||ye("tapper-a"),"dummy-b"!==e.target.id&&"dummy-tapper-b"!==e.target.id&&"a-slide-b"!==e.target.id&&"b-slide-b"!==e.target.id&&"slide-b-flash"!==e.target.id&&"slide-b-flash-sustain"!==e.target.id&&"slide-b-note-lighted"!==e.target.id||ye("tapper-b"),"dummy-right"!==e.target.id&&"dummy-tapper-right"!==e.target.id&&"a-slide-right"!==e.target.id&&"b-slide-right"!==e.target.id&&"slide-right-flash"!==e.target.id&&"slide-right-flash-sustain"!==e.target.id&&"slide-right-note-lighted"!==e.target.id||ye("tapper-right")})),document.getElementById("change-tapper-keys-item").classList.add("hidden")}()),setTimeout((()=>{document.getElementById("start-curtain").remove()}),1100);const Z=new Set,G={"slide-right":null,"slide-left":null,"slide-a":null,"slide-b":null},K={"slide-right":new Set,"slide-left":new Set,"slide-a":new Set,"slide-b":new Set},X={"slide-right":null,"slide-left":null,"slide-a":null,"slide-b":null},$=["KeyS","KeyC","KeyB","KeyJ"],_={"tapper-left":!1,"tapper-a":!1,"tapper-b":!1,"tapper-right":!1};let ee=0;const te={algorithm:"A",allSlides:N,animatedBackground:!0,animations:!0,audioLoaded:!1,autoAdjustment:0,autoCalibrating:!0,canEnterCode:!0,currentSong:"",double:!0,doubleFrequency:"few",effects:!0,hapticsOnHit:!0,manualDelay:0,maxTailLength:j,minNoteGap:J,mostRecentNotesOrTails:G,notes:Z,noteSpeed:V,radioCode:"mvn925",sendStat:!0,slideLength:q,sliderPos:0,songAtStart:!0,songDelay:H,songNotesHit:0,songNotesMissed:0,songStreak:0,streak:0,streaming:!1,sustainedNotes:!0,sustainedNotesFrequency:"few",tapperKeys:$,targets:K,targetBounds:Y,targetTails:X,travelLength:z,useShortSteps:!0,vMin:U,waitingForKey:!1},se=new class{constructor(e){this.masterInfo=e,this.valsQueue=[],this.initializeColors(),this.initializeBackground()}addValsArrayToQueue(e){this.valsQueue.push([e,performance.now()])}animateBackground(e){if(!this.masterInfo.animatedBackground)return;this.addValsArrayToQueue(e);const t=performance.now()-this.masterInfo.songDelay;let s=null,i=0;for(let e=0;e<this.valsQueue.length;e++){const n=this.valsQueue[e];if(!(n[1]<t)){s=n[0];break}i+=1}for(let e=0;e<i;e++)this.valsQueue.shift();if(document.mobile){this.changeColors();const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));document.getElementById("play-area").style.backgroundColor=`rgb(${e[2]})`;const t=document.getElementById("background-left"),i=document.getElementById("background-right");t.style.background=`linear-gradient(\n                to left,\n                rgba(${e[0]}, 0) 0%,\n                rgba(${e[0]}, 1) 100%)`,i.style.background=`linear-gradient(\n                to right,\n                rgba(${e[0]}, 0) 0%,\n                rgba(${e[0]}, 1) 100%)`,document.getElementById("fog-mobile-top").style.backgroundColor=`rgb(${e[0]})`,document.getElementById("fog-mobile-gradient").style.background=`linear-gradient(\n                to top,\n                rgba(${e[0]}, 0) 0%,\n                rgba(${e[0]}, 1) 100%)`;let n=0;s.forEach((e=>{n+=e}));const a=100*s[3]/n;t.style.width=`${15+a}%`,i.style.width=`${15+a}%`}else if(s){let e=0;if(s.forEach((t=>{e+=t})),e>0){const t=s.map((t=>1*t/e)),i=60*t[0],n=i+10,a=n+60*t[1],l=a+10,o=l+60*t[2],r=o+10;this.changeColors();const d=this.colors.map((e=>e.map((e=>e[0])).join(",")));["background-left","fog-top-left","fog-middle-left","fog-gradient-left"].forEach((e=>{document.getElementById(e).style.background=`linear-gradient(\n                            to right,\n                            rgba(${d[0]},1.0) ${i}%,\n                            rgba(${d[1]},1.0) ${n}% ${a}%,\n                            rgba(${d[2]},1.0) ${l}% ${o}%,\n                            rgba(${d[3]},1.0) ${r}%\n                        )`})),["background-right","fog-top-right","fog-middle-right","fog-gradient-right"].forEach((e=>{document.getElementById(e).style.background=`linear-gradient(\n                            to left,\n                            rgba(${d[0]},1.0) ${i}%,\n                            rgba(${d[1]},1.0) ${n}% ${a}%,\n                            rgba(${d[2]},1.0) ${l}% ${o}%,\n                            rgba(${d[3]},1.0) ${r}%\n                        )`}))}}}changeColors(){this.colors.forEach(((e,t)=>e.map(((e,s)=>{Math.random()>.8&&(e[1]=1===e[1]?-1:1);const i=t===this.colors.length-1?t:t+1,n=t===this.colors.length-1?250:this.colors[i][s][0];e[0]>n-5&&1===e[1]&&(e[1]=-1),e[0]<40&&-1===e[1]&&(e[1]=1),Math.random()>.8&&(e[0]+=e[1]*Math.floor(5*Math.random()))}))))}initializeColors(){const e=Math.floor(240*Math.random()),t=Math.floor(240*Math.random()),s=Math.floor(240*Math.random()),i=Math.floor(e+(255-e)*Math.random()),n=Math.floor(t+(255-t)*Math.random()),a=Math.floor(s+(255-s)*Math.random()),l=Math.floor(i+(255-i)*Math.random()),o=Math.floor(n+(255-n)*Math.random()),r=Math.floor(a+(255-a)*Math.random()),d=Math.floor(l+(255-l)*Math.random()),h=Math.floor(o+(255-o)*Math.random()),c=Math.floor(r+(255-r)*Math.random());this.colors=[[[e,1],[t,-1],[s,1]],[[i,-1],[n,1],[a,-1]],[[l,1],[o,-1],[r,1]],[[d,-1],[h,1],[c,-1]]]}initializeBackground(){if(!document.mobile){const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));["background-left","fog-top-left","fog-middle-left","fog-gradient-left"].forEach((t=>{document.getElementById(t).style.background=`linear-gradient(\n                    to right,\n                    rgba(${e[0]},1.0) 20%,\n                    rgba(${e[1]},1.0) 30% 45%,\n                    rgba(${e[2]},1.0) 55% 70%,\n                    rgba(${e[3]},1.0) 80%\n                )`})),["background-right","fog-top-right","fog-middle-right","fog-gradient-right"].forEach((t=>{document.getElementById(t).style.background=`linear-gradient(\n                    to left,\n                    rgba(${e[0]},1.0) 20%,\n                    rgba(${e[1]},1.0) 30% 45%,\n                    rgba(${e[2]},1.0) 55% 70%,\n                    rgba(${e[3]},1.0) 80%\n                )`}))}}initializeMobileBackground(){const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));document.getElementById("play-area").style.backgroundColor=`rgb(${e[2]})`,document.getElementById("background-left").style.background=`linear-gradient(\n            to left,\n            rgba(${e[1]}, 0) 0%,\n            rgba(${e[1]}, 1) 100%)`,document.getElementById("background-right").style.background=`linear-gradient(\n            to right,\n            rgba(${e[1]}, 0) 0%,\n            rgba(${e[1]}, 1) 100%)`,document.getElementById("fog-mobile").classList.remove("hidden"),document.getElementById("fog-mobile-top").style.backgroundColor=`rgb(${e[0]})`,document.getElementById("fog-mobile-gradient").style.background=`linear-gradient(\n            to top,\n            rgba(${e[0]}, 0) 0%,\n            rgba(${e[0]}, 1) 100%)`}}(te),ie=new class{constructor(e,t,s,i){this.masterInfo=e,this.addNote=t,this.makeTail=s,this.backgroundAnimator=i,this.lastLeft=performance.now(),this.lastMid=performance.now(),this.lastRight=performance.now(),this.lastLeftTail=performance.now(),this.lastMidTail=performance.now(),this.lastRightTail=performance.now(),this.leftSlides=["slide-left","slide-a"],this.rightSlides=["slide-b","slide-right"],this.rightId="slide-right",this.leftId="slide-left",this.lastAll={"slide-left":performance.now(),"slide-a":performance.now(),"slide-b":performance.now(),"slide-right":performance.now()},this.lastAlls=[],this.mostRecentNotes=e.mostRecentNotesOrTails,this.numToneVals=5,this.recentToneVals=[20,20,20,50,50,80,80,80,20,20,20,50,50,80,80,80],this.sideWithNotes=null,this.last=performance.now(),this.timeSinceLast=0,this.timesSinceLast=[0,0,0,0],this.lastArrs=[],this.rawArrs=[],this.gap=200,this.resetData(),this.doPreciseBetter=!0,this.tallestTowerIdices=[]}resetData(){this.times=[],this.collectArrays=[],this.collectTimeArrays=[],this.timeArrayVariances=[],this.startTime=performance.now(),this.lastTime=performance.now(),this.stepTime=5,this.arrLength=2048,this.aveHillHeights=[],this.tallestTowers=[],this.toneVals=[],this.peakOffset=0,this.prev=!1,this.low=!1,this.lowIdx=!1,this.dir=1}writeTails(e,t,s,i,n){if(this.recentToneVals.length<5||i<2)return;let a={few:5,medium:10,many:15}[this.masterInfo.sustainedNotesFrequency];"radio"===this.masterInfo.songMode&&(a=Math.floor(a/2)),t.forEach((i=>{const n=this.mostRecentNotes[i];if(n){let l=n.val,o=l,r=!1,d=!0;if(n.isTail)d=!0;else{d=!0;let e=4e3;s.forEach((t=>{let s=!1,i=o;t.forEach((t=>{const n=Math.abs(t[1]-i);n<a&&(s=!0,n<e&&(e=n,o=t[1]))})),s||(d=!1)}))}let h=!0;n.isTail&&n.totalHeight>1.5*this.masterInfo.travelLength&&(h=!1);let c=4e3;if(e.forEach((e=>{const t=Math.abs(l-e[1]);t<a&&(r=!0,t<c&&(c=t,n.val=e[1]))})),r&&d&&h){const e=performance.now();4===t.length?this.leftSlides.includes(i)?(this.lastLeft=e,this.lastAll[i]=e,this.makeTail(i,n)):(this.lastRight=e,this.lastAll[i]=e,this.makeTail(i,n)):3===t.length?i===this.rightId?(this.lastRight=e,this.lastAll[i]=e,this.makeTail(i,n)):i===this.leftId?(this.lastLeft=e,this.lastAll[i]=e,this.makeTail(i,n)):(this.lastMid=e,this.lastAll[i]=e,this.makeTail(i,n)):(this.lastAll[i]=e,this.makeTail(i,n))}else n.isTail&&n.totalHeight<.1*this.masterInfo.travelLength&&(n.cloud.remove(),n.note.remove(),n.parentNote.tail=null),this.mostRecentNotes[i]=null}}))}writeNotes(e,t,s,i,n=0){const a=performance.now()-n;for(this.times.push(a);this.times[0]<a-4e3;)this.times.shift();this.lastTime+=this.stepTime;let l=!1,o=!1;const r=e,d=t;let h,c;if(this.timeArrayVariances.push(Math.max(...d)-Math.min(...d)),this.doPreciseBetter){let e=r[0],t=e,n=1;const d=[];r.forEach(((s,i)=>{if(s>0)if(s>e)-1===n&&(t=s,n=1);else if(1===n){const a=e-t;a>0&&d.push([a,i-1]),t=s,n=-1}else t=s;e=s}));const m=.9*d.length,u=d.slice(m,d.length);this.tallestTowers.push(u);const g=u.map((e=>e[1])).sort(((e,t)=>e>t?1:-1));let y=0;for(let e=Math.floor(g.length/5);e<g.length;e++)y+=g[e]-g[e-1];let f=0;g.length>1&&(f=y/(g.length-1)),this.toneVals.push(f),this.aveHillHeights.push(S(u.map((e=>e[0]))));let p=0,A=0;u.forEach((e=>{e[0]>p&&(p=e[0],A=e[1])})),this.tallestTowerIdices.push(A),this.rawArrs.push(r),this.aveHillHeights.length>this.times.length&&(this.aveHillHeights.shift(),this.timeArrayVariances.shift(),this.tallestTowers.shift(),this.toneVals.shift(),this.rawArrs.shift(),this.tallestTowerIdices.shift());let I=4;(this.times[this.times.length-1]-this.times.length[0]<3900||this.times.length<100)&&(I=1);const v=[],b={};let E=this.aveHillHeights[0],w=1,B=E,L=0,T=0,k=0;this.times.length>100&&(T=(1*this.times[this.times.length-1]-this.times[0])/this.times.length,T>0&&(k=1*this.masterInfo.manualDelay/T));const M=1900;let P=0;for(;this.times[P]<a-M+k&&(P+=1,this.times[P]););if(0===P)return;const C=Math.floor(this.aveHillHeights.length/(2*I));let x=Math.floor(P-C),D=Math.floor(P+C);if(x<0)return;if(x>this.aveHillHeights.length-1)return;if(D<0)return;if(D>this.aveHillHeights.length-1)return;for(let e=x;e<D;e++){const t=this.aveHillHeights[e];if(t>E)-1===w&&(B=E,L=e-1,w=1);else{if(1===w){const t=E-B;t>0&&(v.push([t,L,this.timeArrayVariances[e]]),b[L]=e-L)}B=t,L=e}E=t}v.sort(((e,t)=>e[2]>t[2]?1:-1));const O=b[P]+P;O&&(this.peakOffset=b[P]);let R=0,H=0;this.tallestTowers[P+this.peakOffset].forEach((e=>{e[0]>R&&(R=e[0],H=e[1])})),c=H,h=this.toneVals[O+this.peakOffset];const N=4e3/this.tallestTowers.length;let F=Math.ceil(200/N);if(this.masterInfo.sustainedNotes&&this.writeTails(this.tallestTowers[P+this.peakOffset],s,this.tallestTowers.slice(P+this.peakOffset+1,P+this.peakOffset+1+F),i,this.timeArrayVariances[P]),this.timeArrayVariances[P]<15||this.times[this.times.length-1]-this.times[0]<1900)return;Math.max(...this.aveHillHeights),Math.min(...this.aveHillHeights);this.aveHillHeights[this.aveHillHeights.length-1];let J={1:1,2:.82,3:.75,4:.5,5:.25}[i];if(3===s.length){let e=1-J;e*=.75,J=1-e}if(2===s.length){let e=1-J;e*=.5,J=1-e}let j={1:4,2:7,3:10,4:30,5:60}[i];3===s.length&&(j*=.75),2===s.length&&(j*=.5);const Q={few:.75,medium:.5,many:0}[this.masterInfo.doubleFrequency],W=v.slice(Math.floor(v.length-j),v.length-1);W.forEach(((e,t)=>{e[1]===P&&(l=!0,t>Q*W.length&&(o=!0))})),this.lastAlls.push({"slide-left":a-this.lastAll["slide-left"],"slide-a":a-this.lastAll["slide-a"],"slide-b":a-this.lastAll["slide-b"],"slide-right":a-this.lastAll["slide-right"]}),this.lastAlls.length>this.times.length&&this.lastAlls.shift();const U=[Math.pow(S(r.slice(r.length-2048,r.length-1536)),1.5),Math.pow(S(r.slice(r.length-1536,r.length-1024)),1.5),Math.pow(S(r.slice(r.length-1024,r.length-512)),1.5),Math.pow(S(r.slice(r.length-512,r.length-256)),1.5)];this.lastArrs.push(U),this.lastArrs.length>8&&this.lastArrs.shift();const q=[];for(let e=0;e<U.length;e++)q.push(S(this.lastArrs.map((t=>t[e]))));this.backgroundAnimator.animateBackground(q)}if(l){const e=this.getSlideToUse(h,s.length);this.attemptNoteWrite({slideToUse:e,slideIds:s,noteVal:c,toneVal:h,addNote:this.addNote,marked:!1,mobile:!0,notesPerSecond:i,canDouble:o,timeOffset:n})}}getSlideToUse(e,t){const s=this.recentToneVals.map((e=>e)).sort(((e,t)=>e>t?1:-1)),i=s[s.length-1],n=s[0];if(e>i)return"slide-right";if(e<n)return"slide-left";if(4===t){let t="slide-left";return e>s[Math.floor(.25*s.length)]&&(t="slide-a",e>s[Math.floor(.5*s.length)]&&(t="slide-b",e>s[Math.floor(.75*s.length)]&&(t="slide-right"))),t}if(3===t){let t="slide-left";return e>s[Math.floor(.33*s.length)]&&(t="slide-a",e>s[Math.floor(.66*s.length)]&&(t="slide-right")),t}if(2===t){let t="slide-left";return e>s[Math.floor(.5*s.length)]&&(t="slide-right"),t}let a="slide-left";return 4===t?e>s[0]&&(a="slide-a",e>s[1]&&(a="slide-b",e>s[2]&&(a="slide-right"))):3===t?e>s[0]&&(a="slide-a",e>s[2]&&(a="slide-right")):e>s[1]&&(a="slide-right"),a}attemptNoteWrite(e){const{slideToUse:t,slideIds:s,noteVal:i,toneVal:n,addNote:a,marked:l,mobile:o,notesPerSecond:r,canDouble:d,timeOffset:h}=e;let c=!1,m=this.gap;if(m*=.75,t){const e=performance.now()-h;if(e-this.lastAll[t]>this.masterInfo.minNoteGap)if(o&&s.length>2)if(3===s.length){if(this.mostRecentNotes["slide-a"]&&this.mostRecentNotes["slide-a"].isTail&&t!==this.sideWithNotes)return;const s=e-this.lastLeft,n=e-this.lastMid,o=e-this.lastRight;t===this.rightId?(s>m||n>m)&&(a(t,i,l,h,d),c=!0,this.sideWithNotes=t,this.lastRight=e,this.lastAll[t]=e):t===this.leftId?(n>m||o>m)&&(a(t,i,l,h,d),c=!0,this.sideWithNotes=t,this.lastLeft=e,this.lastAll[t]=e):(s>m||o>m)&&(a(t,i,l,h,d),c=!0,this.lastMid=e,this.lastAll[t]=e)}else{const s=e-this.lastLeft,n=e-this.lastRight;this.leftSlides.includes(t)?s>m&&(a(t,i,l,h,d),c=!0,this.lastLeft=e,this.lastAll[t]=e):n>m&&(a(t,i,l,h,d),c=!0,this.lastRight=e,this.lastAll[t]=e)}else if(r<3){const s=e-this.lastLeft,n=e-this.lastRight;this.leftSlides.includes(t)?s>m&&(a(t,i,l,h,d),c=!0,this.lastLeft=e,this.lastAll[t]=e):n>m&&(a(t,i,l,h,d),c=!0,this.lastRight=e,this.lastAll[t]=e)}else a(t,i,l,h,d),c=!0,this.lastAll[t]=e}c&&(this.recentToneVals.push(n),this.lastValTime=performance.now(),this.recentToneVals.length>this.numToneVals&&this.recentToneVals.shift())}}(te,ve,pe,se),ne=new class{constructor(e,t,s,i,n,a,l=4){this.masterInfo=e,this.delay=this.masterInfo.songDelay,this.recents=e.mostRecentNotesOrTails,this.notes=e.notes,this.allSlides=e.allSlides,this.slides=[this.allSlides[0],this.allSlides[1],this.allSlides[3]],this.notesPerSecond=2,f().then((e=>{this.notesPerSecond=e.level,this.setNumSlides(e.slides)})),this.targetTails=e.targetTails,this.targets=e.targets,this.targetBounds=e.targetBounds,this.addNote=i,this.makeTail=n,this.triggerMissedNote=a,this.noteWriter=t,this.backgroundAnimator=s,this.time=0,this.animating=!1,this.arrays=[];for(let e=0;e<l;e++)this.arrays.push([]);this.times=[],this.timeStep=5,this.lastTime=0,this.noteResults=[],this.notesHit=0,this.notesMissed=0,this.arrayNow=[1,1,1,1],this.currentSlider="a-slider",this.oldSliderPos=0,this.movingBothSliders=!1}setNotesPerSecond(e){this.notesPerSecond=e}setNumSlides(e){this.slides=2===e?[this.allSlides[0],this.allSlides[3]]:3===e?[this.allSlides[0],this.allSlides[1],this.allSlides[3]]:[this.allSlides[0],this.allSlides[1],this.allSlides[2],this.allSlides[3]]}recordNoteHit(){for(this.notesHit+=1,this.noteResults.push(!0);this.noteResults.length>75;)this.noteResults.shift()?this.notesHit-=1:this.notesMissed-=1;A(this.notesHit,this.notesMissed,this.masterInfo)}recordNoteMissed(){for(this.notesMissed+=2,this.noteResults.push(!1),this.noteResults.push(!1);this.noteResults.length>75;)this.noteResults.shift()?this.notesHit-=1:this.notesMissed-=1;A(this.notesHit,this.notesMissed,this.masterInfo)}runAnimation(e){this.time=performance.now(),this.animating=!0,this.animate(e),this.slideStartTime=performance.now()}stopAnimation(){g(this.masterInfo,this.noteWriter),this.animating=!1}animate(e){const t=performance.now();if("tutorial"===this.masterInfo.songMode||"calibrate"===this.masterInfo.songMode){this.time;return this.time=t,I(this.masterInfo.notes,this.masterInfo.noteSpeed,this.slides,this.targetTails,this.targets,this.masterInfo.targetBounds,this.triggerMissedNote,this.recents,this.masterInfo.slideLength,0,this,this.masterInfo.songMode,this.masterInfo.travelLength),void(this.animating&&requestAnimationFrame((()=>this.animate(e))))}const{player:s,algorithm:i}=e,n=[];if(t-this.lastTime>35||!this.masterInfo.useShortSteps)n.push(t),this.lastTime=t;else{let e=this.lastTime+this.timeStep;for(;e<t;)n.push(e),e+=this.timeStep,this.lastTime=e}n.forEach((e=>{const i=t-e,n=this.delay+i;s.calibrateLag(n);const a=s.getDetailedFreqArray(),l=s.getDetailedTimeArray();this.noteWriter.writeNotes(a,l,this.slides,this.notesPerSecond,i)}));this.time;this.time=t,I(this.masterInfo.notes,this.masterInfo.noteSpeed,this.slides,this.targetTails,this.targets,this.masterInfo.targetBounds,this.triggerMissedNote,this.recents,this.masterInfo.slideLength,0,this,this.masterInfo.songMode,this.masterInfo.travelLength),this.animating&&requestAnimationFrame((()=>this.animate(e)))}}(te,ie,se,ve,pe,Be),ae=new class{constructor(e,t,s,i){this.masterInfo=e,this.song1=new Audio,this.song2=new Audio,this.onEnd=i,this.playing1=!1,this.playing2=!1,this.paused=!1,this.arrayPlay=!1,this.delayPlay=!1,this.timeStarted=!1,this.song2Timeout=!1,this.delay=e.songDelay,this.timeToStart2=this.delay,this.song1.addEventListener("ended",(()=>{this.playing1=!1})),this.song2.addEventListener("ended",(()=>{this.playing2=!1,this.timeToStart2=this.delay,this.restart(),r("button-play"),i()})),this.waiting=!1,this.countdownCanceled=!1;const n=new AudioContext,a=n.createMediaElementSource(this.song1);this.detailedAnalyser=n.createAnalyser(),a.connect(this.detailedAnalyser),n.setSinkId({type:"none"}),this.detailedAnalyser.connect(n.destination),this.detailedAnalyser.fftSize=4096,this.detailedDataArray=new Uint8Array(this.detailedAnalyser.frequencyBinCount),this.freqArrays=[],this.times=[]}setPlayerReady(e){this.song1.oncanplaythrough=e,this.readyCallback=e}countdown(){const e=document.getElementById("rock-label");e.classList.add("countdown-label"),e.innerText="Ready",this.countdownCanceled=!1,setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="3"}),1e3),setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="2"}),2e3),setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="1"}),3e3),setTimeout((()=>{this.countdownCanceled||(e.innerText=""),e.classList.remove("countdown-label")}),4e3)}switchRecorder(){console.log("switching recorder");const e="A"===this.currentRecorder?this.recorderA:this.recorderB;("A"===this.currentRecorder?this.recorderB:this.recorderA).start(),"A"===this.currentRecorder?this.delayPlayRecordStartTimes.B=this.uploadSilent.currentTime:this.delayPlayRecordStartTimes.A=this.uploadSilent.currentTime,e.stop(),setTimeout((()=>{this.playingOnDelay&&this.switchRecorder()}),4e3),this.currentRecorder="A"===this.currentRecorder?"B":"A"}startDelayRecording(){this.uploadSilent.play(),"A"===this.currentRecorder?(this.recorderA.start(),this.delayPlayRecordStartTimes.A=this.uploadSilent.currentTime):(this.recorderB.start(),this.delayPlayRecordStartTimes.B=this.uploadSilent.currentTime),setTimeout((()=>{this.playingOnDelay&&this.switchRecorder()}),4e3),this.playingOnDelay=!0,console.log("HERE!")}playNextDelayPiece(){if(this.delayPlayQueue.length>0){console.log("pulling next piece from queue of "+this.delayPlayQueue.length),this.delayPieceObj=this.delayPlayQueue.shift();const e=new AudioContext,t=e.createMediaElementSource(this.delayPieceObj.audio);this.delayAnalyser=e.createAnalyser(),t.connect(this.delayAnalyser),e.setSinkId({type:"none"}),this.delayAnalyser.connect(e.destination),this.delayAnalyser.fftSize=4096,this.delayDataArray=new Uint8Array(this.delayAnalyser.frequencyBinCount),this.delayPieceObj.audio.play(),this.playingDelayPieces=!0,setTimeout((()=>{this.playingOnDelay&&(this.playNextDelayPiece(),console.log("play next piece"))}),1e3*(this.delayPieceObj.endTime-this.delayPieceObj.startTime))}else console.log("QUEUE EMPTY")}startDelayPlaying(){h("loading"),this.masterInfo.pauseDisabled=!0,setTimeout((()=>{m(18+4*Math.random()),setTimeout((()=>{m(38+4*Math.random()),setTimeout((()=>{m(58+4*Math.random()),setTimeout((()=>{m(88+4*Math.random()),setTimeout((()=>{m(100)}),900+200*Math.random())}),900+200*Math.random())}),900+200*Math.random())}),900+200*Math.random())}),900+200*Math.random()),setTimeout((()=>{this.playNextDelayPiece(),setTimeout((()=>{this.uploadLoud.play(),this.delaySongStarted=!0,this.masterInfo.pauseDisabled=!1}),4e3),this.countdown(),c()}),5e3)}start(){if(this.delayPlay)if(this.delayPaused){const e=1e3*(this.delayPieceObj.endTime-this.delayPieceObj.startTime-this.delayPieceObj.audio.currentTime);console.log(e),this.startDelayRecording(),this.uploadLoud.play(),this.delayPieceObj.audio.play(),setTimeout((()=>{this.playNextDelayPiece()}),e),this.playingOnDelay=!0,this.delayPaused=!1}else this.currentRecorder="A",this.startDelayRecording(),this.startDelayPlaying();else this.masterInfo.songAtStart&&this.countdown(),this.masterInfo.songAtStart=!1,this.arrayPlay?this.songPiece.audio.play():this.song1.play(),this.playing1=!0,this.timeStarted=performance.now(),this.timeToStart2?(setTimeout((()=>{this.startSong2()}),this.timeToStart2),this.waiting=!0):(this.song2.play(),this.playing2=!0),this.paused=!1}startSong2(){this.paused||(this.song2.play(),this.playing2=!0,this.timeToStart2=!1,this.waiting=!1)}pause(){this.delayPlay?this.delaySongStarted&&(this.delayPaused=!0,this.playingOnDelay=!1,this.uploadLoud.pause(),console.log(this.delayPieceObj),console.log(this.delayPlayQueue),this.delayPieceObj&&this.delayPieceObj.audio.pause(),this.uploadSilent.pause(),"A"===this.currentRecorder?(this.recorderA.stop(),this.currentRecorder="B"):(this.recorderB.stop(),this.currentRecorder="A")):this.playing2?(this.song2.pause(),this.playing2=!1,this.arrayPlay?this.songPiece.audio.pause():this.song1.pause(),this.playing1=!1):this.song1.playing&&(this.arrayPlay?this.songPiece.audio.pause():this.song1.pause(),this.song1.playing=!1,this.song1.pause(),clearTimeout(this.song2Timeout),this.timeToStart2=performance.now()-timeStarted),this.countdownCanceled=!0,this.paused=!0}restart(){if(this.delayPlay)for(this.delaySongStarted=!1,this.delayPaused=!1,this.playingOnDelay=!1,this.recorderA.stop(),this.recorderB.stop(),this.uploadLoud.pause(),this.uploadLoud.currentTime=0,this.uploadSilent.pause(),this.uploadSilent.currentTime=0,this.delayPieceObj&&this.delayPieceObj.audio.pause(),this.currentRecorder="A",this.delayPlayRecordStartTimes={A:0,B:0};this.delayPlayQueue.length>0;)this.delayPlayQueue.shift();else this.arrayPlay?(this.songPiece.audio.pause(),this.arrayPos=0,this.songPiece=this.piecesArray[this.arrayPos],this.song2.pause(),this.playing1=!1,this.playing2=!1,this.waiting&&(clearTimeout(this.song2Timeout),this.waiting=!1),this.timeToStart2=this.delay,this.song2.currentTime=0,this.masterInfo.songAtStart=!0,this.countdownCanceled=!0):(this.song1.pause(),this.song2.pause(),this.playing1=!1,this.playing2=!1,this.waiting&&(clearTimeout(this.song2Timeout),this.waiting=!1),this.timeToStart2=this.delay,this.song1.currentTime=0,this.song2.currentTime=0,this.masterInfo.songAtStart=!0,this.countdownCanceled=!0)}setSource(e,t=!1,s=!1,i=!1){if(i){this.restart(),this.delayPlay=!0,this.uploadSilent=new Audio(e),this.uploadLoud=new Audio(e),this.uploadLoud.addEventListener("ended",(()=>{this.onEnd(),this.restart()}));let t=!1;this.currentRecorder="A",this.delayPlayRecordStartTimes={A:0,B:0},this.uploadSilent.oncanplaythrough=()=>{if(!t){t=!0,this.delayPlayQueue=[];const e=new AudioContext,s=e.createMediaStreamDestination();e.createMediaElementSource(this.uploadSilent).connect(s),this.recorderA=new MediaRecorder(s.stream),this.recorderB=new MediaRecorder(s.stream);const i=[];this.recorderA.ondataavailable=e=>{i.push(e.data)},this.recorderB.ondataavailable=e=>{i.push(e.data)},this.recorderA.onstop=()=>{const e=new Blob(i,{type:"audio/ogg; codecs=opus"});for(;i.length>0;)i.shift();const t=new FileReader;t.onload=e=>{const t=btoa(e.target.result),s=new Audio(`data:audio/x-wav;base64,${t}`);this.delayPlayQueue.push({startTime:this.delayPlayRecordStartTimes.A,endTime:this.uploadSilent.currentTime,audio:s})},t.readAsBinaryString(e)},this.recorderB.onstop=()=>{const e=new Blob(i,{type:"audio/ogg; codecs=opus"});for(;i.length>0;)i.shift();const t=new FileReader;t.onload=e=>{const t=btoa(e.target.result),s=new Audio(`data:audio/x-wav;base64,${t}`);this.delayPlayQueue.push({startTime:this.delayPlayRecordStartTimes.B,endTime:this.uploadSilent.currentTime,audio:s})},t.readAsBinaryString(e)},document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden")}}}else if(t)if(this.delayPlay=!1,s){this.arrayPlay=!0,this.arrayPos=0;let t=0;s.forEach((e=>{null!==e.startTime&&(t+=1)})),this.piecesArray=s.slice(0,t),this.songPiece=this.piecesArray[this.arrayPos],this.piecesArray.forEach((e=>{e.audio.addEventListener("ended",(()=>{this.startNextPiece()}))})),this.song2.setAttribute("src",e),s.length>0&&(this.restart(),this.masterInfo.songAtStart=!0)}else this.piecesArray&&this.piecesArray.forEach((e=>{e.ctx&&e.ctx.close()})),this.piecesArray=null,this.songPiece=null;else this.delayPlay=!1,this.arrayPlay=!1,this.restart(),this.song1.setAttribute("src",e),this.song2.setAttribute("src",e),this.masterInfo.songAtStart=!0}startNextPiece(){this.arrayPos+=1,this.piecesArray[this.arrayPos]&&(this.songPiece=this.piecesArray[this.arrayPos],this.songPiece.audio.play())}getDetailedFreqArray(){return this.arrayPlay?(this.songPiece.analyser.smoothingTimeConstant=0,this.songPiece.analyser.getByteFrequencyData(this.songPiece.array),this.songPiece.array.map((e=>e))):this.delayPlay&&this.delayAnalyser?(this.delayAnalyser.smoothingTimeConstant=0,this.delayAnalyser.getByteFrequencyData(this.delayDataArray),this.delayDataArray.map((e=>e))):(this.detailedAnalyser.smoothingTimeConstant=0,this.detailedAnalyser.getByteFrequencyData(this.detailedDataArray),this.detailedDataArray.map((e=>e)))}getDetailedTimeArray(){return this.arrayPlay?(this.songPiece.analyser.smoothingTimeConstant=0,this.songPiece.analyser.getByteTimeDomainData(this.songPiece.array),this.songPiece.array.map((e=>e))):this.delayPlay&&this.delayAnalyser?(this.delayAnalyser.smoothingTimeConstant=0,this.delayAnalyser.getByteTimeDomainData(this.delayDataArray),this.delayDataArray.map((e=>e))):(this.detailedAnalyser.smoothingTimeConstant=0,this.detailedAnalyser.getByteTimeDomainData(this.detailedDataArray),this.detailedDataArray.map((e=>e)))}getDataFreqArray(){this.analyser.getByteFrequencyData(this.dataArray),this.freqArrays.push(this.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.delay;)this.times.shift(),this.freqArrays.shift();return this.dataArray}getDataFreqArrayDelayed(e=2e3){let t=0;for(;performance.now()-e>this.times[t]&&(t+=1,this.times[t]););return this.times[t]?this.freqArrays[t]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}setVolume(e){this.delayPlay?this.uploadLoud.volume=e:this.song2.volume=e}calibrateLag(e=this.delay){const t=1*e/1e3;this.delayPlay?this.playingDelayPieces&&this.delayPieceObj&&this.uploadLoud.currentTime>0&&(this.delayPieceObj.audio.currentTime=t+this.uploadLoud.currentTime-this.delayPieceObj.startTime):this.arrayPlay?this.playing2&&this.songPiece.audio.currentTime<.5*this.songPiece.audio.duration&&(this.songPiece.audio.currentTime=this.song2.currentTime+t-this.songPiece.startTime):this.song1.currentTime>t&&(this.song1.currentTime=this.song2.currentTime+t)}}(te,"aintOverYou",32,(()=>{ne.stopAnimation(),te.songStreak>ee&&(ee=te.songStreak),document.getElementById("feedback").classList.remove("hidden");const e=1*te.songNotesHit/(te.songNotesHit+te.songNotesMissed);document.getElementById("percent-bar-inner-container").style.width=100*e+"%";const t=Math.round(1e3*e)/10;var s;"demo"===te.songMode&&(s=t,te.currentSong,new Promise((e=>{f().then((t=>{const i=`l${ne.notesPerSecond}s${ne.slides.length}`,n=te.songCode,a=t.progress[i][n];a?s>a&&(t.progress[i][n]=s):t.progress[i][n]=s,y(t).then((()=>{he.activateSongSelect(!1),e()}))}))}))),t<{1:75,2:80,3:85,4:90,5:95}[ne.notesPerSecond]?(document.getElementById("song-fail").classList.remove("hidden"),document.getElementById("song-pass").classList.add("hidden"),document.getElementById("feedback-percent").style.color="red"):(document.getElementById("song-fail").classList.add("hidden"),document.getElementById("song-pass").classList.remove("hidden"),document.getElementById("feedback-percent").style.color="green"),document.getElementById("feedback-title").innerText=te.currentSong,"demo"===te.songMode&&L[te.songCode]?(document.getElementById("song-information-bar").innerHTML=L[te.songCode],document.getElementById("song-information-bar").classList.remove("hidden")):(document.getElementById("song-information-bar").innerHTML="",document.getElementById("song-information-bar").classList.add("hidden")),document.getElementById("feedback-title").innerText=te.currentSong,document.getElementById("feedback-percent").innerText=`Tap accuracy: ${t}%`,document.getElementById("feedback-streak").innerText=`Longest streak: ${ee}`,document.getElementById("feedback-streak-overall").innerText=`Current streak: ${te.streak}`,function(e,t){const s=performance.now();t.forEach((e=>{document.getElementById(e).style.opacity="0"})),Le("percent-bar",t,s,800)}(0,["feedback-percent-title","feedback-streak","feedback-streak-overall"]),te.songNotesMissed=0,te.songNotesHit=0,te.songStreak=0})),le=new class{constructor(e,t){this.masterInfo=e,this.songDelay=t,this.queue=[],this.started=!1,this.current=null,this.muted=!1,this.freqArrays=[],this.times=[],this.blobStreaming=!1,this.blobs=[]}calibrateLag(e=this.songDelay){const t=1*e/1e3;this.player&&this.silentPlayer.currentTime>t&&(this.silentPlayer.currentTime=this.player.currentTime+t),this.current&&this.current.silentSong.currentTime>t&&(this.current.silentSong.currentTime=this.current.song.currentTime+t)}playOnDelay(e){e.silentSong.play();const t=this;setTimeout((()=>{t.currentAudio=e.song,e.song.play()}),this.songDelay)}getDetailedFreqArray(){return this.liveStream?(this.liveAnalyser.smoothingTimeConstant=0,this.liveAnalyser.getByteFrequencyData(this.liveDataArray),this.liveDataArray.map((e=>e))):this.silentPlayer?(this.analyser.smoothingTimeConstant=0,this.analyser.getByteFrequencyData(this.dataArray),this.dataArray.map((e=>e))):(this.current.analyser.smoothingTimeConstant=0,this.current.analyser.getByteFrequencyData(this.current.dataArray),this.current.dataArray.map((e=>e)))}getDetailedTimeArray(){return this.liveStream?(this.liveAnalyser.smoothingTimeConstant=0,this.liveAnalyser.getByteTimeDomainData(this.liveDataArray),this.liveDataArray.map((e=>e))):this.silentPlayer?(this.analyser.smoothingTimeConstant=0,this.analyser.getByteTimeDomainData(this.dataArray),this.dataArray.map((e=>e))):(this.current.analyser.smoothingTimeConstant=0,this.current.analyser.getByteTimeDomainData(this.current.dataArray),this.current.dataArray.map((e=>e)))}getDataFreqArray(){if(this.liveStream){this.liveAnalyser.getByteFrequencyData(this.liveDataArray),this.freqArrays.push(this.liveDataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.songDelay;)this.times.shift(),this.freqArrays.shift();return this.liveDataArray}if(this.silentPlayer){this.analyser.getByteFrequencyData(this.dataArray),this.freqArrays.push(this.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.songDelay;)this.times.shift(),this.freqArrays.shift();return this.dataArray}if(this.current&&!this.muted){this.current.analyser.getByteFrequencyData(this.current.dataArray),this.freqArrays.push(this.current.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.songDelay;)this.times.shift(),this.freqArrays.shift();return this.current.dataArray}return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}getDataFreqArrayDelayed(e=2e3){let t=0;for(;performance.now()-e>this.times[t]&&(t+=1,this.times[t]););return this.times[t]?this.freqArrays[t]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}startNextRecording(){this.nextSilentPlayer.volume=0,this.nextSilentPlayer.play(),this.nextSilentPlayer.currentTime=this.silentPlayer.currentTime-1*this.nextDelay/1e3,this.correction=2-this.nextSilentPlayer.currentTime,this.nextSilentPlayer.volume=1,this.silentPlayer.volume=0,this.silentPlayer=this.nextSilentPlayer,this.analyser=this.nextAnalyser,setTimeout((()=>{this.nextPlayer.volume=0,this.nextPlayer.play(),this.nextPlayer.currentTime=this.player.currentTime-1*this.nextDelay/1e3,this.nextPlayer.play(),this.nextPlayer.volume=this.player.volume,this.player.volume=0,this.player=this.nextPlayer}),4e3),setTimeout((()=>{this.startNextRecording()}),this.nextDelay+1e3*this.correction)}setData(e,t=!1){if("stream"===!this.masterInfo.songMode)return;if(this.started||(document.getElementById("initial-received").style.color="gray"),e.liveStream)return document.getElementById("initial-received").style.color="gray",setTimeout((()=>{document.getElementById("now-streaming").style.color="gray",setTimeout((()=>{document.getElementById("connecting-radio").classList.add("hidden"),document.getElementById("button-play").classList.add("pulse"),document.getElementById("button-play-beacon").classList.remove("hidden")}),1e3)}),2e3),this.livePlayer&&this.livePlayer.pause(),this.liveStream=!0,this.livePlayer=e.player,this.livePlayer.play(),this.liveAnalyser=e.analyser,this.liveDataArray=e.dataArray,this.gain=e.gain,this.ctx=e.ctx,this.nowGain=e.nowGain,void(this.nowCtx=e.nowCtx);if(e.timeDelay){if(console.log("timeDelay recognized"),this.player){console.log("already have a player");const t=new Audio(`data:audio/x-wav;base64,${e.str}`),s=new Audio(`data:audio/x-wav;base64,${e.str}`),i=new AudioContext,n=i.createMediaElementSource(s);this.nextAnalyser=i.createAnalyser(),n.connect(this.nextAnalyser),i.setSinkId({type:"none"}),this.nextAnalyser.connect(i.destination),this.nextAnalyser.fftSize=4096,this.nextDataArray=new Uint8Array(this.nextAnalyser.frequencyBinCount);const a=()=>{s.removeEventListener("canplaythrough",a),this.nextPlayer=t,this.nextSilentPlayer=s,this.nextDelay=e.timeDelay};s.addEventListener("canplaythrough",a)}else{this.player=new Audio(`data:audio/x-wav;base64,${e.str}`),this.silentPlayer=new Audio(`data:audio/x-wav;base64,${e.str}`);const t=new AudioContext,s=t.createMediaElementSource(this.silentPlayer);this.analyser=t.createAnalyser(),s.connect(this.analyser),t.setSinkId({type:"none"}),this.analyser.connect(t.destination),this.analyser.fftSize=4096,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount);const i=()=>{this.silentPlayer.removeEventListener("canplaythrough",i),console.log("should hear music in 9 seconds"),document.getElementById("now-streaming").style.color="gray",setTimeout((()=>{this.silentPlayer.play(),setTimeout((()=>{this.player.play(),document.getElementById("connecting-radio").classList.add("hidden")}),4e3),setTimeout((()=>{this.startNextRecording()}),12e3)}),5e3)};this.silentPlayer.addEventListener("canplaythrough",i)}return}if(t){let t=!0;this.blobs.push(e),console.log(this.blobs.length);const s=new Blob(this.blobs,{type:"audio/ogg; codecs=opus"}),i=new FileReader;return i.onload=e=>{const s=btoa(e.target.result),i=new Audio(`data:audio/x-wav;base64,${s}`),n=new Audio(`data:audio/x-wav;base64,${s}`),a=new AudioContext,l=a.createMediaElementSource(n);this.analyser=a.createAnalyser(),l.connect(this.analyser),a.setSinkId({type:"none"}),this.analyser.connect(a.destination),this.analyser.fftSize=4096,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),n.addEventListener("canplaythrough",(()=>{t&&(this.player?(i.volume=0,n.volume=0,i.currentTime=this.player.currentTime,n.currentTime=this.silentPlayer.currentTime,i.play(),n.play(),i.volume=this.player.volume,n.volume=1,this.player.volume=0,this.silentPlayer.volume=0,this.player=i,this.silentPlayer=n):(this.silentPlayer=n,this.player=i,setTimeout((()=>{this.silentPlayer.play(),setTimeout((()=>{this.player.play(),document.getElementById("connecting-radio").classList.add("hidden")}),4e3),document.getElementById("now-streaming").style.color="gray"}),4e3)),t=!1)}))},i.readAsBinaryString(s),void(this.started=!0)}this.liveStreaming=!1;const s=JSON.parse(e),i=new AudioContext,n=new Audio(`data:audio/x-wav;base64,${s.str}`),a=i.createMediaElementSource(n),l=i.createAnalyser();a.connect(l),i.setSinkId({type:"none"}),l.connect(i.destination),l.fftSize=4096;const o=new Uint8Array(l.frequencyBinCount),r={song:new Audio(`data:audio/x-wav;base64,${s.str}`),notes:s.notes,time:s.time,silentSong:n,analyser:l,dataArray:o};if(this.queue.push(r),console.log("new chunk added to queue"),!this.started&&this.queue.length>1){d("stream"),console.log("starting music "+this.queue.length),this.startNextChunk(),document.getElementById("now-streaming").style.color="gray";const e=document.getElementById("song-label");"keep your shirt on"===e.innerText&&(e.innerText="streaming"),setTimeout((()=>{document.getElementById("connecting-radio").classList.add("hidden"),document.getElementById("button-play").classList.add("pulse"),document.getElementById("button-play-beacon").classList.remove("hidden")}),2e3)}}startNextChunk(){this.queue.length<1?("stream"===this.masterInfo.songMode&&(document.getElementById("song-label").innerText="stream ended"),this.started=!1):(this.current=this.queue.shift(),this.playOnDelay(this.current),this.muted&&(this.current.song.volume=0),console.log(this.current.time),setTimeout((()=>{this.startNextChunk()}),this.current.time),this.started=!0)}setVolume(e){this.currentAudio&&(this.currentAudio.volume=e),this.current&&(this.current.song.volume=e),this.player&&(this.player.volume=e),this.livePlayer&&(this.livePlayer.volume=e)}start(){this.liveStream?this.ctx.resume():this.setVolume(1),this.muted=!1}stop(){this.liveStream?this.ctx.suspend():this.setVolume(0),this.muted=!0}stopStream(){if(this.liveStream=!1,this.livePlayer&&(this.livePlayer.pause(),this.livePlayer=null),this.current)for(this.current.song.pause(),this.current.song=null,this.current=null;this.queue.length>0;)this.queue.shift()}}(te,te.songDelay),oe=new class{constructor(e,t){this.masterInfo=e,this.streamPlayer=t,this.radioAudio=new Audio,this.radioAudio.crossOrigin="anonymous",this.listening=!1,this.canceled=!1,this.chunksA=[],this.chunksB=[],this.times={A:0,B:0},this.timestamp=performance.now(),this.startTime=0,this.endTime=0,this.recorderA=null,this.recorderB=null,f().then((e=>{this.stations=e.stations,this.activateStationSelection()}))}updateStationInfo(e){this.stations=e;const t=document.getElementById("select-station");t.innerHTML="";const s=Object.keys(this.stations);for(let e=0;e<s.length;e++){const i=s[e],n=document.createElement("option");n.value=i,n.innerText=this.stations[i].name,e===s.length-1&&(this.stationInfo=this.stations[i],n.selected="selected"),t.appendChild(n)}}activateStationSelection(){document.getElementById("cancel-radio-connect").addEventListener("click",(()=>{this.canceled=!0,this.listening=!1,document.getElementById("radio-status-title").style.color="blue",document.getElementById("radio-status-title").innerText="Connecting...",document.getElementById("connecting-radio").classList.add("hidden"),document.getElementById("main-menu").classList.remove("hidden")}));const e=document.getElementById("select-station");e.addEventListener("change",(()=>{const t=e.value;this.masterInfo.radioCode=t,this.stationInfo=this.stations[t],this.radioAudio.setAttribute("src",this.stationInfo.stream),document.getElementById("song-label").innerText=this.stationInfo.name,this.masterInfo.currentSong=this.stationInfo.name,this.stopListening(),this.streamPlayer.stop()}))}stopListening(){this.listening&&(this.streamPlayer.stopStream(),this.listening=!1)}startListening(){if(this.listening)return;this.listening=!0,this.canceled=!1,document.getElementById("acquiring").style.color="transparent",document.getElementById("initial-received").style.color="transparent",document.getElementById("now-streaming").style.color="transparent",document.getElementById("connecting-radio").classList.remove("hidden"),document.getElementById("connecting-radio").classList.add("menu"),document.getElementById("acquiring").style.color="gray";let e=!1;setTimeout((()=>{e||(this.canceled=!0,document.getElementById("radio-status-title").style.color="red",document.getElementById("radio-status-title").innerText="Connection failed")}),15e3);const t=new Audio(this.stationInfo.stream);t.crossOrigin="anonymous",t.addEventListener("canplaythrough",(()=>{if(!e&&!this.canceled){e=!0;const s=new AudioContext,i=s.createMediaElementSource(t),n=s.createDelay(4);n.delayTime.setValueAtTime(4,t.currentTime),i.connect(n),n.connect(s.destination);const a=new AudioContext,l=a.createMediaStreamSource(t.captureStream()),o=a.createAnalyser();l.connect(o),a.setSinkId({type:"none"}),o.connect(a.destination),o.fftSize=4096;const r=new Uint8Array(o.frequencyBinCount);this.streamPlayer.setData({liveStream:!0,player:t,analyser:o,dataArray:r,ctx:s,nowCtx:a})}}))}switchToB(){this.times.B=performance.now(),this.recorderB.start()}switchToA(){this.times.A=performance.now(),this.recorderA.start()}}(te,le),re=new class{constructor(){this.barPos=0}startBarAnimate(e,t){const s=e-this.barPos,i=performance.now()+t,n=t/500,a=s/Math.ceil(n),l=setInterval((()=>{m(this.barPos+a),this.barPos+=a,(performance.now()>i||this.barPos>e)&&clearInterval(l)}),500)}animateBar(){const e=performance.now();e>this.endTime&&(this.animating=!1);const t=e-this.lastTime,s=this.endTime>e?t/(this.endTime-e):0;console.log("this: "+s);const i=this.endPos-this.barPos,n=100*(this.barPos+s*i);m(n),this.barPos=n,this.lastTime=e,this.animating&&requestAnimationFrame((()=>{this.animateBar()}))}convertToM4a(e){return new Promise((t=>{this.startBarAnimate(25,2e3);const s=new Audio(`data:audio/x-wav;base64,${e}`);let i=!1;s.oncanplaythrough=()=>{if(!i){i=!0;const n=s.duration,a=Math.ceil(n/8);this.startBarAnimate(100,5e3+1e3*a),setTimeout((()=>{u("Keep your shirt on")}),15e3),setTimeout((()=>{u("m4a loads faster...")}),4e3);const l=Math.ceil(n/a),o=[];for(let e=0;e<l;e++)o.push(null);let r=0;for(let s=0;s<l;s++){const i=s*a,n=new Audio(`data:audio/x-wav;base64,${e}`);let d=!1;n.oncanplaythrough=()=>{if(!d){d=!0,n.currentTime=i;const e=new AudioContext,h=e.createMediaStreamDestination(),c=new MediaRecorder(h.stream),u=e.createMediaElementSource(n),g=[];u.connect(h),n.play();const y=n.currentTime;c.start(),setTimeout((()=>{c.stop(),n.pause()}),1e3*a),c.ondataavailable=e=>{g.push(e.data)},c.onstop=()=>{const i=new Blob(g,{type:"audio/ogg; codecs=opus"}),n=new FileReader;n.onload=i=>{const n=btoa(i.target.result),a=new Audio(`data:audio/x-wav;base64,${n}`),d=new AudioContext,h=d.createMediaElementSource(a),c=d.createAnalyser();h.connect(c),d.setSinkId({type:"none"}),c.connect(d.destination),c.fftSize=4096;const u=new Uint8Array(c.frequencyBinCount);let g=!1;a.oncanplaythrough=()=>{g||(e.close(),g=!0,o[s]={audio:a,startTime:y,analyser:c,array:u,ctx:d},r+=1,r===l&&(setTimeout((()=>{m(0),this.barPos=0}),500),t(o)))}},n.readAsBinaryString(i)}}}}}}}))}},de=new class{constructor(e,t,s,i){this.masterInfo=e,this.animator=t,this.noteWriter=s,this.addNote=i,this.menus=["source-menu","main-menu","feedback","choose-song-menu"],document.getElementById("close-calibrator-button").addEventListener("click",(()=>{this.endCalibration()})),document.getElementById("faster-button").addEventListener("click",(()=>{this.masterInfo.manualDelay+=1,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`})),document.getElementById("slower-button").addEventListener("click",(()=>{this.masterInfo.manualDelay-=1,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`})),document.getElementById("way-faster-button").addEventListener("click",(()=>{this.masterInfo.manualDelay+=25,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`})),document.getElementById("way-slower-button").addEventListener("click",(()=>{this.masterInfo.manualDelay-=25,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`})),document.getElementById("calibrate-now").addEventListener("click",(()=>{document.getElementById("calibrate-popup").classList.add("hidden"),this.openCalibration()})),document.getElementById("skip-calibrate").addEventListener("click",(()=>{document.getElementById("calibrate-popup").classList.add("hidden")})),document.getElementById("ok-big-calibrate").addEventListener("click",(()=>{document.getElementById("big-calibrate-popup").classList.add("hidden")})),this.thumpAudio=new Audio,this.thumpAudio.setAttribute("src","data:audio/x-wav;base64,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")}openCalibration(e,t){this.closed=!1,this.wasSongMode=e,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`,d("settings"),this.makeMenusInvisible();const s=document.getElementById("calibrator");s.style.top="35%",s.style.left="5%",s.style.width="40vw",s.classList.remove("hidden"),this.startCalibration()}startCalibration(){this.masterInfo.songMode="calibrate",this.animator.runAnimation(),this.addNote("slide-right",50),setTimeout((()=>{this.thumpAudio.play()}),2e3+this.masterInfo.manualDelay),this.calibrationInterval=setInterval((()=>{this.addNote("slide-right",50),setTimeout((()=>{"calibrate"===this.masterInfo.songMode&&this.thumpAudio.play()}),2e3+this.masterInfo.manualDelay)}),2500)}endCalibration(){if(this.closed=!0,this.animator.stopAnimation(),clearInterval(this.calibrationInterval),document.getElementById("calibrator").classList.add("hidden"),this.makeMenusVisible(),g(this.masterInfo,this.noteWriter),setTimeout((()=>{this.masterInfo.songMode=this.wasSongMode}),20),Math.abs(this.masterInfo.manualDelay)>150){const e=document.getElementById("big-calibrate-popup");e.style.top="20%",e.style.left="10vw",e.style.width="70vw",e.style.zIndex="20",e.classList.remove("hidden"),this.masterInfo.effects=!1,document.getElementById("toggle-effects-ball").classList.add("toggle-ball-off"),document.getElementById("effects-title").style.opacity="0.5"}}makeMenusInvisible(){this.menus.forEach((e=>{document.getElementById(e).style.zIndex="-20"}))}makeMenusVisible(){this.menus.forEach((e=>{document.getElementById(e).style.zIndex="5"}))}}(te,ne,ie,ve),he=new class{constructor(e,t,s,i,n,a,l){this.player=t,this.animator=i,this.fileConverter=n,this.noteWriter=a,this.calibrator=l,this.masterInfo=e,this.streamPlayer=s,this.activateSongSelect(),this.activateSettings(),this.activateLevelSelector(),this.activateSlidesSelector((e=>{this.animator.setNumSlides(e)})),this.activateSongControls(),this.activateSongUpload()}activateSongSelect(e=!0){document.getElementById("stages").innerText="";const t={1:"super easy",2:"easy",3:"medium",4:"hard",5:"crazy hard"},s={1:75,2:80,3:85,4:90,5:95};f().then((i=>{const n=`l${i.level}s${i.slides}`,a=s[i.level];document.getElementById("level-sub-title").innerText=`${t[i.level]} / ${i.slides} slides`;const l=i.progress[n],o=Object.keys(l);let d=!0,h=null;B.forEach(((e,t)=>{const s=document.createElement("div");s.classList.add("stage");const i=document.createElement("div");i.classList.add("stage-title"),i.innerText=t===B.length-1?"Bonus songs":`Stage ${t+1}`,s.appendChild(i),document.getElementById("stages").appendChild(s);let n=!0;e.forEach((e=>{const t=document.createElement("div");t.classList.add("song-title-container"),t.id=e;const i=document.createElement("div");i.classList.add("song-mark");const c=document.createElement("div");c.classList.add("song-title");const m=document.createElement("div");if(m.classList.add("song-score"),c.innerText=T[e],o.includes(e))if(m.innerText=`${l[e]}%`,l[e]<a){h||(h=e),m.classList.add("song-score-fail");const t=document.createElement("div");t.classList.add("red-x-a");const s=document.createElement("div");s.classList.add("red-x-b"),i.appendChild(t),i.appendChild(s),n=!1}else{const e=document.createElement("div");e.classList.add("green-check"),i.appendChild(e)}else n=!1,h||(h=e);t.appendChild(i),t.appendChild(c),t.appendChild(m),s.appendChild(t),d&&t.addEventListener("click",(()=>{this.masterInfo.audioLoaded=!1,document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.remove("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))})),document.getElementById("choose-song-menu").classList.add("hidden"),document.getElementById("main-menu").classList.remove("hidden"),document.getElementById("song-to-play").innerText=T[e],fetch(`./songStrings/${e}.txt`).then((t=>{t.text().then((t=>{this.masterInfo.currentSong=T[e],this.masterInfo.songCode=e,this.animator.stopAnimation(),this.player.pause(),this.player.setSource(`data:audio/x-wav;base64,${t}`),r("button-play"),document.getElementById("song-label").innerText=this.masterInfo.currentSong,g(this.masterInfo,this.noteWriter)}))}))}))})),d||s.classList.add("stage-locked"),n||(d=!1)})),this.masterInfo.defaultSong=h,e&&h&&(this.masterInfo.songCode=h,document.getElementById("song-to-play").innerText=T[h])}))}activateSongUpload(){document.getElementById("file-input").addEventListener("change",(e=>{this.player.pause(),this.animator.stopAnimation(),h(),document.getElementById("close-and-play").classList.add("hidden");const t=e.target.files[0],s=new FileReader;s.onload=t=>{const s=btoa(t.target.result),i=e.target.files[0].name.split("");if(".m4a"===i.slice(i.length-4,i.length).join("")){const t=`data:audio/x-wav;base64,${s}`;this.animator.stopAnimation(),this.player.pause(),this.player.setSource(t),r("button-play"),g(this.masterInfo,this.noteWriter),this.masterInfo.currentSong=e.target.files[0].name,document.getElementById("song-label").innerText=this.masterInfo.currentSong,c(),document.getElementById("close-and-play").classList.remove("hidden")}else this.player.setSource(`data:audio/x-wav;base64,${s}`,!1,!1,!0),c(),this.masterInfo.currentSong=e.target.files[0].name,document.getElementById("song-label").innerText=this.masterInfo.currentSong},s.readAsBinaryString(t)}))}activateSongControls(){document.getElementById("button-play").addEventListener("click",(()=>{this.playFunction(),document.getElementById("button-play").classList.remove("pulse"),document.getElementById("button-play-beacon").classList.add("hidden")})),document.getElementById("button-pause").addEventListener("click",(()=>{this.masterInfo.pauseDisabled||this.pauseFunction()})),document.getElementById("button-restart").addEventListener("click",(()=>{this.restartFunction()})),this.masterInfo.spaceFunction=()=>{this.playFunction()}}playFunction(){"stream"===this.masterInfo.songMode||"radio"===this.masterInfo.songMode?(this.streamPlayer.start(),this.animator.runAnimation({player:this.streamPlayer,algorithm:this.masterInfo.algorithm})):("demo"===this.masterInfo.songMode&&this.masterInfo.songCode&&(this.masterInfo.currentSong=T[this.masterInfo.songCode],document.getElementById("song-label").innerHTML=this.masterInfo.currentSong),this.player.start(),this.animator.runAnimation({player:this.player,algorithm:this.masterInfo.algorithm})),r("button-pause"),this.masterInfo.spaceFunction=()=>{this.pauseFunction()}}pauseFunction(){"stream"===this.masterInfo.songMode||"radio"===this.masterInfo.songMode?(this.streamPlayer.stop(),g(this.masterInfo,this.noteWriter)):this.player.pause(),this.animator.stopAnimation(),r("button-play"),this.masterInfo.spaceFunction=()=>{this.playFunction()}}restartFunction(){this.player.restart(),this.animator.stopAnimation(),r("button-play"),g(this.masterInfo,this.noteWriter),this.masterInfo.spaceFunction=()=>{this.playFunction()}}activateSlidesSelector(e){[["slides-2",2],["slides-3",3],["slides-4",4]].forEach((t=>{const s=document.getElementById(t[0]);s.addEventListener("click",(()=>{this.deselectSlides(),this.selectSlides(t[1],e),s.classList.add("level-selected")}))})),f().then((t=>{document.getElementById(`slides-${t.slides}`).classList.add("level-selected"),this.selectSlides(t.slides,e)}))}deselectSlides(){["slides-2","slides-3","slides-4"].forEach((e=>{document.getElementById(e).classList.remove("level-selected")}))}selectSlides(e,t){const s=document.getElementById("slide-a"),i=document.getElementById("slide-b"),n=document.getElementById("a-slide-a"),a=document.getElementById("a-slide-b"),l=document.getElementById("b-slide-a"),o=document.getElementById("b-slide-b"),r=document.getElementById("clear-slide-a"),d=document.getElementById("clear-slide-b"),h=document.getElementById("dummy-a"),c=document.getElementById("dummy-b"),m=document.getElementById("dummy-tapper-a-container"),u=document.getElementById("dummy-tapper-b-container"),g=document.getElementById("slides-container");2===e&&(t(2),s&&(s.classList.add("hidden"),i.classList.add("hidden")),n&&(n.classList.add("hidden"),a.classList.add("hidden")),l&&(l.classList.add("hidden"),o.classList.add("hidden")),r.classList.add("hidden"),d.classList.add("hidden"),h.classList.add("hidden"),c.classList.add("hidden"),m.classList.add("hidden"),u.classList.add("hidden"),g.classList.remove("three-wide-slides-container"),g.classList.remove("four-wide-slides-container")),3===e&&(t(3),document.getElementById("slides-container").classList.add("three-wide-slides-container"),s&&(s.classList.remove("hidden"),i.classList.add("hidden")),n&&(n.classList.remove("hidden"),a.classList.add("hidden")),l&&(l.classList.remove("hidden"),o.classList.add("hidden")),r.classList.remove("hidden"),d.classList.add("hidden"),h.classList.remove("hidden"),c.classList.add("hidden"),m.classList.remove("hidden"),u.classList.add("hidden"),g.classList.add("three-wide-slides-container"),g.classList.remove("four-wide-slides-container")),4===e&&(t(4),s&&(s.classList.remove("hidden"),i.classList.remove("hidden")),n&&(n.classList.remove("hidden"),a.classList.remove("hidden")),l&&(l.classList.remove("hidden"),o.classList.remove("hidden")),r.classList.remove("hidden"),d.classList.remove("hidden"),h.classList.remove("hidden"),c.classList.remove("hidden"),m.classList.remove("hidden"),u.classList.remove("hidden"),g.classList.remove("three-wide-slides-container"),g.classList.add("four-wide-slides-container")),f().then((t=>{t.slides=e,y(t).then((()=>{this.activateSongSelect(!1)}))}))}activateLevelSelector(){[["level-1",1],["level-2",2],["level-3",3],["level-4",4],["level-5",5]].forEach((e=>{s(e[0],(()=>{["level-1","level-2","level-3","level-4","level-5"].forEach((e=>{l(e,"level-selected")})),this.animator.setNotesPerSecond(e[1]),a(e[0],"level-selected"),f().then((t=>{t.level=e[1],y(t).then((()=>{this.activateSongSelect(!1)}))}))}))})),f().then((e=>{this.animator.setNotesPerSecond(e.level),a(`level-${e.level}`,"level-selected")}))}activateSettings(){document.getElementById("show-settings").addEventListener("click",(()=>{document.getElementById("settings-modal").classList.remove("hidden"),document.getElementById("modal-background").classList.remove("hidden")})),s("save-settings",(()=>{this.masterInfo.waitingForKey||d("settings")}));const e=[["change-left","left-key"],["change-a","a-key"],["change-b","b-key"],["change-right","right-key"]];for(let t=0;t<e.length;t++)i(e[t][1],this.masterInfo.tapperKeys[t]),s(e[t][0],(()=>{i(e[t][1],"-"),document.getElementById("change-key-message").innerText="press a key",document.getElementById("save-settings").style.opacity="0.5",this.masterInfo.waitingForKey=[e[t][1],t]}));[["toggle-background","animatedBackground","background-title"],["toggle-sustained","sustainedNotes","sustained-title"],["toggle-calibration","autoCalibrating","calibration-title"],["toggle-haptics","hapticsOnHit","haptics-title"],["toggle-animations","animations","animations-title"],["toggle-effects","effects","effects-title"],["toggle-double","double","double-title"]].forEach((e=>{s(e[0],(()=>{this.masterInfo[e[1]]?(this.masterInfo[e[1]]=!1,document.getElementById(`${e[0]}-ball`).classList.add("toggle-ball-off"),document.getElementById(e[2]).style.opacity="0.5","toggle-calibration"===e[0]&&(this.masterInfo.autoAdjustment=0)):(this.masterInfo[e[1]]=!0,document.getElementById(`${e[0]}-ball`).classList.remove("toggle-ball-off"),document.getElementById(e[2]).style.opacity="1"),f().then((t=>{t[e[1]]=this.masterInfo[e[1]],y(t)}))}))})),document.getElementById("open-calibration").addEventListener("click",(()=>{this.calibrator.openCalibration()}));const t=document.getElementById("reset-button"),n=document.getElementById("reset-checkbox");n.addEventListener("change",(()=>{n.checked?t.disabled=!1:t.disabled=!0}));const a=document.getElementById("select-sustained-frequency");a.addEventListener("change",(()=>{this.masterInfo.sustainedNotesFrequency=a.value,f().then((e=>{e.sustainedNotesFrequency=this.masterInfo.sustainedNotesFrequency,y(e)}))}));const l=document.getElementById("select-double-frequency");l.addEventListener("change",(()=>{this.masterInfo.doubleFrequency=l.value,f().then((e=>{e.doubleFrequency=this.masterInfo.doubleFrequency,y(e)}))})),t.addEventListener("click",(()=>{f().then((e=>{e.progress={l1s2:{},l1s3:{},l1s4:{},l2s2:{},l2s3:{},l2s4:{},l3s2:{},l3s3:{},l3s4:{},l4s2:{},l4s3:{},l4s4:{},l5s2:{},l5s3:{},l5s4:{}},y(e),t.disabled="disabled",n.checked=!1,this.activateSongSelect()}))}))}toggleFullscreen(){return new Promise((e=>{document.isFullscreen?document.exitFullscreen().then((()=>{e()})):document.getElementById("game-container").requestFullscreen().then((()=>{e()}))}))}recalculateLengths(){setTimeout((()=>{if(o()){const e=document.getElementById("game-container").clientHeight;this.masterInfo.travelLength=w.mobile.travelLength*e;const t=Math.floor(this.masterInfo.travelLength/(this.masterInfo.songDelay/1e3/2));this.masterInfo.targetBounds.top=w.mobile.targetBounds.top*this.masterInfo.travelLength,this.masterInfo.targetBounds.bottom=w.mobile.targetBounds.bottom*this.masterInfo.travelLength,this.masterInfo.noteSpeed=t,this.masterInfo.maxTailLength=1*w.mobile.maxTailLength*this.masterInfo.travelLength,this.masterInfo.slideLength=1.3*this.masterInfo.travelLength}else{const e=document.getElementById("game-container").clientHeight,t=document.getElementById("game-container").clientWidth;let s=Math.min(t,e);this.masterInfo.vMin=s,this.masterInfo.slideLength=1.5*s,this.masterInfo.travelLength=1.365*s;const i=1*this.masterInfo.travelLength/(this.masterInfo.songDelay/1e3/2);this.masterInfo.targetBounds.top=w.mobile.targetBounds.top*this.masterInfo.travelLength,this.masterInfo.targetBounds.bottom=w.mobile.targetBounds.bottom*this.masterInfo.travelLength,this.masterInfo.noteSpeed=i,this.masterInfo.maxTailLength=1*w.mobile.maxTailLength*this.masterInfo.travelLength,this.masterInfo.slideLength=1.3*this.masterInfo.travelLength}}),500)}}(te,ae,le,ne,re,ie,de);let ce=new b(te,le,(function e(){ce=new b(te,le,e),me.connector=ce}));const me=new class{constructor(e,t,s,i,n,a,l){this.masterInfo=e,this.controlsManager=t,this.stationManager=i,this.player=s,this.streamPlayer=n,this.noteWriter=a,this.connector=l,this.menus=["source-menu","main-menu","feedback","choose-song-menu"],this.mainMenuOptions=["choose-song-button","upload-song-button","select-station-button","show-stream-modal-button"],this.activateMenuShowButtons(),this.activateSourceMenuButtons(),this.activateMainMenu(),this.activateFeedbackMenu(),this.activateGiveFeedbackMenu(),this.activateControlsDrag(),this.hideMenus()}activateControlsDrag(){const e=document.getElementById("controls-bottom");let t=!1,s=0,i=0;const n=window.innerWidth,a=window.innerHeight;let l;e.addEventListener("touchstart",(n=>{l=setTimeout((()=>{t=!0;const a=e.getBoundingClientRect();s=n.targetTouches[0].clientX-a.left,i=n.targetTouches[0].clientY-a.top,e.style.opacity="1"}),500)})),e.addEventListener("touchend",(()=>{t=!1,clearTimeout(l),e.style.opacity="0.5"})),document.addEventListener("touchmove",(l=>{if(t){e.classList.remove("stuck-to-bottom");let t=l.changedTouches[0].clientX-s,o=l.changedTouches[0].clientY-i;const r=e.getBoundingClientRect();t<0&&(t=0),t>n-(r.right-r.left)&&(t=n-(r.right-r.left)),o<0&&(o=0),o>a-(r.bottom-r.top)&&(o=a-(r.bottom-r.top)),e.style.top=`${o}px`,e.style.left=`${t}px`,(l.changedTouches[0].clientX<.15*n||l.changedTouches[0].clientX>.85*n)&&e.classList.add("controls-vertical"),l.changedTouches[0].clientY>.85*a&&e.classList.remove("controls-vertical")}}))}activateGiveFeedbackMenu(){s("open-feedback-link",(()=>{document.userFeedbackOpen=!0,document.getElementById("give-feedback-modal").classList.remove("hidden"),document.getElementById("give-feedback-modal").classList.add("menu"),document.getElementById("modal-background").classList.remove("hidden"),document.getElementById("settings-modal").classList.add("hidden")})),s("cancel-give-feedback",(()=>{document.getElementById("give-feedback-modal").classList.add("hidden"),document.getElementById("give-feedback-modal").classList.remove("menu"),document.getElementById("modal-background").classList.add("hidden"),document.getElementById("settings-modal").classList.remove("hidden"),document.userFeedbackOpen=!1})),s("submit-give-feedback",(()=>{const e=document.getElementById("feedback-message").value;if(e.length<3)alert("Cannot submit empty message!");else{document.getElementById("cancel-give-feedback").disabled="disabled",document.getElementById("submit-give-feedback").disabled="disabled";let t=document.getElementById("feedback-email").value;t.length<1&&(t="none"),fetch("https://beatburner.com/api/feedback.php",{method:"POST",body:JSON.stringify({message:e,email:t})}).then((()=>{document.getElementById("give-feedback-modal").innerHTML="Thanks!",setTimeout((()=>{document.getElementById("give-feedback-modal").classList.add("hidden"),document.getElementById("give-feedback-modal").classList.remove("menu"),document.getElementById("settings-modal").classList.remove("hidden"),document.userFeedbackOpen=!1}),1e3)}))}}))}activateFeedbackMenu(){s("replay",(()=>{this.player.restart(),this.controlsManager.playFunction(),this.hideMenus()})),document.getElementById("no-replay").addEventListener("click",(()=>{"demo"===this.masterInfo.songMode?this.showMenu("choose-song-menu"):this.showMenu("main-menu")}))}activateMainMenu(){document.getElementById("choose-song-button").addEventListener("click",(()=>{document.getElementById("choose-song-menu").classList.remove("hidden"),document.getElementById("main-menu").classList.add("hidden")})),s("close-and-play",(()=>{this.hideMenus(),"radio"===this.masterInfo.songMode?this.stationManager.startListening():this.controlsManager.playFunction()}))}activateSourceMenuButtons(){s("source-demo-songs",(()=>{this.masterInfo.canEnterCode=!1,this.masterInfo.songMode="demo",this.setMainMenuOption("choose-song-button"),this.masterInfo.audioLoaded||(document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.remove("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))})),this.masterInfo.defaultSong?fetch(`./songStrings/${this.masterInfo.defaultSong}.txt`).then((e=>{e.text().then((e=>{this.masterInfo.currentSong=T[this.masterInfo.defaultSong],this.player.pause(),this.player.setSource(`data:audio/x-wav;base64,${e}`),r("button-play"),document.getElementById("song-label").innerText=this.masterInfo.currentSong,g(this.masterInfo,this.noteWriter),this.masterInfo.defaultSong=null}))})):this.masterInfo.currentSong&&(this.masterInfo.currentSong=T[this.masterInfo.songCode])),this.showMenu("main-menu"),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening()})),s("source-upload",(()=>{this.masterInfo.canEnterCode=!1,this.masterInfo.songMode="upload",this.setMainMenuOption("upload-song-button"),this.masterInfo.audioLoaded||(document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))}))),this.showMenu("main-menu"),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening()})),s("source-radio",(()=>{this.masterInfo.canEnterCode=!1,document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.songMode="radio",this.setMainMenuOption("select-station-button"),this.showMenu("main-menu"),this.masterInfo.currentSong="Hawk classic rock",document.getElementById("close-and-play").classList.remove("hidden")})),document.getElementById("source-streaming").addEventListener("click",(()=>{this.masterInfo.canEnterCode=!1,document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.songMode="stream",this.setMainMenuOption("show-stream-modal-button"),document.getElementById("source-menu").classList.add("hidden"),document.getElementById("stream-modal").classList.remove("hidden"),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening()})),document.getElementById("show-stream-modal-button").addEventListener("click",(()=>{document.getElementById("main-menu").classList.add("hidden"),document.getElementById("stream-modal").classList.remove("hidden")}))}setMainMenuOption(e){this.mainMenuOptions.forEach((e=>{document.getElementById(e).classList.add("hidden")})),document.getElementById(e).classList.remove("hidden")}activateMenuShowButtons(){document.getElementById("show-menu").addEventListener("click",(()=>{this.masterInfo.songMode&&"tutorial"!==this.masterInfo.songMode&&(this.showMenu("main-menu"),this.player.pause(),this.streamPlayer.stop(),this.player.countdownCanceled=!0)})),document.getElementById("show-source-menu").addEventListener("click",(()=>{this.masterInfo.canEnterCode=!0,g(this.masterInfo,this.noteWriter),document.getElementById("song-label").innerHTML="",this.masterInfo.currentSong="",this.showMenu("source-menu"),this.player.pause(),this.streamPlayer.stopStream(),this.stationManager.stopListening(),this.connector.closeConnection()})),document.getElementById("back-to-main-menu").addEventListener("click",(()=>{this.showMenu("main-menu")}))}showMenu(e){this.hideMenus(),document.getElementById(e).classList.remove("hidden")}hideMenus(){this.menus.forEach((e=>{document.getElementById(e).classList.add("hidden")}))}}(te,he,ae,oe,le,ie,ce),ue=new class{constructor(e,t,s,i,n,a){this.masterInfo=e,this.controlsManager=t,this.animator=s,this.player=i,this.noteWriter=n,this.addNote=a,this.playing=!1,this.playingSong=!1,this.nextNoteIdx=0,this.releaseTime=0,this.notesHit=0,this.notesMissed=0,this.activateTutorial(),this.songNotes=[[1.943831,"slide-left"],[2.46194,"slide-left"],[2.93213,"slide-left"],[3.261772,"slide-left"],[4.071073,"slide-left"],[4.888844,"slide-left"],[5.451498,"slide-left"],[6.268138,"slide-a"],[6.987352,"slide-a"],[8.352035,"slide-right"],[8.825848,"slide-right"],[9.208735,"slide-right"],[9.891026,"slide-right"],[9.924831,"slide-a"],[10.621651,"slide-a"],[11.383086,"slide-left"],[12.181558,"slide-left"],[12.771304,"slide-left"],[13.58432,"slide-a"],[14.199451,"slide-a"],[14.200682,"slide-left"],[14.686029,"slide-a"],[15.077,"slide-right"],[15.675686,"slide-right"],[16.119929,"slide-left"],[16.508924,"slide-left"],[17.253228,"slide-left"],[17.677042,"slide-right"],[18.665896,"slide-a"],[19.041213,"slide-right"],[19.408597,"slide-left"],[20.096563,"slide-right"],[20.10311,"slide-left"],[20.551235,"slide-left"],[20.879712,"slide-right"],[21.570719,"slide-left"],[22.017696,"slide-a"],[22.403017,"slide-left"],[23.010386,"slide-a"],[23.477792,"slide-a"],[23.80235,"slide-left"],[24.520093,"slide-a"],[24.961103,"slide-a"],[25.335092,"slide-left"],[25.880481,"slide-right"],[26.416421,"slide-right"],[26.818142,"slide-a"],[27.329045,"slide-left"],[27.839089,"slide-left"],[27.847059,"slide-a"],[28.193594,"slide-left"],[28.977664,"slide-left"],[29.383244,"slide-right"],[29.391985,"slide-a"],[29.722685,"slide-a"],[30.819628,"slide-a"],[31.119825,"slide-left"],[31.876483,"slide-right"],[32.269131,"slide-right"],[32.636287,"slide-left"],[33.258386,"slide-a"],[33.687021,"slide-right"],[34.102092,"slide-right"],[34.637631,"slide-a"],[34.825343,"slide-left"],[35.202356,"slide-right"],[35.543482,"slide-right"],[36.229869,"slide-a"],[36.702039,"slide-a"],[37.002433,"slide-a"],[37.59896,"slide-left"],[37.782288,"slide-a"],[38.152062,"slide-a"],[38.480706,"slide-a"],[39.166,"slide-left"],[39.60085,"slide-right"],[39.903795,"slide-left"],[40.711821,"slide-left"],[41.138345,"slide-left"],[42.049796,"slide-left"],[42.477504,"slide-left"],[42.66329,"slide-right"],[42.892988,"slide-left"],[43.436948,"slide-right"],[43.447235,"slide-left"],[43.977588,"slide-a"],[44.30976,"slide-right"],[45.458284,"slide-left"],[46.470486,"slide-right"],[46.898406,"slide-left"],[47.236151,"slide-a"],[47.911318,"slide-left"],[48.355652,"slide-a"],[48.711462,"slide-left"],[49.265738,"slide-a"],[49.816343,"slide-left"],[50.205555,"slide-right"],[50.217131,"slide-a"],[50.83423,"slide-right"],[51.633747,"slide-left"],[52.34084,"slide-a"],[52.785104,"slide-left"],[53.074742,"slide-right"],[54.200097,"slide-left"],[54.569704,"slide-left"],[55.23889,"slide-left"],[55.723891,"slide-left"],[56.055633,"slide-left"],[56.578485,"slide-left"],[56.749268,"slide-left"],[57.156046,"slide-right"],[58.092507,"slide-a"],[58.252219,"slide-right"],[58.647402,"slide-right"],[58.963944,"slide-left"],[59.704233,"slide-left"],[60.130858,"slide-left"],[61.056442,"slide-left"],[61.528066,"slide-right"],[61.891473,"slide-left"],[62.454313,"slide-left"],[62.627828,"slide-a"],[62.966183,"slide-left"],[63.365505,"slide-left"],[64.106267,"slide-left"],[64.489571,"slide-left"],[64.829666,"slide-left"],[65.956729,"slide-left"],[66.322777,"slide-left"],[67.370048,"slide-right"],[67.733991,"slide-a"],[68.460176,"slide-right"],[68.467931,"slide-left"],[68.869097,"slide-right"],[69.224845,"slide-right"],[69.890504,"slide-a"],[70.331709,"slide-a"],[70.683683,"slide-right"],[70.693289,"slide-a"],[71.376449,"slide-a"],[71.751753,"slide-left"],[71.757064,"slide-a"],[72.123742,"slide-a"],[72.131217,"slide-left"],[73.220055,"slide-right"],[73.231204,"slide-a"],[73.581908,"slide-a"],[73.603726,"slide-right"],[74.236397,"slide-left"],[74.777472,"slide-right"],[75.077161,"slide-a"],[75.711161,"slide-a"],[76.198607,"slide-a"],[76.527807,"slide-left"],[77.123927,"slide-left"],[77.132386,"slide-a"],[77.593554,"slide-a"],[77.925786,"slide-left"],[78.625694,"slide-left"],[79.083081,"slide-right"],[79.102485,"slide-a"],[79.448487,"slide-right"],[80.062396,"slide-right"],[80.069648,"slide-left"],[80.539922,"slide-right"],[80.865434,"slide-left"],[81.477818,"slide-right"],[81.492786,"slide-left"],[81.971707,"slide-left"],[82.390223,"slide-left"],[83.086038,"slide-left"],[83.095862,"slide-right"],[83.469737,"slide-left"],[83.477005,"slide-a"],[83.819914,"slide-a"],[83.828195,"slide-left"],[84.5346,"slide-left"],[84.934407,"slide-right"],[84.944366,"slide-left"],[85.837949,"slide-right"],[86.025258,"slide-a"],[86.452148,"slide-left"],[87.06509,"slide-left"],[87.391524,"slide-right"],[87.392957,"slide-a"],[87.88303,"slide-a"],[87.892487,"slide-right"],[88.293713,"slide-left"],[88.310089,"slide-right"],[88.8714,"slide-a"],[88.879422,"slide-left"],[89.316545,"slide-left"],[89.715283,"slide-left"],[90.211734,"slide-left"],[90.417352,"slide-a"],[90.820264,"slide-right"],[91.190637,"slide-right"],[91.76351,"slide-right"],[91.777049,"slide-a"],[92.254535,"slide-a"],[92.651679,"slide-a"],[93.21941,"slide-right"],[93.224337,"slide-a"],[93.735028,"slide-a"],[94.053814,"slide-left"],[94.759652,"slide-right"],[94.776053,"slide-left"],[95.243925,"slide-a"],[95.576649,"slide-left"],[96.202458,"slide-left"],[96.640634,"slide-a"],[97.023522,"slide-left"],[97.714649,"slide-left"],[99.62146,"slide-left"],[99.938512,"slide-a"],[99.949915,"slide-right"],[100.508893,"slide-left"],[100.519563,"slide-a"],[100.999325,"slide-left"],[101.302508,"slide-left"],[101.984086,"slide-right"],[101.994815,"slide-a"],[102.207472,"slide-a"],[102.821043,"slide-left"],[103.535615,"slide-left"],[104.015683,"slide-left"],[104.353905,"slide-left"],[105.022819,"slide-left"],[105.423756,"slide-left"],[105.431557,"slide-a"],[105.785448,"slide-a"],[105.792439,"slide-left"],[106.523045,"slide-a"],[106.899581,"slide-right"],[106.906163,"slide-left"],[107.237517,"slide-left"],[107.245444,"slide-right"],[107.901745,"slide-left"],[108.323757,"slide-left"],[108.328904,"slide-a"],[108.703916,"slide-right"],[108.712152,"slide-a"],[109.361246,"slide-left"],[109.800983,"slide-a"],[109.805361,"slide-left"],[110.244485,"slide-left"],[110.869287,"slide-right"],[111.310829,"slide-left"],[111.63546,"slide-left"],[112.326915,"slide-left"],[112.691335,"slide-left"],[112.702023,"slide-a"],[113.091933,"slide-a"],[113.810393,"slide-a"],[114.208271,"slide-left"]],this.discoNotes=[[1.19,"slide-right"],[1.922975,"slide-right"],[2.64964,"slide-right"],[3.377775,"slide-right"],[4.146296,"slide-a"],[4.872564,"slide-right"],[5.634179,"slide-a"],[6.408622,"slide-right"],[7.138499,"slide-a"],[7.874535,"slide-right"],[8.258339,"slide-a"],[8.63395,"slide-left"],[8.977888,"slide-a"],[9.371591,"slide-right"],[9.746593,"slide-a"],[10.138783,"slide-left"],[10.498193,"slide-right"],[10.842692,"slide-a"],[11.218358,"slide-left"],[11.609946,"slide-right"],[12.010881,"slide-a"],[12.392757,"slide-left"],[13.170044,"slide-right"],[13.174042,"slide-left"],[13.531695,"slide-right"],[13.534294,"slide-left"],[13.912671,"slide-a"],[14.249677,"slide-right"],[14.254705,"slide-left"],[14.650833,"slide-left"],[14.654185,"slide-right"],[15.017858,"slide-right"],[15.030018,"slide-left"],[15.387001,"slide-left"],[15.390133,"slide-right"],[15.738058,"slide-a"],[16.146802,"slide-right"],[16.147137,"slide-left"],[16.489328,"slide-right"],[16.494338,"slide-left"],[16.857548,"slide-right"],[16.862264,"slide-left"],[17.193792,"slide-a"],[17.5948,"slide-a"],[17.986405,"slide-a"],[18.329925,"slide-right"],[18.738044,"slide-left"],[19.12176,"slide-a"],[19.483749,"slide-right"],[19.874464,"slide-left"],[20.232436,"slide-a"],[20.610403,"slide-right"],[20.970376,"slide-left"],[21.361784,"slide-a"],[21.722043,"slide-right"],[22.121884,"slide-left"],[22.499471,"slide-a"],[22.842589,"slide-right"],[23.218096,"slide-left"],[23.602082,"slide-a"],[23.784487,"slide-right"],[23.951953,"slide-left"],[24.193287,"slide-a"],[24.369036,"slide-right"],[24.551924,"slide-left"],[24.768837,"slide-a"],[25.146323,"slide-right"],[25.150288,"slide-left"],[25.511269,"slide-left"],[25.517514,"slide-right"],[25.87464,"slide-left"],[25.878253,"slide-right"],[26.234565,"slide-a"],[26.610134,"slide-right"],[26.610444,"slide-left"],[27.010181,"slide-right"],[27.014541,"slide-left"],[27.361866,"slide-a"],[28.154237,"slide-right"],[28.497921,"slide-a"],[28.891411,"slide-left"],[29.25036,"slide-a"],[29.634488,"slide-right"],[30.009608,"slide-a"],[30.362295,"slide-left"],[31.136506,"slide-a"],[31.52254,"slide-right"],[31.897354,"slide-left"],[32.264439,"slide-a"],[32.648243,"slide-right"],[32.993442,"slide-left"],[33.345854,"slide-a"],[34.13925,"slide-right"],[34.519922,"slide-a"],[34.907673,"slide-left"],[35.257546,"slide-a"],[35.611168,"slide-right"],[35.986129,"slide-left"],[36.200561,"slide-a"],[36.400863,"slide-right"],[37.178502,"slide-a"],[37.530883,"slide-a"],[37.906575,"slide-a"],[38.225291,"slide-right"],[38.247843,"slide-left"],[38.626289,"slide-a"],[39.002181,"slide-a"],[39.346522,"slide-right"],[39.350585,"slide-left"],[40.122632,"slide-right"],[40.520381,"slide-a"],[40.882019,"slide-left"],[41.234331,"slide-a"],[41.602364,"slide-right"],[42.018461,"slide-left"],[42.376155,"slide-a"],[43.122075,"slide-left"],[43.536439,"slide-right"],[43.906681,"slide-a"],[44.241316,"slide-left"],[44.62633,"slide-right"],[45.01045,"slide-a"],[45.361377,"slide-left"],[46.152597,"slide-right"],[46.506386,"slide-a"],[46.858254,"slide-left"],[47.225891,"slide-a"],[47.624301,"slide-right"],[47.977508,"slide-left"],[48.178056,"slide-a"],[48.352211,"slide-right"],[49.146588,"slide-a"],[49.505543,"slide-a"],[49.906918,"slide-a"],[50.275103,"slide-a"],[50.651123,"slide-a"],[51.010337,"slide-a"],[51.346576,"slide-right"],[51.364152,"slide-left"],[52.114427,"slide-a"],[52.508613,"slide-a"],[52.866701,"slide-a"],[53.266569,"slide-a"],[53.593583,"slide-a"],[53.976023,"slide-a"],[54.313979,"slide-right"],[54.334786,"slide-left"]]}activateTutorial(){document.getElementById("source-tutorial").addEventListener("click",(()=>{document.getElementById("source-menu").classList.add("hidden"),document.getElementById("close-tutorial").classList.remove("hidden"),this.startTutorial()})),document.getElementById("close-tutorial").addEventListener("click",(()=>{this.exitTutorial()})),[3,4,6,8,12].forEach((e=>{document.getElementById(`tutorial-${e}-button`).addEventListener("click",(()=>{this.triggerTutorialStep(e)}))})),document.getElementById("repeat-tutorial-song-button").addEventListener("click",(()=>{document.getElementById("tutorial-step-7").classList.add("hidden"),this.triggerTutorialStep(6)})),document.getElementById("tap-smudge").addEventListener("click",(()=>{this.triggerTutorialStep(4)}))}triggerTutorialStep(e){const t=document.getElementById("tutorial-arrow");if(1===e){this.exited=!1;const e=document.getElementById("tutorial-step-1");e.style.top="20vh",e.style.left="2vh",e.classList.remove("hidden"),this.animator.runAnimation(),this.addNote("slide-left",50),setTimeout((()=>{this.exited||this.addNote("slide-right",50)}),800),setTimeout((()=>{this.exited||(this.addNote("slide-a",50),setTimeout((()=>{this.exited||(this.animator.stopAnimation(),this.triggerTutorialStep(2))}),1990))}),1500)}if(2===e){const e=document.getElementById("tutorial-step-2");e.style.top="45vh",e.style.left="2vh",e.classList.remove("hidden"),t.style.top="65vh",t.style.left="65vw",t.style.transform="rotate(270deg)",t.classList.remove("hidden")}if(3===e){t.style.top="74vh",t.style.left="62vw",t.style.transform="rotate(225deg)",t.classList.remove("hidden"),document.getElementById("tap-smudge").classList.remove("hidden"),document.getElementById("tutorial-step-1").classList.add("hidden"),document.getElementById("tutorial-step-2").classList.add("hidden");const e=document.getElementById("tutorial-step-3");e.style.top="50vh",e.style.left="2vh",e.style.width="75vw",e.classList.remove("hidden")}if(4===e&&(document.getElementById("tap-smudge").classList.add("hidden"),document.getElementById("tutorial-step-3").classList.add("hidden"),t.classList.add("hidden"),this.discoAudio=new Audio,fetch("./songStrings/discoBeat.txt").then((e=>{e.text().then((e=>{this.discoAudio.setAttribute("src",`data:audio/x-wav;base64,${e}`)}))})),this.discoAudio.addEventListener("ended",(()=>{this.playing=!1,this.masterInfo.streak<10&&(this.discoAudio.currentTime=0,this.nextNoteIdx=0,this.discoAudio.play(),this.animateDisco(this.discoAudio,this.discoNotes))})),this.masterInfo.streak=0,this.animator.runAnimation(),this.playing=!0,this.beatInterval=setInterval((()=>{const e=["slide-left","slide-a","slide-right"][Math.floor(3*Math.random())];this.addNote(e),this.releaseTime=performance.now(),this.masterInfo.streak>6&&(clearInterval(this.beatInterval),this.playing=!1,setTimeout((()=>{document.getElementById("rock-label").innerHTML="Match <br> the <br> beat"}),2500),setTimeout((()=>{document.getElementById("rock-label").innerHTML=""}),5e3),this.masterInfo.streak=0,this.playingSong=!0,this.discoAudio.currentTime=1,this.discoAudio.volume=0,this.discoAudio.play(),this.animateDisco(this.discoAudio,this.discoNotes))}),1e3)),5===e){document.getElementById("rock-label").innerHTML="";const e=document.getElementById("tutorial-step-5");e.style.top="2vh",e.style.left="40vw",e.style.width="50vw",e.classList.remove("hidden")}if(6===e){this.discoAudio&&(this.discoAudio.pause(),this.discoAudio.currentTime=0),this.playingSong=!1,document.getElementById("tutorial-step-5").classList.add("hidden"),this.songAudio=new Audio,this.animator.runAnimation();let e=!1;this.songAudio.oncanplaythrough=()=>{e||(e=!0,this.notesHit=0,this.notesMissed=0,this.nextNoteIdx=0,this.player.countdown(),setTimeout((()=>{this.playingRealSong=!0,this.playing=!1,this.songAudio.play(),this.animateNotes(this.songAudio,this.songNotes)}),3e3))},this.songAudio.addEventListener("ended",(()=>{this.playingSong=!1,this.animator.stopAnimation();const e=Math.floor(100*this.notesHit/(this.songNotes.length+this.notesMissed));let t=`Nice job! You had an accuracy of ${e}%`;e<90?(t=`Hey, not bad. Your accuracy was ${e}%. Want to retry and go for ${Math.min(90,e+20)}%?`,e<60&&(t=`Your accuracy was ${e}%. I bet you can do better.`)):document.getElementById("repeat-tutorial-song-button").classList.add("hidden"),document.getElementById("step-7-text").innerHTML=t;const s=document.getElementById("tutorial-step-7");s.style.top="20vh",s.style.left="2vh",s.style.width="60vw",s.classList.remove("hidden")})),fetch("./songStrings/shareLove.txt").then((e=>{e.text().then((e=>{this.songAudio.setAttribute("src",`data:audio/x-wav;base64,${e}`)}))}))}if(8===e){document.getElementById("tutorial-step-7").classList.add("hidden");const e=document.getElementById("tutorial-step-8");e.style.top="20vh",e.style.left="30vw",e.style.width="55vw",e.classList.remove("hidden"),document.getElementById("controls-bottom").classList.remove("hidden")}if(9===e){document.getElementById("tutorial-step-8").classList.add("hidden");const e=document.getElementById("tutorial-step-9");e.style.top="20vh",e.style.right="15vw",e.style.width="60vw",e.classList.remove("hidden"),t.style.top="45vh",t.style.left="73vw",t.style.transform="rotate(90deg)",t.classList.remove("hidden")}if(10===e){document.getElementById("controls-bottom").classList.remove("hidden"),document.getElementById("tutorial-step-9").classList.add("hidden");const e=document.getElementById("tutorial-step-10");e.style.top="60vh",e.style.left="15vw",e.style.width="60vw",e.classList.remove("hidden"),t.style.top="87vh",t.style.left="46vw",t.style.transform="rotate(180deg)",t.classList.remove("hidden")}if(11===e){t.classList.add("hidden"),document.getElementById("tutorial-step-10").classList.add("hidden");const e=document.getElementById("tutorial-step-11");e.style.top="20vh",e.style.left="15vw",e.style.width="60vw",e.classList.remove("hidden")}12===e&&(document.getElementById("tutorial-step-8").classList.add("hidden"),this.exitTutorial())}animateNotes(e,t){if(this.playingRealSong){const s=e.currentTime+2;let i=t[this.nextNoteIdx];if(void 0!==i){for(;i[0]<s;){if(this.addNote(i[1]),this.nextNoteIdx+=1,this.nextNoteIdx>t.length-1)return;i=t[this.nextNoteIdx]}requestAnimationFrame((()=>this.animateNotes(e,t)))}}}animateDisco(e,t){if(this.playingSong){if(this.masterInfo.streak>10&&this.triggerTutorialStep(5),e.volume<1){const t=(e.currentTime-1)/6;e.volume=Math.min(t,1)}const s=e.currentTime-3.83;let i=t[this.nextNoteIdx];if(void 0!==i){for(;i[0]<s;){if(this.addNote(i[1]),this.releaseTime=performance.now(),this.nextNoteIdx+=1,this.nextNoteIdx>t.length-1)return;i=t[this.nextNoteIdx]}requestAnimationFrame((()=>this.animateDisco(e,t)))}}}triggerNoteAttempt(e){const t=document.getElementById("rock-label");if(t.classList.add("static-rock"),(this.playingSong||this.playingRealSong)&&(e?this.notesHit+=1:this.notesMissed+=1),this.playing){const s=performance.now()-this.releaseTime;e?(t.innerHTML="NICE!",setTimeout((()=>{t.innerHTML=""}),500)):(s<1e3&&s>750&&(t.innerHTML="bit <br> early",setTimeout((()=>{t.innerHTML=""}),500)),s>0&&s<250&&(t.innerHTML="bit <br> late",setTimeout((()=>{t.innerHTML=""}),500)))}}startTutorial(){this.masterInfo.songMode="tutorial",document.getElementById("controls-bottom").classList.add("hidden"),this.controlsManager.deselectSlides(),this.controlsManager.selectSlides(3,(e=>{this.animator.setNumSlides(e)})),document.getElementById("slides-3").classList.add("level-selected"),this.triggerTutorialStep(1),this.masterInfo.autoCalibrating=!1}exitTutorial(){this.exited=!0,this.nextNoteIdx=0,this.discoAudio&&(this.discoAudio.pause(),this.discoAudio.currentTime=0),this.songAudio&&(this.songAudio.pause(),this.songAudio.currentTime=0),document.getElementById("tap-smudge").classList.add("hidden"),document.getElementById("source-menu").classList.remove("hidden"),document.getElementById("controls-bottom").classList.remove("hidden"),["close-tutorial","tutorial-arrow","tutorial-step-1","tutorial-step-2","tutorial-step-3","tutorial-step-5","tutorial-step-7","tutorial-step-8","tutorial-step-9","tutorial-step-10","tutorial-step-11"].forEach((e=>{document.getElementById(e).classList.add("hidden")})),this.animator.stopAnimation(),setTimeout((()=>{document.getElementById("rock-label").classList.remove("static-rock"),clearInterval(this.beatInterval),this.playingSong=!1,this.playing=!1,g(this.masterInfo,this.noteWriter),this.masterInfo.songMode=void 0,f().then((e=>{this.masterInfo.autoCalibrating=e.autoCalibrating}))}),300),f().then((e=>{e.level=1,this.animator.setNotesPerSecond(e.level),["level-1","level-2","level-3","level-4","level-5"].forEach((e=>{document.getElementById(e).classList.remove("level-selected")})),document.getElementById("level-1").classList.add("level-selected"),this.controlsManager.activateSongSelect(),y(e)}))}}(te,he,ne,ae,ie,ve);document.isFullscreen=!1,document.wantFullscreenReturn=!1;const ge=document.getElementById("calibrate-popup");function ye(e){document.getElementById(e).style.backgroundColor="rgba(168,0,93,0.2)",_[e]=!1;const t={"tapper-left":"slide-left","tapper-a":"slide-a","tapper-b":"slide-b","tapper-right":"slide-right"},s=X[t[e]];s&&(X[t[e]]=null,s.height>.1*j&&ae.setVolume(.3),s.note.remove(),G[t[e]]=null);const i=document.getElementById(`${t[e]}-flash-sustain`);i&&i.remove()}function fe(e,t,s){te.canEnterCode&&function(e){if(e===Se[ke]){if(ke+=1,!Se[ke]){const e={};["l1s2","l1s3","l1s4","l2s2","l2s3","l2s4","l3s2","l3s3","l3s4","l4s2","l4s3","l4s4","l5s2","l5s3","l5s4"].forEach((t=>{const s={};B.forEach((e=>{e.forEach((e=>{s[e]=90}))})),e[t]=s})),f().then((t=>{t.progress=e,y(t).then((()=>{he.activateSongSelect(!1)}))}))}}else ke=0}(t),_[e]=!0;let i=500,n=0,a=null;if(Z.forEach((e=>{if(t===e.slideId){const t=e.position-te.travelLength;Math.abs(t)<i&&(a=e,i=t,t<80&&(n+=1))}})),te.autoCalibrating){const e=.1*te.travelLength,t=.1*te.travelLength;1===n&&Math.abs(i)<e&&(te.autoAdjustment+=i/(10*Z.size)*1,te.autoAdjustment=Math.max(te.autoAdjustment,-1*t),te.autoAdjustment=Math.min(te.autoAdjustment,1*t))}document.getElementById(e).style.backgroundColor="rgba(255, 166, 0, 0.2)";const l=K[t];if(0===l.size&&Be(),l.has(a)){Z.delete(a),a.note.remove(),a.note.classList.add(s),K[t].delete(a);let i=!1;if(a.tail){i=!0,X[t]=a.tail,a.tail.note.classList.add("tail-active"),a.tail.cloud.classList.remove("hidden");const s=document.createElement("div");s.classList.add("note-lighted");const n=document.createElement("div");n.classList.add("note-middle-lighted");const l=document.createElement("div");l.appendChild(s),l.appendChild(n),document.getElementById(`dummy-${e}`).appendChild(l),l.classList.add("flash-sustain"),l.id=`${t}-flash-sustain`;const o=te.travelLength-a.tail.position;a.tail.note.style.height=`${o}px`,a.tail.height=o}!function(e,t,s){const i=be[ne.notesPerSecond],n=Ee[ne.notesPerSecond];if(te.hapticsOnHit&&M.impact({style:k.kn.Light}),te.streaming?le.setVolume(1):"radio"!==te.songMode&&ae.setVolume(1),!s){const s=document.createElement("div");s.classList.add("note-lighted");const i=document.createElement("div");i.classList.add("note-middle-lighted");const n=document.createElement("div");n.id=`${e}-flash`,n.appendChild(s),n.appendChild(i),document.getElementById(`dummy-${t}`).appendChild(n),n.classList.add("flash"),setTimeout((()=>{n.remove()}),1e3)}if(ne.recordNoteHit(),te.streak+=1,te.songStreak+=1,te.streak<i+1){const e=document.createElement("div");e.classList.add(n),document.getElementById("streak-channel").appendChild(e)}if(te.songNotesHit+=1,"tutorial"!==te.songMode){const e=document.getElementById("rock-label");te.streak>i&&(document.getElementById("streak-number").innerHTML=te.streak),te.streak===i&&(document.getElementById("streak-container").classList.remove("hidden"),te.animations&&document.getElementById("streak-container").classList.add("bulge"),document.getElementById("streak-number").innerHTML=te.streak,document.getElementById("streak-channel").classList.add("streak-channel-lit"),document.getElementById("streak-meter").classList.add("streak-meter-lit")),200===te.streak&&(document.getElementById("slides").classList.add("on-fire"),e.innerHTML="ON FIRE!",e.classList.add("rock-label"),we=!0,setTimeout((()=>{e.classList.remove("rock-label"),e.innerHTML="",we=!1}),1300)),te.streak>200&&(we||(e.classList.add("static-rock"),e.innerText=te.streak)),1e3===te.streak&&(e.innerHTML="HOLY<br>SHIT!",we=!0,setTimeout((()=>{we=!1}),2e3))}}(t,e,i),"tutorial"===te.songMode&&ue.triggerNoteAttempt(!0)}else"tutorial"===te.songMode&&ue.triggerNoteAttempt(!1)}function pe(e,t){if(t.isTail){const e=-0,s=t.position-e;t.totalHeight=t.totalHeight+s;const i=t.height+s;return t.note.style.height=`${i}px`,t.note.style.top=e-te.sliderPos+"px",t.height=i,t.position=e,t}{const s=document.createElement("div");s.classList.add("note-tail");const i=-0;s.style.top=`${-1*te.sliderPos+i}px`;const n=t.position-i;s.style.height=`${n}px`;const a=document.createElement("div"),l={note:s,position:i,height:n,totalHeight:n,slideId:e,target:!1,val:t.val,isTail:!0,cloud:a,parentNote:t,tail:null};return t.tail=l,a.classList.add("cloud-tail"),a.classList.add("hidden"),s.appendChild(a),document.getElementById(e).appendChild(s),G[e]=l,l}}ge.style.top="25%",ge.style.left="15%",ge.style.width="60%",ge.style.zIndex=10,setTimeout((()=>{te.songMode||ge.classList.remove("hidden")}),5e3),r("button-play"),document.userFeedbackOpen=!1,document.addEventListener("keypress",(e=>{if(!document.userFeedbackOpen){if(e.stopPropagation(),te.waitingForKey){e.preventDefault(),$[te.waitingForKey[1]]=e.code,document.getElementById(te.waitingForKey[0]).innerText=e.code;const t=`bulb-${te.waitingForKey[0].split("").slice(0,te.waitingForKey[0].length-4).join("")}`;document.getElementById(t).innerText=e.code,document.getElementById("save-settings").style.opacity="1",te.waitingForKey=!1,document.getElementById("change-key-message").innerText=""}"Space"===e.code&&te.spaceFunction()}})),document.addEventListener("keydown",(e=>{document.userFeedbackOpen||(e.code===$[0]&&(e.preventDefault(),X["slide-left"]||_["tapper-left"]||fe("tapper-left","slide-left","note-leaving-left")),e.code===$[1]&&(e.preventDefault(),X["slide-a"]||_["tapper-a"]||(3===ne.slides.length?fe("tapper-a","slide-a",Math.random()>.5?"note-leaving-right":"note-leaving-left"):fe("tapper-a","slide-a","note-leaving-left"))),e.code===$[2]&&(e.preventDefault(),X["slide-b"]||_["tapper-b"]||fe("tapper-b","slide-b","note-leaving-right")),e.code===$[3]&&(e.preventDefault(),X["slide-right"]||_["tapper-right"]||fe("tapper-right","slide-right","note-leaving-right")))})),document.addEventListener("keyup",(e=>{document.userFeedbackOpen||(e.code===$[0]&&ye("tapper-left"),e.code===$[1]&&ye("tapper-a"),e.code===$[2]&&ye("tapper-b"),e.code===$[3]&&ye("tapper-right"))}));let Ae=null,Ie=0;function ve(e,t,s=!1,i=0,n=!1){const a=document.createElement("div");a.classList.add("note"),!0===s&&(a.classList.add("note-marked"),a.style.backgroundColor="yellow"),s&&!0!==s&&(a.style.backgroundColor=s);let l=-0;i>0&&(l+=1*i/(te.travelLength/2)*te.travelLength);let o=!1;if(Ae&&!Ae.killed&&!Ae.isTail&&Math.abs(Ae.position-l)<.05*(te.travelLength+0)){if(!(te.double&&n&&!Ae.aligned&&ne.notesPerSecond>1))return!1;l=Ae.position,o=!0}a.style.top=`${-1*te.sliderPos+l}px`;const r={note:a,position:l,slideId:e,target:!1,val:t,isTail:!1,tail:null,seen:!1,aligned:o};if(Z.add(r),document.getElementById(e).appendChild(a),Ae=r,"tutorial"!==te.songMode)return G[e]=r,Ie+=1,r}const be={1:5,2:20,3:50,4:100,5:100},Ee={1:"hit1",2:"hit2",3:"hit3",4:"hit4",5:"hit4"};let we=!1;function Be(){"tutorial"!==te.songMode&&te.effects&&(R[Math.floor(R.length*Math.random())].play(),te.streaming?le.setVolume(.3):"radio"!==te.songMode&&ae.setVolume(.3)),ne.recordNoteMissed(),l("song-label","font-bigA"),i("song-label",te.currentSong),document.getElementById("slides").classList.remove("on-fire"),document.getElementById("song-label").classList.remove("on-fire"),document.getElementById("streak-channel").classList.remove("streak-channel-lit"),document.getElementById("streak-meter").classList.remove("streak-meter-lit"),document.getElementById("streak-channel").innerHTML="";const e=document.getElementById("rock-label");we||"tutorial"===te.songMode||(e.classList.remove("on-fire"),e.classList.remove("rock-label")),"tutorial"!==te.songMode&&e.classList.remove("static-rock"),document.getElementById("streak-container").classList.add("hidden"),document.getElementById("streak-container").classList.remove("bulge");const t=te.streak;t>25&&(we=!0,"tutorial"!==te.songMode&&(e.innerHTML=`${t} NOTE <br> STREAK!`,e.classList.add("rock-label"),setTimeout((()=>{e.classList.remove("rock-label"),t>50?(e.innerHTML="YOU<br>ROCK!",e.classList.add("rock-label"),setTimeout((()=>{e.classList.remove("rock-label"),e.innerHTML="",we=!1}),1300)):we=!1}),1300))),te.songStreak>ee&&(ee=te.songStreak),te.streak=0,te.songStreak=0,te.songNotesMissed+=1}function Le(e,t,s,i){const n=performance.now()-s;if(n<i){const t=1*n/i;document.getElementById(e).style.width=`${Math.ceil(100*t)}%`}else{const e=Math.floor(n/i),s=t[e-1];if(s){let t=1*(n-i*e)/i;t>.9&&(t=1),document.getElementById(s).style.opacity=`${t}`}}n<i*(1+t.length)&&requestAnimationFrame((()=>{Le(e,t,s,i)}))}function Te(e){const t=document.createElement("div");t.classList.add("note-lighted");const s=document.createElement("div");s.classList.add("note-middle-lighted");const i=document.createElement("div");i.appendChild(t),i.appendChild(s),document.getElementById(`dummy-${e}`).appendChild(i),i.classList.add("flash"),setTimeout((()=>{i.remove()}),1e3)}f().then((e=>{[["toggle-background","animatedBackground","background-title"],["toggle-sustained","sustainedNotes","sustained-title"],["toggle-calibration","autoCalibrating","calibration-title"],["toggle-haptics","hapticsOnHit","haptics-title"],["toggle-animations","animations","animations-title"],["toggle-effects","effects","effects-title"],["toggle-double","double","double-title"]].forEach((t=>{void 0!==e[t[1]]?e[t[1]]?(te[t[1]]=!0,document.getElementById(`${t[0]}-ball`).classList.remove("toggle-ball-off"),document.getElementById(t[2]).style.opacity="1"):(te[t[1]]=!1,document.getElementById(`${t[0]}-ball`).classList.add("toggle-ball-off"),document.getElementById(t[2]).style.opacity="0.5","toggle-calibration"===t[0]&&(te.autoAdjustment=0)):e[t[1]]=te[t[1]]})),[["select-sustained-frequency","sustainedNotesFrequency"],["select-double-frequency","doubleFrequency"]].forEach((t=>{e[t[1]]?(te[t[1]]=e[t[1]],document.getElementById(t[0]).childNodes.forEach((e=>{e.selected=!1,e.value===te[t[1]]&&(e.selected=!0)}))):e[t[1]]=te[t[1]]})),e.queryInitial?fetch("https://beatburner.com/api/statusQuery.php",{method:"POST"}).then((t=>{t.json().then((t=>{var s;"success"===t.message?(te.sendStat=t.data.queryStats,e.queryStats=t.data.queryStats,e.queryInitial=t.data.queryInitial,e.stations=t.data.stations,t.data.messageId>e.lastMessage&&(s=t.data.message,alert(s),e.lastMessage=t.data.messageId),y(e).then((()=>{oe.updateStationInfo(e.stations)}))):y(e)}))})).catch((e=>{console.log(e.message)})):(oe.updateStationInfo(e.stations),y(e))}));const Se=["slide-left","slide-right","slide-left","slide-right","slide-a","slide-b","slide-left","slide-b","slide-a","slide-right"];let ke=0})()})();